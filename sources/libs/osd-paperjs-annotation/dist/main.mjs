/*! For license information please see main.mjs.LICENSE.txt */
var e={946:(e,t,n)=>{n.d(t,{A:()=>s});var o=n(354),r=n.n(o),i=n(314),a=n.n(i)()(r());a.push([e.id,'/**\n * OpenSeadragon paperjs overlay plugin based on paper.js\n * @version 0.4.13\n * \n * Includes additional open source libraries which are subject to copyright notices\n * as indicated accompanying those segments of code.\n * \n * Original code:\n * Copyright (c) 2022-2024, Thomas Pearce\n * All rights reserved.\n * \n * Redistribution and use in source and binary forms, with or without\n * modification, are permitted provided that the following conditions are met:\n * \n * * Redistributions of source code must retain the above copyright notice, this\n *   list of conditions and the following disclaimer.\n * \n * * Redistributions in binary form must reproduce the above copyright notice,\n *   this list of conditions and the following disclaimer in the documentation\n *   and/or other materials provided with the distribution.\n * \n * * Neither the name of osd-paperjs-annotation nor the names of its\n *   contributors may be used to endorse or promote products derived from\n *   this software without specific prior written permission.\n * \n * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS"\n * AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE\n * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE\n * DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE\n * FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL\n * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR\n * SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER\n * CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,\n * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE\n * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n * \n */\n.annotation-ui-noselect{\n    user-select:none;\n}\n.ui-dialog{\n    font-size:14px;\n}\n.ui-dialog, .ui-dialog-content {\n    box-sizing: content-box;\n}\n.flex-row{\n    display:flex;\n    flex-direction:row;\n}\n.annotation-ui-mainwindow .templates{\n    display:none;\n}\n.annotation-ui-mainwindow{\n    height:100%;\n    width:16em;\n    min-width:12em;\n    color:black;\n    overflow:hidden;\n    display:grid;\n    grid-template-rows: auto auto minmax(4em, 1fr) auto;\n    border:thin gray solid;\n    padding:2px;\n    box-sizing:border-box;\n}\n.annotation-visibility-controls{\n    display:flex;\n    flex-grow:0;\n    flex-shrink:0;\n    border-bottom:thin gray solid;\n    padding-bottom:2px;\n    margin-bottom:2px;\n}\n.annotation-visibility-controls .visibility-buttons{\n    flex-grow:0;\n    display:flex;\n    margin-right:5px;\n}\n.annotation-visibility-controls .annotation-opacity-container{\n    flex-grow:1;\n}\n.annotation-ui-mainwindow button.btn{\n    padding:0 3px;\n}\n.file-button{\n    padding:0.1em 0.5em;\n    margin-right:0.3em;\n}\n.annotation-ui label{\n    margin:0;\n}\n.annotation-ui-feature-collections{\n    overflow:auto;\n    border-bottom:thin gray solid;\n}\n.annotation-ui-feature-collections:empty::before {\n    content: \'Click below to begin a new feature collection\';\n    color: gray;\n}\n.feature-collection{\n    border: thin transparent solid;\n    padding:2px;\n    opacity:0.1;\n}\n.annotation-ui-feature-collections .feature-collection{\n    transition: opacity 1s;\n}\n.annotation-ui-feature-collections .feature-collection.inserted:not(.trashed):not(.draganddrop-dragging){\n    opacity:1;\n}\n.annotation-ui-feature-collections .feature-collection:not(.trashed).selected{\n    border:thin black solid;\n    background-color:azure;\n} \n.annotation-ui-feature-collections\n    .feature-collection:not(.trashed,.annotation-hidden,.selected):hover, \n    .feature-collection.svg-hovered:not(.trashed):not(.annotation-hidden){\n    background-color:lightgoldenrodyellow;\n    border:thin black solid;\n}\n.feature-collection.annotation-hidden [data-action="hide"]{\n    display:none;\n}\n.feature-collection:not(.annotation-hidden) [data-action="show"]{\n    display:none;\n}\n.feature-collection.annotation-hidden .features{\n    pointer-events:none;\n    opacity:50%;\n}\n.annotation-ui-feature-collections .name{\n    font-weight:bold;\n}\n.annotation-details{\n    flex-grow:1;\n}\n.feature-item{\n    margin-left:1em;\n}\n\n.feature-collection [data-action], .feature [data-action]{\n    margin-left:0.2em;\n}\n.hoverable-actions:not(:hover) .onhover{\n    visibility:hidden;\n}\n.hoverable-actions:hover .editablecontent .onhover {\n    visibility:visible;\n}\n.feature-collection.trashed{\n    background-color:darkred;\n    opacity:0.3;\n    pointer-events:none;\n}\n.annotation-header{\n    display:grid;\n    grid-template-columns:auto 1fr auto auto auto;\n}\n.feature-collection.trashed .annotation-header [data-action="trash"]{\n    pointer-events:all;\n    visibility:visible;\n}\n.feature-collection .toggle-list{\n    flex-grow:0\n}\n.feature-collection .features{\n    flex-grow:1;\n}\n.features.collapsed .features-list{\n    display:none;\n}\n.features:not(.collapsed) .features-summary{\n    display:none;\n}\n.features.collapsed [data-action="collapse-up"]{\n    display:none;\n}\n.features:not(.collapsed) [data-action="collapse-down"]{\n    display:none;\n}\n.features-summary:not([data-num-elements="1"]) .pluralize::before{\n    content:\'s\';\n}\n.feature.selected{\n    background-color:green;\n}\n.feature{\n    cursor:default;\n}\n.annotation-ui-mainwindow.disabled .disable-when-annotations-hidden{\n    opacity:0.5;\n    pointer-events:none;\n    cursor:not-allowed;\n}\n.annotation-ui-mainwindow.deactivated .disable-when-deactivated{\n    opacity:0.5;\n    pointer-events:none;\n    cursor:not-allowed;\n}\n\n.annotation-ui-grid{\n    display: grid;\n    grid-template-rows: auto 1fr auto;\n    grid-template-columns: auto 1fr auto;\n    width: 100%;\n    height: 100%;\n    background-color:white;\n}\n.annotation-ui-grid .center{\n    grid-column: 2 / 3;\n    grid-row: 2 / 3;\n    position:relative;\n    z-index:0; /* reset the z-index basis for this container so children can be manipulated independently of siblings */\n}\n.annotation-ui-grid .top {\n    grid-column: 1 / 3;\n    grid-row: 1 / 2;\n    text-align:center;\n    border-bottom:thin gray solid;\n}\n.annotation-ui-grid .bottom {\n    grid-column: 1 / 3;\n    grid-row: 3 / 4;\n}\n.annotation-ui-grid .left {\n    grid-column: 1 / 2;\n    grid-row: 2 / 3;\n}\n.annotation-ui-grid .right {\n    grid-column: 3 / 4;\n    grid-row: 1 / 4;\n    position:relative;\n}\n.annotation-ui-grid .resize-right{\n    width: 15px;\n    left: -15px;\n    position: absolute;\n    background-color: rgb(196, 196, 196);\n    cursor: grab;\n    text-align:center;\n    user-select:none;\n    top:50%;\n    transform: translate(0, -50%);\n    padding:10px 0;\n    border-top-left-radius: 5px;\n    border-bottom-left-radius: 5px;\n}\n.annotation-ui-grid .resize-right::before{\n    content:\'||\';\n}\n.annotation-ui-grid .resize-right.resizing{\n    cursor:grabbing;\n}\n.annotation-ui-grid .right:not(:hover) .resize-right{\n    display:none;\n}\n\n.annotation-ui-drawing-toolbar .pseudohidden, .annotation-ui-drawing-toolbar .invisible{\n    visibility:hidden;\n    width: 0;\n    height: 0;\n    overflow: hidden;\n    padding:0;\n    border:none;\n}\n.annotation-ui-drawing-toolbar{\n    background-color:lightgray;\n    display: inline-block;\n    max-width:100%;\n    text-align:left;\n}\n.annotation-ui-drawing-toolbar button[disabled]{\n    pointer-events:none;\n    cursor:not-allowed;\n    border:thin solid transparent;\n}\n.annotation-ui-drawing-toolbar button:not([disabled]){\n    border:thin rgb(195, 195, 195) solid;\n}\n.annotation-ui-drawing-toolbar button:not([disabled]):hover{\n    border:thin rgb(41, 41, 41) solid;\n    z-index:2;\n}\n.annotation-ui-drawing-toolbar .dropdowns>*:not(.active){\n    display:none;\n}\n.annotation-ui-buttonbar>.btn.active{\n    color:black;\n    background-color:darkgray;\n}\n.annotation-ui-buttonbar>.btn:not(.active){\n    color:rgb(62, 62, 62);\n    background-color:lightgrey;\n}\n.dropdowns-container{\n    position:relative;\n    background-color:inherit;\n}\n.dropdowns{\n    color:black;\n    position:absolute;\n    background-color:inherit;\n    min-width:100%;\n}\n.dropdown{\n    width:100%;\n    display:grid;\n    vertical-align: middle;\n    column-gap:1em;\n    grid-template-columns:auto;\n}\n/* brush-toolbar styles */\n.dropdown.brush-toolbar{\n    grid-template-columns: auto 1fr auto auto;    \n}\n/* end brush-toolbar styles */\n\n/* polygon-toolbar styles */\n.dropdown.polygon-toolbar{\n    grid-template-columns: 1fr auto auto auto auto auto;    \n}\n.dropdown.polygon-toolbar button[data-action="simplify"]{\n    margin-right:0.2em;\n}\n/* end polygon-toolbar styles */\n\n/* linestring-toolbar styles */\n.dropdown.linestring-toolbar{\n    grid-template-columns: auto 1fr auto auto;\n}\n/* end linestring-toolbar styles */\ncanvas.selectable-layer{\n    cursor:pointer;\n}\ncanvas.point-tool-grab{\n    cursor:grab;\n}\ncanvas.point-tool-grabbing{\n    cursor:grabbing;\n}\ncanvas.rectangle-tool-move{\n    cursor: move;\n}\ncanvas.rectangle-tool-resize{\n    cursor:nesw-resize;\n}\ncanvas.transform-tool-move{\n    cursor: move;\n}\ncanvas.transform-tool-resize{\n    cursor:nesw-resize;\n}\ncanvas.transform-tool-rotate{\n    cursor: pointer;\n}\n.tool-action[data-tool-action="segment"]{\n    cursor:move;\n}\n.tool-action[data-tool-action="stroke"]{\n    cursor:copy;\n}\n.tool-action[data-tool-action="segment-erase"]{\n    cursor:not-allowed;\n}\n.tool-action[data-tool-action="colorpicker"]{\n    cursor:none;\n}\n\n/* wand-toolbar styles */\n.dropdown.wand-toolbar{\n    grid-template-columns: 5em 1fr auto auto;\n}\n\n.wand-toolbar .threshold-container{\n    display:flex;\n    flex-direction:column;\n}\n.wand-toolbar .threshold-container label, .wand-toolbar .label{\n    margin-bottom:0;\n    font-size:0.8em;\n}\n/* .wand-toolbar .toggle .btn{\n    padding:auto 4px;\n    line-height:1;\n} */\n/* .wand-toolbar .toggle.btn-primary{\n    margin-bottom:0;\n} */\n.wand-toolbar .toggles{\n    display:grid;\n    column-gap:2px;\n    grid-template-columns:7em 5em 8em;\n}\n.wand-toolbar .option-toggle{\n    display:grid;\n    grid-template-rows:auto auto;\n    cursor: pointer;\n    user-select: none;\n    -webkit-user-select:none;\n}\n.wand-toolbar .option-toggle:hover .option{\n    background-color:darkgray;\n}\n.wand-toolbar .option-toggle .option:not(.selected){\n    display:none;\n}\n/* End wand-toolbar styles */\n\n.viewer-controls-topleft{\n    display:flex;\n}\n\n/* style-toolbar styles */\n\n.style-toolbar .style-row{\n    display:grid;\n    grid-template-columns:auto auto auto auto;\n    column-gap:0.5em;\n    align-items:center;\n}\n.style-toolbar .style-item{\n    display:inline-block;\n    width:7em;\n    white-space: nowrap;\n    overflow:hidden;\n    text-overflow:ellipsis;\n    padding-left:0.5em;\n    cursor:pointer;\n}\n.style-toolbar .style-item.selected{\n    outline:medium lightskyblue solid;\n}\n.style-toolbar .hierarchy-up{\n    cursor:pointer;\n    padding:0 0.5em;\n}\n.style-toolbar input[type="number"]{\n    width:3.5em;\n}\n.style-toolbar .colorpicker-row.hidden{\n    display:none;\n}\n.style-toolbar .colorpicker-row{\n    display:grid;\n    grid-template-columns:repeat(4,auto)\n}\n.style-toolbar .preview{\n    position:relative;\n    display:block;\n    background: repeating-conic-gradient(#d0d0d0 0% 25%, white 0% 50%) \n              50% / 20px 20px\n}\n.style-toolbar .preview::after{\n    /* This is just so the height is set correctly since children are absolute positioned */\n    content:\'Preview\';\n    visibility:hidden;\n}\n.style-toolbar .preview .bg{\n    display:block;\n    position:absolute;\n    outline:thin solid black;\n    top:0;\n    left:0;\n    bottom:0;\n    right:0;\n}\n.style-toolbar .preview .text{\n    display:block;\n    position:absolute;\n    padding:0 0.2em;\n}\n.style-toolbar input[type="range"]{\n    display:inline-block;\n}\n\n/* end style-toolbar styles */\n\n\n.new-feature,.new-feature-collection{\n    cursor:pointer;\n}\n.new-feature:hover,.new-feature-collection:hover{\n    background-color:antiquewhite;\n    outline:thin gray solid;\n}\n/* Annotation UI File Dialog Styles*/\n.annotation-ui-filedialog{\n    display:grid;\n    grid-template-columns: auto auto auto;\n}\n.annotation-ui-filedialog>div{\n    padding: 0 0.3em;\n}\n.annotation-ui-filedialog .featurecollection-selection{\n    border-right:thin gray solid;\n    border-left:thin gray solid;\n    width:15em;\n    overflow-x:hidden;\n}\n.annotation-ui-filedialog .featurecollection-list{\n    display:flex;\n    flex-direction:column;\n    overflow:auto;\n}\n.annotation-ui-filedialog .localstorage-key-list::before{\n    content:\'Saved in local storage:\';\n    display:block;\n    color:gray;\n}\n.annotation-ui-filedialog .localstorage-key-list:empty::after{\n    content:\'No items were found in local storage\';\n    font-style:italic;\n    color:gray;\n}\n.annotation-ui-filedialog .localstorage-key{\n    cursor:pointer;\n}\n.annotation-ui-filedialog .localstorage-key:hover{\n    background-color:lightgoldenrodyellow;\n}\n.annotation-ui-filedialog .localstorage-key-test.key-exists::after{\n    content: \'(overwrite)\';\n    font-weight:bold;\n    background-color:rgb(190, 99, 66);\n    color:white;\n    padding:0 0.2em;\n}\n.annotation-ui-filedialog .finalize-panel{\n    width:15em;\n    overflow-x:hidden;\n}\n.annotation-ui-filedialog .header{\n    white-space: nowrap;\n    border-bottom:thin gray solid;\n    padding-bottom:2px;\n    margin-bottom:2px;\n}\n.annotation-ui-filedialog button{\n    display:block;\n}\n\n.annotation-ui-filedialog .file-actions{\n    display:flex;\n    flex-direction:column;\n}\n.annotation-ui-filedialog .file-actions hr{\n    margin: 5px 0;\n}\n\nbutton[disabled]{\n    opacity:0.3;\n}\n\n.dropdown button[data-action="erase"].active{\n    background-color:rgb(187, 86, 86);\n\n}\n.feature .bounding-element{\n    margin-right:-1.2em;\n}\n.feature .bounding-element:not(.active){\n    visibility:visible;\n    color:lightgray;\n}\n.feature .bounding-element.active{\n    visibility:visible;\n    color:black;\n}\n.feature:not(:hover) .bounding-element:not(.active){\n    visibility:hidden;\n}\n\n.hidden{\n    display:none;\n}\n\n.draganddrop-dragging{\n    opacity:0.3;\n}\n.draganddrop-hide{\n    display:none;\n}\n.draganddrop-drop-target{\n    outline:thick rgb(112, 111, 111) solid;\n}\n.draganddrop-drop-target:hover{\n    outline-color:black;\n}\n.draganddrop-drop-target>*>*{\n    pointer-events:none;\n}\n.draganddrop-placeholder{\n    border: thin black solid;\n    border-radius:2px;\n}\n.draganddrop-placeholder>*{\n    visibility:hidden;\n}\n\n/* From bootstrap */\ninput[type=range] {\n    display: block;\n    width: 100%;\n}\n.btn {\n    display: inline-block;\n    padding: 2px 8px;\n    margin-bottom: 0;\n    font-size: 14px;\n    /* font-weight: 400; */\n    /* line-height: 1.42857143; */\n    text-align: center;\n    white-space: nowrap;\n    vertical-align: middle;\n    /* -ms-touch-action: manipulation;\n    touch-action: manipulation; */\n    cursor: pointer;\n    /* -webkit-user-select: none;\n    -moz-user-select: none;\n    -ms-user-select: none; */\n    user-select: none;\n    background-image: none;\n    border: 1px solid transparent;\n    /* border-radius: 4px; */\n}\n.btn.btn-sm{\n    font-size:12px;\n}\n\n.icon {\n    width: 1em;\n    height: 1em;\n    vertical-align: -0.125em;\n}\n/* Items with [data-action] are supposed to be clickable but if the sub-object gets the click it doesn\'t work, so stop pointer events on children */\n[data-action]>*{\n    pointer-events:none;\n}\n\n.rotate-by{\n    transform:rotate(var(--rotate-angle));\n}',"",{version:3,sources:["webpack://./src/css/annotationui.css"],names:[],mappings:"AAAA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;EAoCE;AACF;IACI,gBAAgB;AACpB;AACA;IACI,cAAc;AAClB;AACA;IACI,uBAAuB;AAC3B;AACA;IACI,YAAY;IACZ,kBAAkB;AACtB;AACA;IACI,YAAY;AAChB;AACA;IACI,WAAW;IACX,UAAU;IACV,cAAc;IACd,WAAW;IACX,eAAe;IACf,YAAY;IACZ,mDAAmD;IACnD,sBAAsB;IACtB,WAAW;IACX,qBAAqB;AACzB;AACA;IACI,YAAY;IACZ,WAAW;IACX,aAAa;IACb,6BAA6B;IAC7B,kBAAkB;IAClB,iBAAiB;AACrB;AACA;IACI,WAAW;IACX,YAAY;IACZ,gBAAgB;AACpB;AACA;IACI,WAAW;AACf;AACA;IACI,aAAa;AACjB;AACA;IACI,mBAAmB;IACnB,kBAAkB;AACtB;AACA;IACI,QAAQ;AACZ;AACA;IACI,aAAa;IACb,6BAA6B;AACjC;AACA;IACI,wDAAwD;IACxD,WAAW;AACf;AACA;IACI,8BAA8B;IAC9B,WAAW;IACX,WAAW;AACf;AACA;IACI,sBAAsB;AAC1B;AACA;IACI,SAAS;AACb;AACA;IACI,uBAAuB;IACvB,sBAAsB;AAC1B;AACA;;;IAGI,qCAAqC;IACrC,uBAAuB;AAC3B;AACA;IACI,YAAY;AAChB;AACA;IACI,YAAY;AAChB;AACA;IACI,mBAAmB;IACnB,WAAW;AACf;AACA;IACI,gBAAgB;AACpB;AACA;IACI,WAAW;AACf;AACA;IACI,eAAe;AACnB;;AAEA;IACI,iBAAiB;AACrB;AACA;IACI,iBAAiB;AACrB;AACA;IACI,kBAAkB;AACtB;AACA;IACI,wBAAwB;IACxB,WAAW;IACX,mBAAmB;AACvB;AACA;IACI,YAAY;IACZ,6CAA6C;AACjD;AACA;IACI,kBAAkB;IAClB,kBAAkB;AACtB;AACA;IACI;AACJ;AACA;IACI,WAAW;AACf;AACA;IACI,YAAY;AAChB;AACA;IACI,YAAY;AAChB;AACA;IACI,YAAY;AAChB;AACA;IACI,YAAY;AAChB;AACA;IACI,WAAW;AACf;AACA;IACI,sBAAsB;AAC1B;AACA;IACI,cAAc;AAClB;AACA;IACI,WAAW;IACX,mBAAmB;IACnB,kBAAkB;AACtB;AACA;IACI,WAAW;IACX,mBAAmB;IACnB,kBAAkB;AACtB;;AAEA;IACI,aAAa;IACb,iCAAiC;IACjC,oCAAoC;IACpC,WAAW;IACX,YAAY;IACZ,sBAAsB;AAC1B;AACA;IACI,kBAAkB;IAClB,eAAe;IACf,iBAAiB;IACjB,SAAS,EAAE,wGAAwG;AACvH;AACA;IACI,kBAAkB;IAClB,eAAe;IACf,iBAAiB;IACjB,6BAA6B;AACjC;AACA;IACI,kBAAkB;IAClB,eAAe;AACnB;AACA;IACI,kBAAkB;IAClB,eAAe;AACnB;AACA;IACI,kBAAkB;IAClB,eAAe;IACf,iBAAiB;AACrB;AACA;IACI,WAAW;IACX,WAAW;IACX,kBAAkB;IAClB,oCAAoC;IACpC,YAAY;IACZ,iBAAiB;IACjB,gBAAgB;IAChB,OAAO;IACP,6BAA6B;IAC7B,cAAc;IACd,2BAA2B;IAC3B,8BAA8B;AAClC;AACA;IACI,YAAY;AAChB;AACA;IACI,eAAe;AACnB;AACA;IACI,YAAY;AAChB;;AAEA;IACI,iBAAiB;IACjB,QAAQ;IACR,SAAS;IACT,gBAAgB;IAChB,SAAS;IACT,WAAW;AACf;AACA;IACI,0BAA0B;IAC1B,qBAAqB;IACrB,cAAc;IACd,eAAe;AACnB;AACA;IACI,mBAAmB;IACnB,kBAAkB;IAClB,6BAA6B;AACjC;AACA;IACI,oCAAoC;AACxC;AACA;IACI,iCAAiC;IACjC,SAAS;AACb;AACA;IACI,YAAY;AAChB;AACA;IACI,WAAW;IACX,yBAAyB;AAC7B;AACA;IACI,qBAAqB;IACrB,0BAA0B;AAC9B;AACA;IACI,iBAAiB;IACjB,wBAAwB;AAC5B;AACA;IACI,WAAW;IACX,iBAAiB;IACjB,wBAAwB;IACxB,cAAc;AAClB;AACA;IACI,UAAU;IACV,YAAY;IACZ,sBAAsB;IACtB,cAAc;IACd,0BAA0B;AAC9B;AACA,yBAAyB;AACzB;IACI,yCAAyC;AAC7C;AACA,6BAA6B;;AAE7B,2BAA2B;AAC3B;IACI,mDAAmD;AACvD;AACA;IACI,kBAAkB;AACtB;AACA,+BAA+B;;AAE/B,8BAA8B;AAC9B;IACI,yCAAyC;AAC7C;AACA,kCAAkC;AAClC;IACI,cAAc;AAClB;AACA;IACI,WAAW;AACf;AACA;IACI,eAAe;AACnB;AACA;IACI,YAAY;AAChB;AACA;IACI,kBAAkB;AACtB;AACA;IACI,YAAY;AAChB;AACA;IACI,kBAAkB;AACtB;AACA;IACI,eAAe;AACnB;AACA;IACI,WAAW;AACf;AACA;IACI,WAAW;AACf;AACA;IACI,kBAAkB;AACtB;AACA;IACI,WAAW;AACf;;AAEA,wBAAwB;AACxB;IACI,wCAAwC;AAC5C;;AAEA;IACI,YAAY;IACZ,qBAAqB;AACzB;AACA;IACI,eAAe;IACf,eAAe;AACnB;AACA;;;GAGG;AACH;;GAEG;AACH;IACI,YAAY;IACZ,cAAc;IACd,iCAAiC;AACrC;AACA;IACI,YAAY;IACZ,4BAA4B;IAC5B,eAAe;IACf,iBAAiB;IACjB,wBAAwB;AAC5B;AACA;IACI,yBAAyB;AAC7B;AACA;IACI,YAAY;AAChB;AACA,4BAA4B;;AAE5B;IACI,YAAY;AAChB;;AAEA,yBAAyB;;AAEzB;IACI,YAAY;IACZ,yCAAyC;IACzC,gBAAgB;IAChB,kBAAkB;AACtB;AACA;IACI,oBAAoB;IACpB,SAAS;IACT,mBAAmB;IACnB,eAAe;IACf,sBAAsB;IACtB,kBAAkB;IAClB,cAAc;AAClB;AACA;IACI,iCAAiC;AACrC;AACA;IACI,cAAc;IACd,eAAe;AACnB;AACA;IACI,WAAW;AACf;AACA;IACI,YAAY;AAChB;AACA;IACI,YAAY;IACZ;AACJ;AACA;IACI,iBAAiB;IACjB,aAAa;IACb;;AAEJ;AACA;IACI,uFAAuF;IACvF,iBAAiB;IACjB,iBAAiB;AACrB;AACA;IACI,aAAa;IACb,iBAAiB;IACjB,wBAAwB;IACxB,KAAK;IACL,MAAM;IACN,QAAQ;IACR,OAAO;AACX;AACA;IACI,aAAa;IACb,iBAAiB;IACjB,eAAe;AACnB;AACA;IACI,oBAAoB;AACxB;;AAEA,6BAA6B;;;AAG7B;IACI,cAAc;AAClB;AACA;IACI,6BAA6B;IAC7B,uBAAuB;AAC3B;AACA,oCAAoC;AACpC;IACI,YAAY;IACZ,qCAAqC;AACzC;AACA;IACI,gBAAgB;AACpB;AACA;IACI,4BAA4B;IAC5B,2BAA2B;IAC3B,UAAU;IACV,iBAAiB;AACrB;AACA;IACI,YAAY;IACZ,qBAAqB;IACrB,aAAa;AACjB;AACA;IACI,iCAAiC;IACjC,aAAa;IACb,UAAU;AACd;AACA;IACI,8CAA8C;IAC9C,iBAAiB;IACjB,UAAU;AACd;AACA;IACI,cAAc;AAClB;AACA;IACI,qCAAqC;AACzC;AACA;IACI,sBAAsB;IACtB,gBAAgB;IAChB,iCAAiC;IACjC,WAAW;IACX,eAAe;AACnB;AACA;IACI,UAAU;IACV,iBAAiB;AACrB;AACA;IACI,mBAAmB;IACnB,6BAA6B;IAC7B,kBAAkB;IAClB,iBAAiB;AACrB;AACA;IACI,aAAa;AACjB;;AAEA;IACI,YAAY;IACZ,qBAAqB;AACzB;AACA;IACI,aAAa;AACjB;;AAEA;IACI,WAAW;AACf;;AAEA;IACI,iCAAiC;;AAErC;AACA;IACI,mBAAmB;AACvB;AACA;IACI,kBAAkB;IAClB,eAAe;AACnB;AACA;IACI,kBAAkB;IAClB,WAAW;AACf;AACA;IACI,iBAAiB;AACrB;;AAEA;IACI,YAAY;AAChB;;AAEA;IACI,WAAW;AACf;AACA;IACI,YAAY;AAChB;AACA;IACI,sCAAsC;AAC1C;AACA;IACI,mBAAmB;AACvB;AACA;IACI,mBAAmB;AACvB;AACA;IACI,wBAAwB;IACxB,iBAAiB;AACrB;AACA;IACI,iBAAiB;AACrB;;AAEA,mBAAmB;AACnB;IACI,cAAc;IACd,WAAW;AACf;AACA;IACI,qBAAqB;IACrB,gBAAgB;IAChB,gBAAgB;IAChB,eAAe;IACf,sBAAsB;IACtB,6BAA6B;IAC7B,kBAAkB;IAClB,mBAAmB;IACnB,sBAAsB;IACtB;iCAC6B;IAC7B,eAAe;IACf;;4BAEwB;IACxB,iBAAiB;IACjB,sBAAsB;IACtB,6BAA6B;IAC7B,wBAAwB;AAC5B;AACA;IACI,cAAc;AAClB;;AAEA;IACI,UAAU;IACV,WAAW;IACX,wBAAwB;AAC5B;AACA,mJAAmJ;AACnJ;IACI,mBAAmB;AACvB;;AAEA;IACI,qCAAqC;AACzC",sourcesContent:['/**\n * OpenSeadragon paperjs overlay plugin based on paper.js\n * @version 0.4.13\n * \n * Includes additional open source libraries which are subject to copyright notices\n * as indicated accompanying those segments of code.\n * \n * Original code:\n * Copyright (c) 2022-2024, Thomas Pearce\n * All rights reserved.\n * \n * Redistribution and use in source and binary forms, with or without\n * modification, are permitted provided that the following conditions are met:\n * \n * * Redistributions of source code must retain the above copyright notice, this\n *   list of conditions and the following disclaimer.\n * \n * * Redistributions in binary form must reproduce the above copyright notice,\n *   this list of conditions and the following disclaimer in the documentation\n *   and/or other materials provided with the distribution.\n * \n * * Neither the name of osd-paperjs-annotation nor the names of its\n *   contributors may be used to endorse or promote products derived from\n *   this software without specific prior written permission.\n * \n * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS"\n * AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE\n * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE\n * DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE\n * FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL\n * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR\n * SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER\n * CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,\n * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE\n * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n * \n */\n.annotation-ui-noselect{\n    user-select:none;\n}\n.ui-dialog{\n    font-size:14px;\n}\n.ui-dialog, .ui-dialog-content {\n    box-sizing: content-box;\n}\n.flex-row{\n    display:flex;\n    flex-direction:row;\n}\n.annotation-ui-mainwindow .templates{\n    display:none;\n}\n.annotation-ui-mainwindow{\n    height:100%;\n    width:16em;\n    min-width:12em;\n    color:black;\n    overflow:hidden;\n    display:grid;\n    grid-template-rows: auto auto minmax(4em, 1fr) auto;\n    border:thin gray solid;\n    padding:2px;\n    box-sizing:border-box;\n}\n.annotation-visibility-controls{\n    display:flex;\n    flex-grow:0;\n    flex-shrink:0;\n    border-bottom:thin gray solid;\n    padding-bottom:2px;\n    margin-bottom:2px;\n}\n.annotation-visibility-controls .visibility-buttons{\n    flex-grow:0;\n    display:flex;\n    margin-right:5px;\n}\n.annotation-visibility-controls .annotation-opacity-container{\n    flex-grow:1;\n}\n.annotation-ui-mainwindow button.btn{\n    padding:0 3px;\n}\n.file-button{\n    padding:0.1em 0.5em;\n    margin-right:0.3em;\n}\n.annotation-ui label{\n    margin:0;\n}\n.annotation-ui-feature-collections{\n    overflow:auto;\n    border-bottom:thin gray solid;\n}\n.annotation-ui-feature-collections:empty::before {\n    content: \'Click below to begin a new feature collection\';\n    color: gray;\n}\n.feature-collection{\n    border: thin transparent solid;\n    padding:2px;\n    opacity:0.1;\n}\n.annotation-ui-feature-collections .feature-collection{\n    transition: opacity 1s;\n}\n.annotation-ui-feature-collections .feature-collection.inserted:not(.trashed):not(.draganddrop-dragging){\n    opacity:1;\n}\n.annotation-ui-feature-collections .feature-collection:not(.trashed).selected{\n    border:thin black solid;\n    background-color:azure;\n} \n.annotation-ui-feature-collections\n    .feature-collection:not(.trashed,.annotation-hidden,.selected):hover, \n    .feature-collection.svg-hovered:not(.trashed):not(.annotation-hidden){\n    background-color:lightgoldenrodyellow;\n    border:thin black solid;\n}\n.feature-collection.annotation-hidden [data-action="hide"]{\n    display:none;\n}\n.feature-collection:not(.annotation-hidden) [data-action="show"]{\n    display:none;\n}\n.feature-collection.annotation-hidden .features{\n    pointer-events:none;\n    opacity:50%;\n}\n.annotation-ui-feature-collections .name{\n    font-weight:bold;\n}\n.annotation-details{\n    flex-grow:1;\n}\n.feature-item{\n    margin-left:1em;\n}\n\n.feature-collection [data-action], .feature [data-action]{\n    margin-left:0.2em;\n}\n.hoverable-actions:not(:hover) .onhover{\n    visibility:hidden;\n}\n.hoverable-actions:hover .editablecontent .onhover {\n    visibility:visible;\n}\n.feature-collection.trashed{\n    background-color:darkred;\n    opacity:0.3;\n    pointer-events:none;\n}\n.annotation-header{\n    display:grid;\n    grid-template-columns:auto 1fr auto auto auto;\n}\n.feature-collection.trashed .annotation-header [data-action="trash"]{\n    pointer-events:all;\n    visibility:visible;\n}\n.feature-collection .toggle-list{\n    flex-grow:0\n}\n.feature-collection .features{\n    flex-grow:1;\n}\n.features.collapsed .features-list{\n    display:none;\n}\n.features:not(.collapsed) .features-summary{\n    display:none;\n}\n.features.collapsed [data-action="collapse-up"]{\n    display:none;\n}\n.features:not(.collapsed) [data-action="collapse-down"]{\n    display:none;\n}\n.features-summary:not([data-num-elements="1"]) .pluralize::before{\n    content:\'s\';\n}\n.feature.selected{\n    background-color:green;\n}\n.feature{\n    cursor:default;\n}\n.annotation-ui-mainwindow.disabled .disable-when-annotations-hidden{\n    opacity:0.5;\n    pointer-events:none;\n    cursor:not-allowed;\n}\n.annotation-ui-mainwindow.deactivated .disable-when-deactivated{\n    opacity:0.5;\n    pointer-events:none;\n    cursor:not-allowed;\n}\n\n.annotation-ui-grid{\n    display: grid;\n    grid-template-rows: auto 1fr auto;\n    grid-template-columns: auto 1fr auto;\n    width: 100%;\n    height: 100%;\n    background-color:white;\n}\n.annotation-ui-grid .center{\n    grid-column: 2 / 3;\n    grid-row: 2 / 3;\n    position:relative;\n    z-index:0; /* reset the z-index basis for this container so children can be manipulated independently of siblings */\n}\n.annotation-ui-grid .top {\n    grid-column: 1 / 3;\n    grid-row: 1 / 2;\n    text-align:center;\n    border-bottom:thin gray solid;\n}\n.annotation-ui-grid .bottom {\n    grid-column: 1 / 3;\n    grid-row: 3 / 4;\n}\n.annotation-ui-grid .left {\n    grid-column: 1 / 2;\n    grid-row: 2 / 3;\n}\n.annotation-ui-grid .right {\n    grid-column: 3 / 4;\n    grid-row: 1 / 4;\n    position:relative;\n}\n.annotation-ui-grid .resize-right{\n    width: 15px;\n    left: -15px;\n    position: absolute;\n    background-color: rgb(196, 196, 196);\n    cursor: grab;\n    text-align:center;\n    user-select:none;\n    top:50%;\n    transform: translate(0, -50%);\n    padding:10px 0;\n    border-top-left-radius: 5px;\n    border-bottom-left-radius: 5px;\n}\n.annotation-ui-grid .resize-right::before{\n    content:\'||\';\n}\n.annotation-ui-grid .resize-right.resizing{\n    cursor:grabbing;\n}\n.annotation-ui-grid .right:not(:hover) .resize-right{\n    display:none;\n}\n\n.annotation-ui-drawing-toolbar .pseudohidden, .annotation-ui-drawing-toolbar .invisible{\n    visibility:hidden;\n    width: 0;\n    height: 0;\n    overflow: hidden;\n    padding:0;\n    border:none;\n}\n.annotation-ui-drawing-toolbar{\n    background-color:lightgray;\n    display: inline-block;\n    max-width:100%;\n    text-align:left;\n}\n.annotation-ui-drawing-toolbar button[disabled]{\n    pointer-events:none;\n    cursor:not-allowed;\n    border:thin solid transparent;\n}\n.annotation-ui-drawing-toolbar button:not([disabled]){\n    border:thin rgb(195, 195, 195) solid;\n}\n.annotation-ui-drawing-toolbar button:not([disabled]):hover{\n    border:thin rgb(41, 41, 41) solid;\n    z-index:2;\n}\n.annotation-ui-drawing-toolbar .dropdowns>*:not(.active){\n    display:none;\n}\n.annotation-ui-buttonbar>.btn.active{\n    color:black;\n    background-color:darkgray;\n}\n.annotation-ui-buttonbar>.btn:not(.active){\n    color:rgb(62, 62, 62);\n    background-color:lightgrey;\n}\n.dropdowns-container{\n    position:relative;\n    background-color:inherit;\n}\n.dropdowns{\n    color:black;\n    position:absolute;\n    background-color:inherit;\n    min-width:100%;\n}\n.dropdown{\n    width:100%;\n    display:grid;\n    vertical-align: middle;\n    column-gap:1em;\n    grid-template-columns:auto;\n}\n/* brush-toolbar styles */\n.dropdown.brush-toolbar{\n    grid-template-columns: auto 1fr auto auto;    \n}\n/* end brush-toolbar styles */\n\n/* polygon-toolbar styles */\n.dropdown.polygon-toolbar{\n    grid-template-columns: 1fr auto auto auto auto auto;    \n}\n.dropdown.polygon-toolbar button[data-action="simplify"]{\n    margin-right:0.2em;\n}\n/* end polygon-toolbar styles */\n\n/* linestring-toolbar styles */\n.dropdown.linestring-toolbar{\n    grid-template-columns: auto 1fr auto auto;\n}\n/* end linestring-toolbar styles */\ncanvas.selectable-layer{\n    cursor:pointer;\n}\ncanvas.point-tool-grab{\n    cursor:grab;\n}\ncanvas.point-tool-grabbing{\n    cursor:grabbing;\n}\ncanvas.rectangle-tool-move{\n    cursor: move;\n}\ncanvas.rectangle-tool-resize{\n    cursor:nesw-resize;\n}\ncanvas.transform-tool-move{\n    cursor: move;\n}\ncanvas.transform-tool-resize{\n    cursor:nesw-resize;\n}\ncanvas.transform-tool-rotate{\n    cursor: pointer;\n}\n.tool-action[data-tool-action="segment"]{\n    cursor:move;\n}\n.tool-action[data-tool-action="stroke"]{\n    cursor:copy;\n}\n.tool-action[data-tool-action="segment-erase"]{\n    cursor:not-allowed;\n}\n.tool-action[data-tool-action="colorpicker"]{\n    cursor:none;\n}\n\n/* wand-toolbar styles */\n.dropdown.wand-toolbar{\n    grid-template-columns: 5em 1fr auto auto;\n}\n\n.wand-toolbar .threshold-container{\n    display:flex;\n    flex-direction:column;\n}\n.wand-toolbar .threshold-container label, .wand-toolbar .label{\n    margin-bottom:0;\n    font-size:0.8em;\n}\n/* .wand-toolbar .toggle .btn{\n    padding:auto 4px;\n    line-height:1;\n} */\n/* .wand-toolbar .toggle.btn-primary{\n    margin-bottom:0;\n} */\n.wand-toolbar .toggles{\n    display:grid;\n    column-gap:2px;\n    grid-template-columns:7em 5em 8em;\n}\n.wand-toolbar .option-toggle{\n    display:grid;\n    grid-template-rows:auto auto;\n    cursor: pointer;\n    user-select: none;\n    -webkit-user-select:none;\n}\n.wand-toolbar .option-toggle:hover .option{\n    background-color:darkgray;\n}\n.wand-toolbar .option-toggle .option:not(.selected){\n    display:none;\n}\n/* End wand-toolbar styles */\n\n.viewer-controls-topleft{\n    display:flex;\n}\n\n/* style-toolbar styles */\n\n.style-toolbar .style-row{\n    display:grid;\n    grid-template-columns:auto auto auto auto;\n    column-gap:0.5em;\n    align-items:center;\n}\n.style-toolbar .style-item{\n    display:inline-block;\n    width:7em;\n    white-space: nowrap;\n    overflow:hidden;\n    text-overflow:ellipsis;\n    padding-left:0.5em;\n    cursor:pointer;\n}\n.style-toolbar .style-item.selected{\n    outline:medium lightskyblue solid;\n}\n.style-toolbar .hierarchy-up{\n    cursor:pointer;\n    padding:0 0.5em;\n}\n.style-toolbar input[type="number"]{\n    width:3.5em;\n}\n.style-toolbar .colorpicker-row.hidden{\n    display:none;\n}\n.style-toolbar .colorpicker-row{\n    display:grid;\n    grid-template-columns:repeat(4,auto)\n}\n.style-toolbar .preview{\n    position:relative;\n    display:block;\n    background: repeating-conic-gradient(#d0d0d0 0% 25%, white 0% 50%) \n              50% / 20px 20px\n}\n.style-toolbar .preview::after{\n    /* This is just so the height is set correctly since children are absolute positioned */\n    content:\'Preview\';\n    visibility:hidden;\n}\n.style-toolbar .preview .bg{\n    display:block;\n    position:absolute;\n    outline:thin solid black;\n    top:0;\n    left:0;\n    bottom:0;\n    right:0;\n}\n.style-toolbar .preview .text{\n    display:block;\n    position:absolute;\n    padding:0 0.2em;\n}\n.style-toolbar input[type="range"]{\n    display:inline-block;\n}\n\n/* end style-toolbar styles */\n\n\n.new-feature,.new-feature-collection{\n    cursor:pointer;\n}\n.new-feature:hover,.new-feature-collection:hover{\n    background-color:antiquewhite;\n    outline:thin gray solid;\n}\n/* Annotation UI File Dialog Styles*/\n.annotation-ui-filedialog{\n    display:grid;\n    grid-template-columns: auto auto auto;\n}\n.annotation-ui-filedialog>div{\n    padding: 0 0.3em;\n}\n.annotation-ui-filedialog .featurecollection-selection{\n    border-right:thin gray solid;\n    border-left:thin gray solid;\n    width:15em;\n    overflow-x:hidden;\n}\n.annotation-ui-filedialog .featurecollection-list{\n    display:flex;\n    flex-direction:column;\n    overflow:auto;\n}\n.annotation-ui-filedialog .localstorage-key-list::before{\n    content:\'Saved in local storage:\';\n    display:block;\n    color:gray;\n}\n.annotation-ui-filedialog .localstorage-key-list:empty::after{\n    content:\'No items were found in local storage\';\n    font-style:italic;\n    color:gray;\n}\n.annotation-ui-filedialog .localstorage-key{\n    cursor:pointer;\n}\n.annotation-ui-filedialog .localstorage-key:hover{\n    background-color:lightgoldenrodyellow;\n}\n.annotation-ui-filedialog .localstorage-key-test.key-exists::after{\n    content: \'(overwrite)\';\n    font-weight:bold;\n    background-color:rgb(190, 99, 66);\n    color:white;\n    padding:0 0.2em;\n}\n.annotation-ui-filedialog .finalize-panel{\n    width:15em;\n    overflow-x:hidden;\n}\n.annotation-ui-filedialog .header{\n    white-space: nowrap;\n    border-bottom:thin gray solid;\n    padding-bottom:2px;\n    margin-bottom:2px;\n}\n.annotation-ui-filedialog button{\n    display:block;\n}\n\n.annotation-ui-filedialog .file-actions{\n    display:flex;\n    flex-direction:column;\n}\n.annotation-ui-filedialog .file-actions hr{\n    margin: 5px 0;\n}\n\nbutton[disabled]{\n    opacity:0.3;\n}\n\n.dropdown button[data-action="erase"].active{\n    background-color:rgb(187, 86, 86);\n\n}\n.feature .bounding-element{\n    margin-right:-1.2em;\n}\n.feature .bounding-element:not(.active){\n    visibility:visible;\n    color:lightgray;\n}\n.feature .bounding-element.active{\n    visibility:visible;\n    color:black;\n}\n.feature:not(:hover) .bounding-element:not(.active){\n    visibility:hidden;\n}\n\n.hidden{\n    display:none;\n}\n\n.draganddrop-dragging{\n    opacity:0.3;\n}\n.draganddrop-hide{\n    display:none;\n}\n.draganddrop-drop-target{\n    outline:thick rgb(112, 111, 111) solid;\n}\n.draganddrop-drop-target:hover{\n    outline-color:black;\n}\n.draganddrop-drop-target>*>*{\n    pointer-events:none;\n}\n.draganddrop-placeholder{\n    border: thin black solid;\n    border-radius:2px;\n}\n.draganddrop-placeholder>*{\n    visibility:hidden;\n}\n\n/* From bootstrap */\ninput[type=range] {\n    display: block;\n    width: 100%;\n}\n.btn {\n    display: inline-block;\n    padding: 2px 8px;\n    margin-bottom: 0;\n    font-size: 14px;\n    /* font-weight: 400; */\n    /* line-height: 1.42857143; */\n    text-align: center;\n    white-space: nowrap;\n    vertical-align: middle;\n    /* -ms-touch-action: manipulation;\n    touch-action: manipulation; */\n    cursor: pointer;\n    /* -webkit-user-select: none;\n    -moz-user-select: none;\n    -ms-user-select: none; */\n    user-select: none;\n    background-image: none;\n    border: 1px solid transparent;\n    /* border-radius: 4px; */\n}\n.btn.btn-sm{\n    font-size:12px;\n}\n\n.icon {\n    width: 1em;\n    height: 1em;\n    vertical-align: -0.125em;\n}\n/* Items with [data-action] are supposed to be clickable but if the sub-object gets the click it doesn\'t work, so stop pointer events on children */\n[data-action]>*{\n    pointer-events:none;\n}\n\n.rotate-by{\n    transform:rotate(var(--rotate-angle));\n}'],sourceRoot:""}]);const s=a},676:(e,t,n)=>{n.d(t,{A:()=>s});var o=n(354),r=n.n(o),i=n(314),a=n.n(i)()(r());a.push([e.id,'/**\n * OpenSeadragon paperjs overlay plugin based on paper.js\n * @version 0.4.13\n * \n * Includes additional open source libraries which are subject to copyright notices\n * as indicated accompanying those segments of code.\n * \n * Original code:\n * Copyright (c) 2022-2024, Thomas Pearce\n * All rights reserved.\n * \n * Redistribution and use in source and binary forms, with or without\n * modification, are permitted provided that the following conditions are met:\n * \n * * Redistributions of source code must retain the above copyright notice, this\n *   list of conditions and the following disclaimer.\n * \n * * Redistributions in binary form must reproduce the above copyright notice,\n *   this list of conditions and the following disclaimer in the documentation\n *   and/or other materials provided with the distribution.\n * \n * * Neither the name of osd-paperjs-annotation nor the names of its\n *   contributors may be used to endorse or promote products derived from\n *   this software without specific prior written permission.\n * \n * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS"\n * AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE\n * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE\n * DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE\n * FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL\n * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR\n * SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER\n * CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,\n * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE\n * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n * \n */\n.editablecontent{\n    display:grid;\n    grid-template-columns:1fr auto;\n}\n.editablecontent:not(.editing){\n    cursor:default;\n}\n\n.editablecontent>.edit-button{\n    margin-left:0.2em;\n    cursor:pointer;\n}\n.editablecontent:not(:hover) .onhover{\n    visibility:hidden;\n}\n.editablecontent.editing .text-content{\n    display: none;\n}\n.editablecontent.editing textarea{\n    display:block;\n}\n.editablecontent:not(.editing) textarea{\n    display:none;\n}\n\n.editablecontent .text-content{\n    display:inline-block;\n    position:relative;\n}\n.editablecontent svg *{\n    pointer-events: none;\n}\n.editablecontent textarea{\n    resize:none;\n    width:100%;\n    padding:0;\n    margin:0;\n    border:none;\n    outline:thin black solid;\n    font-weight: inherit;\n    font-size: inherit;\n    font-family: inherit;\n}',"",{version:3,sources:["webpack://./src/css/editablecontent.css"],names:[],mappings:"AAAA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;EAoCE;AACF;IACI,YAAY;IACZ,8BAA8B;AAClC;AACA;IACI,cAAc;AAClB;;AAEA;IACI,iBAAiB;IACjB,cAAc;AAClB;AACA;IACI,iBAAiB;AACrB;AACA;IACI,aAAa;AACjB;AACA;IACI,aAAa;AACjB;AACA;IACI,YAAY;AAChB;;AAEA;IACI,oBAAoB;IACpB,iBAAiB;AACrB;AACA;IACI,oBAAoB;AACxB;AACA;IACI,WAAW;IACX,UAAU;IACV,SAAS;IACT,QAAQ;IACR,WAAW;IACX,wBAAwB;IACxB,oBAAoB;IACpB,kBAAkB;IAClB,oBAAoB;AACxB",sourcesContent:['/**\n * OpenSeadragon paperjs overlay plugin based on paper.js\n * @version 0.4.13\n * \n * Includes additional open source libraries which are subject to copyright notices\n * as indicated accompanying those segments of code.\n * \n * Original code:\n * Copyright (c) 2022-2024, Thomas Pearce\n * All rights reserved.\n * \n * Redistribution and use in source and binary forms, with or without\n * modification, are permitted provided that the following conditions are met:\n * \n * * Redistributions of source code must retain the above copyright notice, this\n *   list of conditions and the following disclaimer.\n * \n * * Redistributions in binary form must reproduce the above copyright notice,\n *   this list of conditions and the following disclaimer in the documentation\n *   and/or other materials provided with the distribution.\n * \n * * Neither the name of osd-paperjs-annotation nor the names of its\n *   contributors may be used to endorse or promote products derived from\n *   this software without specific prior written permission.\n * \n * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS"\n * AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE\n * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE\n * DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE\n * FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL\n * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR\n * SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER\n * CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,\n * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE\n * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n * \n */\n.editablecontent{\n    display:grid;\n    grid-template-columns:1fr auto;\n}\n.editablecontent:not(.editing){\n    cursor:default;\n}\n\n.editablecontent>.edit-button{\n    margin-left:0.2em;\n    cursor:pointer;\n}\n.editablecontent:not(:hover) .onhover{\n    visibility:hidden;\n}\n.editablecontent.editing .text-content{\n    display: none;\n}\n.editablecontent.editing textarea{\n    display:block;\n}\n.editablecontent:not(.editing) textarea{\n    display:none;\n}\n\n.editablecontent .text-content{\n    display:inline-block;\n    position:relative;\n}\n.editablecontent svg *{\n    pointer-events: none;\n}\n.editablecontent textarea{\n    resize:none;\n    width:100%;\n    padding:0;\n    margin:0;\n    border:none;\n    outline:thin black solid;\n    font-weight: inherit;\n    font-size: inherit;\n    font-family: inherit;\n}'],sourceRoot:""}]);const s=a},314:e=>{e.exports=function(e){var t=[];return t.toString=function(){return this.map((function(t){var n="",o=void 0!==t[5];return t[4]&&(n+="@supports (".concat(t[4],") {")),t[2]&&(n+="@media ".concat(t[2]," {")),o&&(n+="@layer".concat(t[5].length>0?" ".concat(t[5]):""," {")),n+=e(t),o&&(n+="}"),t[2]&&(n+="}"),t[4]&&(n+="}"),n})).join("")},t.i=function(e,n,o,r,i){"string"==typeof e&&(e=[[null,e,void 0]]);var a={};if(o)for(var s=0;s<this.length;s++){var l=this[s][0];null!=l&&(a[l]=!0)}for(var c=0;c<e.length;c++){var u=[].concat(e[c]);o&&a[u[0]]||(void 0!==i&&(void 0===u[5]||(u[1]="@layer".concat(u[5].length>0?" ".concat(u[5]):""," {").concat(u[1],"}")),u[5]=i),n&&(u[2]?(u[1]="@media ".concat(u[2]," {").concat(u[1],"}"),u[2]=n):u[2]=n),r&&(u[4]?(u[1]="@supports (".concat(u[4],") {").concat(u[1],"}"),u[4]=r):u[4]="".concat(r)),t.push(u))}},t}},354:e=>{e.exports=function(e){var t=e[1],n=e[3];if(!n)return t;if("function"==typeof btoa){var o=btoa(unescape(encodeURIComponent(JSON.stringify(n)))),r="sourceMappingURL=data:application/json;charset=utf-8;base64,".concat(o),i="/*# ".concat(r," */");return[t].concat([i]).join("\n")}return[t].join("\n")}},72:e=>{var t=[];function n(e){for(var n=-1,o=0;o<t.length;o++)if(t[o].identifier===e){n=o;break}return n}function o(e,o){for(var i={},a=[],s=0;s<e.length;s++){var l=e[s],c=o.base?l[0]+o.base:l[0],u=i[c]||0,p="".concat(c," ").concat(u);i[c]=u+1;var d=n(p),f={css:l[1],media:l[2],sourceMap:l[3],supports:l[4],layer:l[5]};if(-1!==d)t[d].references++,t[d].updater(f);else{var h=r(f,o);o.byIndex=s,t.splice(s,0,{identifier:p,updater:h,references:1})}a.push(p)}return a}function r(e,t){var n=t.domAPI(t);return n.update(e),function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap&&t.supports===e.supports&&t.layer===e.layer)return;n.update(e=t)}else n.remove()}}e.exports=function(e,r){var i=o(e=e||[],r=r||{});return function(e){e=e||[];for(var a=0;a<i.length;a++){var s=n(i[a]);t[s].references--}for(var l=o(e,r),c=0;c<i.length;c++){var u=n(i[c]);0===t[u].references&&(t[u].updater(),t.splice(u,1))}i=l}}},659:e=>{var t={};e.exports=function(e,n){var o=function(e){if(void 0===t[e]){var n=document.querySelector(e);if(window.HTMLIFrameElement&&n instanceof window.HTMLIFrameElement)try{n=n.contentDocument.head}catch(e){n=null}t[e]=n}return t[e]}(e);if(!o)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");o.appendChild(n)}},540:e=>{e.exports=function(e){var t=document.createElement("style");return e.setAttributes(t,e.attributes),e.insert(t,e.options),t}},56:(e,t,n)=>{e.exports=function(e){var t=n.nc;t&&e.setAttribute("nonce",t)}},825:e=>{e.exports=function(e){if("undefined"==typeof document)return{update:function(){},remove:function(){}};var t=e.insertStyleElement(e);return{update:function(n){!function(e,t,n){var o="";n.supports&&(o+="@supports (".concat(n.supports,") {")),n.media&&(o+="@media ".concat(n.media," {"));var r=void 0!==n.layer;r&&(o+="@layer".concat(n.layer.length>0?" ".concat(n.layer):""," {")),o+=n.css,r&&(o+="}"),n.media&&(o+="}"),n.supports&&(o+="}");var i=n.sourceMap;i&&"undefined"!=typeof btoa&&(o+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(i))))," */")),t.styleTagTransform(o,e,t.options)}(t,e,n)},remove:function(){!function(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e)}(t)}}}},113:e=>{e.exports=function(e,t){if(t.styleSheet)t.styleSheet.cssText=e;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(e))}}}},t={};function n(o){var r=t[o];if(void 0!==r)return r.exports;var i=t[o]={id:o,exports:{}};return e[o](i,i.exports,n),i.exports}n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var o in t)n.o(t,o)&&!n.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:t[o]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.nc=void 0;var o={};n.d(o,{jG:()=>ir,yV:()=>Ia,YV:()=>G,ls:()=>Ct,Ge:()=>ue,dH:()=>Yn,fy:()=>xr,$_:()=>hr,fm:()=>Vr,Wi:()=>Nr,KW:()=>mo,Cz:()=>pt,Fv:()=>Ii,Mf:()=>Cn,L_:()=>tn,tD:()=>ro,Ue:()=>$o,Sk:()=>Ln,M$:()=>La,RV:()=>es,HA:()=>_o,wN:()=>Ie,YQ:()=>k,Bg:()=>zo,FY:()=>Ke});var r=OpenSeadragon,i=paper,a=n(72),s=n.n(a),l=n(825),c=n.n(l),u=n(659),p=n.n(u),d=n(56),f=n.n(d),h=n(540),y=n.n(h),v=n(113),m=n.n(v),g=n(676),b={};b.styleTagTransform=m(),b.setAttributes=f(),b.insert=p().bind(null,"head"),b.domAPI=c(),b.insertStyleElement=y(),s()(g.A,b),g.A&&g.A.locals&&g.A.locals;var w=n(946),A={};function C(e){return C="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},C(e)}function S(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,I(o.key),o)}}function I(e){var t=function(e){if("object"!=C(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=C(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==C(t)?t:t+""}A.styleTagTransform=m(),A.setAttributes=f(),A.insert=p().bind(null,"head"),A.domAPI=c(),A.insertStyleElement=y(),s()(w.A,A),w.A&&w.A.locals&&w.A.locals;var k=function(){return e=function e(t){var n,o=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.project={getZoom:function(){return t.view.getZoom()},toolLayer:t.project.layers.toolLayer||t.project.activeLayer,paperScope:t,overlay:t.overlay};var r=this;this._identityMatrix=new t.Matrix,this.extensions={onActivate:function(){},onDeactivate:function(){}},this.tool=new t.Tool,this.tool._toolObject=this,this.tool.extensions={onKeyUp:function(){},onKeyDown:function(){}},this.tool.onKeyDown=function(e){n||"shift"!==e.key||(n=!0,r.onDeactivate()),this.extensions.onKeyDown(e),r.onKeyDown(e)},this.tool.onKeyUp=function(e){"shift"==e.key&&(n=!1,r.onActivate()),this.extensions.onKeyUp(e),r.onKeyUp(e)},this.tool.onMouseDown=function(e){o.onMouseDown(e)},this.tool.onMouseDrag=function(e){o.onMouseDrag(e)},this.tool.onMouseMove=function(e){o.onMouseMove(e)},this.tool.onMouseUp=function(e){o.onMouseUp(e)},this.listeners={}},t=[{key:"getTolerance",value:function(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return n||(n=this.item),e/((null===(t=n)||void 0===t?void 0:t.layer.scaling.x)||1)/this.project.getZoom()}},{key:"isActive",value:function(){return this._active}},{key:"activate",value:function(){this.tool.activate(),this.onActivate()}},{key:"deactivate",value:function(e){this.onDeactivate(e)}},{key:"onActivate",value:function(){this.captureUserInput(!0),this.project.overlay.addEventListener("wheel",this.tool.onMouseWheel),this.project.toolLayer.bringToFront(),this.extensions.onActivate()}},{key:"onDeactivate",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.captureUserInput(!1),this.project.overlay.removeEventListener("wheel",this.tool.onMouseWheel),this.project.toolLayer.sendToBack(),this.extensions.onDeactivate(e)}},{key:"addEventListener",value:function(e,t){this.listeners[e]=this.listeners[e]||[],this.listeners[e].push(t)}},{key:"broadcast",value:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),o=1;o<t;o++)n[o-1]=arguments[o];var r=this.listeners[e];r&&r.forEach((function(e){return e.apply(void 0,n)}))}},{key:"captureUserInput",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.project.overlay.setOSDMouseNavEnabled(!e)}},{key:"onMouseDown",value:function(){}},{key:"onMouseMove",value:function(){}},{key:"onMouseDrag",value:function(){}},{key:"onMouseUp",value:function(){}},{key:"onKeyDown",value:function(){}},{key:"onKeyUp",value:function(){}}],t&&S(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t}();function O(e){return O="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},O(e)}function E(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,P(o.key),o)}}function P(e){var t=function(e){if("object"!=O(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=O(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==O(t)?t:t+""}var _=function(){return e=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)},t=[{key:"getSqDist",value:function(e,t){var n=e.x-t.x,o=e.y-t.y;return n*n+o*o}},{key:"getSqSegDist",value:function(e,t,n){var o=t.x,r=t.y,i=n.x-o,a=n.y-r;if(0!==i||0!==a){var s=((e.x-o)*i+(e.y-r)*a)/(i*i+a*a);s>1?(o=n.x,r=n.y):s>0&&(o+=i*s,r+=a*s)}return(i=e.x-o)*i+(a=e.y-r)*a}},{key:"simplifyRadialDist",value:function(e,t){for(var n,o=e[0],r=[o],i=1,a=e.length;i<a;i++)n=e[i],this.getSqDist(n,o)>t&&(r.push(n),o=n);return o!==n&&r.push(n),r}},{key:"simplifyDPStep",value:function(e,t,n,o,r){for(var i,a=o,s=t+1;s<n;s++){var l=this.getSqSegDist(e[s],e[t],e[n]);l>a&&(i=s,a=l)}a>o&&(i-t>1&&this.simplifyDPStep(e,t,i,o,r),r.push(e[i]),n-i>1&&this.simplifyDPStep(e,i,n,o,r))}},{key:"simplifyDouglasPeucker",value:function(e,t){var n=e.length-1,o=[e[0]];return this.simplifyDPStep(e,0,n,t,o),o.push(e[n]),o}},{key:"simplify",value:function(e,t,n){if(e.length<=2)return e;var o=void 0!==t?t*t:1;return e=n?e:this.simplifyRadialDist(e,o),this.simplifyDouglasPeucker(e,o)}}],t&&E(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t}();function x(e){return x="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},x(e)}function T(e,t){if(e){if("string"==typeof e)return j(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?j(e,t):void 0}}function j(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,o=Array(t);n<t;n++)o[n]=e[n];return o}function B(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function L(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,R(o.key),o)}}function M(e,t,n){return t&&L(e.prototype,t),n&&L(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function R(e){var t=function(e){if("object"!=x(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=x(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==x(t)?t:t+""}function N(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(N=function(){return!!e})()}function F(e){return F=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},F(e)}function D(e,t){return D=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},D(e,t)}var G=function(){function e(t){var n,o,r,i;return B(this,e),(o=this,r=e,i=[t],r=F(r),n=function(e,t){if(t&&("object"==x(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(o,N()?Reflect.construct(r,i||[],F(o).constructor):r.apply(o,i)))._active=!1,n._items=[],n._item=null,n.simplifier=new _,n.tool.onMouseDown=function(e){n.onMouseDown(n._transformEvent(e))},n.tool.onMouseDrag=function(e){n.onMouseDrag(n._transformEvent(e))},n.tool.onMouseMove=function(e){n.onMouseMove(n._transformEvent(e))},n.tool.onMouseUp=function(e){n.onMouseUp(n._transformEvent(e))},n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&D(e,t)}(e,k),M(e,[{key:"isActive",value:function(){return this._active}},{key:"activate",value:function(){if(!this._active){this._active=!0,this.getSelectedItems(),this._setTargetLayer();var e=this.project.paperScope.getActiveTool();this.tool.activate(),this.toolbarControl.activate(),e&&e!=this&&e.deactivate(!0),this.raiseCanvasZIndex(),this.onActivate(),this.broadcast("activated",{target:this})}}},{key:"deactivate",value:function(e){this._active&&(this._active=!1,this.toolbarControl.deactivate(),this.resetCanvasZIndex(),this.onDeactivate(e),this.broadcast("deactivated",{target:this}))}},{key:"raiseCanvasZIndex",value:function(){var e=this.project.paperScope.overlay.viewer,t=e.canvas;this._canvasPriorZIndex=window.getComputedStyle(t)["z-index"];var n,o=Array.from(e.canvas.parentElement.children).filter((function(e){return e!==t})),r=Math.max.apply(Math,function(e){if(Array.isArray(e))return j(e)}(n=o.map((function(e){var t=window.getComputedStyle(e)["z-index"];return"auto"===t?0:parseInt(t)})))||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(n)||T(n)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}());t.style["z-index"]=r+1}},{key:"resetCanvasZIndex",value:function(){this.project.paperScope.overlay.viewer.canvas.style["z-index"]=this._canvasPriorZIndex}},{key:"getToolbarControl",value:function(){return this.toolbarControl}},{key:"setToolbarControl",value:function(e){return this.toolbarControl=e,this.toolbarControl}},{key:"refreshItems",value:function(){return this.getSelectedItems()}},{key:"getSelectedItems",value:function(){this._items=this.project.paperScope.findSelectedItems(),this._itemToCreate=this.project.paperScope.findSelectedNewItem()}},{key:"selectionChanged",value:function(){this.getSelectedItems(),this._setTargetLayer(),this.onSelectionChanged()}},{key:"onSelectionChanged",value:function(){}},{key:"items",get:function(){return this._items}},{key:"item",get:function(){return 1==this._items.length?this._items[0]:null}},{key:"itemToCreate",get:function(){return this._itemToCreate}},{key:"targetLayer",get:function(){return this._targetLayer}},{key:"targetMatrix",get:function(){return this.targetLayer?this.targetLayer.matrix:this._identityMatrix}},{key:"doSimplify",value:function(e){var t=this;e&&!Array.isArray(e)&&(e=[e]),e||(e=this.items);var n,o=function(e){var t="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=T(e))){t&&(e=t);var n=0,o=function(){};return{s:o,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,i=!0,a=!1;return{s:function(){t=t.call(e)},n:function(){var e=t.next();return i=e.done,e},e:function(e){a=!0,r=e},f:function(){try{i||null==t.return||t.return()}finally{if(a)throw r}}}}(e);try{var r=function(){var e=n.value,o=10/t.project.getZoom(),r=2.5/t.project.getZoom(),i=e.clone(),a=[];(i.children||[i]).forEach((function(e){var n=e.segments.map((function(e){return e.point.subtract(e.previous.point).length<o&&e.point.subtract(e.next.point).length<o&&(e.point.x=(e.point.x+e.previous.point.x+e.next.point.x)/3,e.point.y=(e.point.y+e.previous.point.y+e.next.point.y)/3),e.point}));n.push(n[0]);var i=t.simplifier.simplify(n,r,!0);e.segments=i,(e.segments.length<3||Math.abs(e.area)<r*r)&&a.push(e)})),a.forEach((function(e){return e.remove()}));var s=i.unite(i,{insert:!1}).reduce().toCompoundPath();if(i._children?(i.removeChildren(),i.addChildren(s.children)):i.setSegments(s.children[0].segments),!e.isBoundingElement){var l=e.parent.children.filter((function(e){return e.isBoundingElement}));i.applyBounds(l)}s.remove(),e._children?(e.removeChildren(),e.addChildren(i.children)):e.setSegments(i.segments),i.remove()};for(o.s();!(n=o.n()).done;)r()}catch(e){o.e(e)}finally{o.f()}}},{key:"_setTargetLayer",value:function(){if(this.item)this._targetLayer=this.item.layer;else if(this.itemToCreate)this._targetLayer=this.itemToCreate.layer;else if(this.items){var e=new Set(this.items.map((function(e){return e.layer})));1===e.size?this._targetLayer=e.values().next().value:this._targetLayer=this.project.overlay.viewer.viewport.paperLayer}else this._targetLayer=this.project.paperScope.project.activeLayer}},{key:"_transformEvent",value:function(e){var t=this.targetMatrix,n={point:t.inverseTransform(e.point),downPoint:t.inverseTransform(e.downPoint),lastPoint:t.inverseTransform(e.lastPoint),middlePoint:t.inverseTransform(e.middlePoint)},o=e.point.subtract(e.delta);return n.delta=n.point.subtract(t.inverseTransform(o)),e.original={point:e.point,downPoint:e.downPoint,lastPoint:e.lastPoint,middlePoint:e.middlePoint,delta:e.delta},Object.assign(e,n),e}}])}(),z=function(){return M((function e(t){B(this,e),this._active=!1;var n=document.createElement("button");n.classList.add("btn","invisible"),n.textContent="Generic Tool",this.button=new r.Button({tooltip:"Generic Tool",element:n,onClick:function(e){e.eventSource.element.disabled||(t._active?t.deactivate(!0):t.activate())}}),this.button.configure=function(e,t){this.element.title=t,this.element.replaceChildren(e),this.element.classList.remove("invisible"),this.tooltip=t},this.dropdown=document.createElement("div"),this.dropdown.classList.add("dropdown"),this.tool=t}),[{key:"isEnabledForMode",value:function(e){return!1}},{key:"activate",value:function(){this._active||(this._active=!0,this.button.element.classList.add("active"),this.dropdown.classList.add("active"))}},{key:"deactivate",value:function(e){this._active&&(this._active=!1,this.button.element.classList.remove("active"),this.dropdown.classList.remove("active"))}}])}();function H(e){return H="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},H(e)}function U(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var o,r,i,a,s=[],l=!0,c=!1;try{if(i=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;l=!1}else for(;!(l=(o=i.call(n)).done)&&(s.push(o.value),s.length!==t);l=!0);}catch(e){c=!0,r=e}finally{try{if(!l&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(c)throw r}}return s}}(e,t)||Y(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function W(e){return function(e){if(Array.isArray(e))return q(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||Y(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function V(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=Y(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var o=0,r=function(){};return{s:r,n:function(){return o>=e.length?{done:!0}:{done:!1,value:e[o++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){s=!0,i=e},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw i}}}}function Y(e,t){if(e){if("string"==typeof e)return q(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?q(e,t):void 0}}function q(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,o=Array(t);n<t;n++)o[n]=e[n];return o}function J(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,Z(o.key),o)}}function Z(e){var t=function(e){if("object"!=H(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=H(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==H(t)?t:t+""}var X={"fa-pen-nib":'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512">\x3c!--!Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2024 Fonticons, Inc.--\x3e<path d="M368.4 18.3L312.7 74.1 437.9 199.3l55.7-55.7c21.9-21.9 21.9-57.3 0-79.2L447.6 18.3c-21.9-21.9-57.3-21.9-79.2 0zM288 94.6l-9.2 2.8L134.7 140.6c-19.9 6-35.7 21.2-42.3 41L3.8 445.8c-3.8 11.3-1 23.9 7.3 32.4L164.7 324.7c-3-6.3-4.7-13.3-4.7-20.7c0-26.5 21.5-48 48-48s48 21.5 48 48s-21.5 48-48 48c-7.4 0-14.4-1.7-20.7-4.7L33.7 500.9c8.6 8.3 21.1 11.2 32.4 7.3l264.3-88.6c19.7-6.6 35-22.4 41-42.3l43.2-144.1 2.8-9.2L288 94.6z"/></svg>',"fa-edit":'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512">\x3c!--!Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2024 Fonticons, Inc.--\x3e<path d="M471.6 21.7c-21.9-21.9-57.3-21.9-79.2 0L362.3 51.7l97.9 97.9 30.1-30.1c21.9-21.9 21.9-57.3 0-79.2L471.6 21.7zm-299.2 220c-6.1 6.1-10.8 13.6-13.5 21.9l-29.6 88.8c-2.9 8.6-.6 18.1 5.8 24.6s15.9 8.7 24.6 5.8l88.8-29.6c8.2-2.7 15.7-7.4 21.9-13.5L437.7 172.3 339.7 74.3 172.4 241.7zM96 64C43 64 0 107 0 160V416c0 53 43 96 96 96H352c53 0 96-43 96-96V320c0-17.7-14.3-32-32-32s-32 14.3-32 32v96c0 17.7-14.3 32-32 32H96c-17.7 0-32-14.3-32-32V160c0-17.7 14.3-32 32-32h96c17.7 0 32-14.3 32-32s-14.3-32-32-32H96z"/></svg>',"fa-up-down-left-right":'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512">\x3c!--!Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2024 Fonticons, Inc.--\x3e<path d="M278.6 9.4c-12.5-12.5-32.8-12.5-45.3 0l-64 64c-9.2 9.2-11.9 22.9-6.9 34.9s16.6 19.8 29.6 19.8h32v96H128V192c0-12.9-7.8-24.6-19.8-29.6s-25.7-2.2-34.9 6.9l-64 64c-12.5 12.5-12.5 32.8 0 45.3l64 64c9.2 9.2 22.9 11.9 34.9 6.9s19.8-16.6 19.8-29.6V288h96v96H192c-12.9 0-24.6 7.8-29.6 19.8s-2.2 25.7 6.9 34.9l64 64c12.5 12.5 32.8 12.5 45.3 0l64-64c9.2-9.2 11.9-22.9 6.9-34.9s-16.6-19.8-29.6-19.8H288V288h96v32c0 12.9 7.8 24.6 19.8 29.6s25.7 2.2 34.9-6.9l64-64c12.5-12.5 12.5-32.8 0-45.3l-64-64c-9.2-9.2-22.9-11.9-34.9-6.9s-19.8 16.6-19.8 29.6v32H288V128h32c12.9 0 24.6-7.8 29.6-19.8s2.2-25.7-6.9-34.9l-64-64z"/></svg>',"fa-palette":'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512">\x3c!--!Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2024 Fonticons, Inc.--\x3e<path d="M512 256c0 .9 0 1.8 0 2.7c-.4 36.5-33.6 61.3-70.1 61.3H344c-26.5 0-48 21.5-48 48c0 3.4 .4 6.7 1 9.9c2.1 10.2 6.5 20 10.8 29.9c6.1 13.8 12.1 27.5 12.1 42c0 31.8-21.6 60.7-53.4 62c-3.5 .1-7 .2-10.6 .2C114.6 512 0 397.4 0 256S114.6 0 256 0S512 114.6 512 256zM128 288a32 32 0 1 0 -64 0 32 32 0 1 0 64 0zm0-96a32 32 0 1 0 0-64 32 32 0 1 0 0 64zM288 96a32 32 0 1 0 -64 0 32 32 0 1 0 64 0zm96 96a32 32 0 1 0 0-64 32 32 0 1 0 0 64z"/></svg>',"fa-arrow-pointer":'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512">\x3c!--!Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2024 Fonticons, Inc.--\x3e<path d="M0 55.2V426c0 12.2 9.9 22 22 22c6.3 0 12.4-2.7 16.6-7.5L121.2 346l58.1 116.3c7.9 15.8 27.1 22.2 42.9 14.3s22.2-27.1 14.3-42.9L179.8 320H297.9c12.2 0 22.1-9.9 22.1-22.1c0-6.3-2.7-12.3-7.4-16.5L38.6 37.9C34.3 34.1 28.9 32 23.2 32C10.4 32 0 42.4 0 55.2z"/></svg>',"fa-vector-square":'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512">\x3c!--!Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2024 Fonticons, Inc.--\x3e<path d="M368 80h32v32H368V80zM352 32c-17.7 0-32 14.3-32 32H128c0-17.7-14.3-32-32-32H32C14.3 32 0 46.3 0 64v64c0 17.7 14.3 32 32 32V352c-17.7 0-32 14.3-32 32v64c0 17.7 14.3 32 32 32H96c17.7 0 32-14.3 32-32H320c0 17.7 14.3 32 32 32h64c17.7 0 32-14.3 32-32V384c0-17.7-14.3-32-32-32V160c17.7 0 32-14.3 32-32V64c0-17.7-14.3-32-32-32H352zM96 160c17.7 0 32-14.3 32-32H320c0 17.7 14.3 32 32 32V352c-17.7 0-32 14.3-32 32H128c0-17.7-14.3-32-32-32V160zM48 400H80v32H48V400zm320 32V400h32v32H368zM48 112V80H80v32H48z"/></svg>',"fa-image":'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512">\x3c!--!Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2024 Fonticons, Inc.--\x3e<path d="M448 80c8.8 0 16 7.2 16 16V415.8l-5-6.5-136-176c-4.5-5.9-11.6-9.3-19-9.3s-14.4 3.4-19 9.3L202 340.7l-30.5-42.7C167 291.7 159.8 288 152 288s-15 3.7-19.5 10.1l-80 112L48 416.3l0-.3V96c0-8.8 7.2-16 16-16H448zM64 32C28.7 32 0 60.7 0 96V416c0 35.3 28.7 64 64 64H448c35.3 0 64-28.7 64-64V96c0-35.3-28.7-64-64-64H64zm80 192a48 48 0 1 0 0-96 48 48 0 1 0 0 96z"/></svg>',"fa-draw-polygon":'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512">\x3c!--!Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2024 Fonticons, Inc.--\x3e<path d="M96 151.4V360.6c9.7 5.6 17.8 13.7 23.4 23.4H328.6c0-.1 .1-.2 .1-.3l-4.5-7.9-32-56 0 0c-1.4 .1-2.8 .1-4.2 .1c-35.3 0-64-28.7-64-64s28.7-64 64-64c1.4 0 2.8 0 4.2 .1l0 0 32-56 4.5-7.9-.1-.3H119.4c-5.6 9.7-13.7 17.8-23.4 23.4zM384.3 352c35.2 .2 63.7 28.7 63.7 64c0 35.3-28.7 64-64 64c-23.7 0-44.4-12.9-55.4-32H119.4c-11.1 19.1-31.7 32-55.4 32c-35.3 0-64-28.7-64-64c0-23.7 12.9-44.4 32-55.4V151.4C12.9 140.4 0 119.7 0 96C0 60.7 28.7 32 64 32c23.7 0 44.4 12.9 55.4 32H328.6c11.1-19.1 31.7-32 55.4-32c35.3 0 64 28.7 64 64c0 35.3-28.5 63.8-63.7 64l-4.5 7.9-32 56-2.3 4c4.2 8.5 6.5 18 6.5 28.1s-2.3 19.6-6.5 28.1l2.3 4 32 56 4.5 7.9z"/></svg>',"fa-font":'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512">\x3c!--!Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2024 Fonticons, Inc.--\x3e<path d="M254 52.8C249.3 40.3 237.3 32 224 32s-25.3 8.3-30 20.8L57.8 416H32c-17.7 0-32 14.3-32 32s14.3 32 32 32h96c17.7 0 32-14.3 32-32s-14.3-32-32-32h-1.8l18-48H303.8l18 48H320c-17.7 0-32 14.3-32 32s14.3 32 32 32h96c17.7 0 32-14.3 32-32s-14.3-32-32-32H390.2L254 52.8zM279.8 304H168.2L224 155.1 279.8 304z"/></svg>',"fa-map-pin":'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512">\x3c!--!Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2024 Fonticons, Inc.--\x3e<path d="M16 144a144 144 0 1 1 288 0A144 144 0 1 1 16 144zM160 80c8.8 0 16-7.2 16-16s-7.2-16-16-16c-53 0-96 43-96 96c0 8.8 7.2 16 16 16s16-7.2 16-16c0-35.3 28.7-64 64-64zM128 480V317.1c10.4 1.9 21.1 2.9 32 2.9s21.6-1 32-2.9V480c0 17.7-14.3 32-32 32s-32-14.3-32-32z"/></svg>',"fa-circle":'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512">\x3c!--!Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2024 Fonticons, Inc.--\x3e<path d="M464 256A208 208 0 1 0 48 256a208 208 0 1 0 416 0zM0 256a256 256 0 1 1 512 0A256 256 0 1 1 0 256z"/></svg>',"fa-hand":'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512">\x3c!--!Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2024 Fonticons, Inc.--\x3e<path d="M288 32c0-17.7-14.3-32-32-32s-32 14.3-32 32V240c0 8.8-7.2 16-16 16s-16-7.2-16-16V64c0-17.7-14.3-32-32-32s-32 14.3-32 32V336c0 1.5 0 3.1 .1 4.6L67.6 283c-16-15.2-41.3-14.6-56.6 1.4s-14.6 41.3 1.4 56.6L124.8 448c43.1 41.1 100.4 64 160 64H304c97.2 0 176-78.8 176-176V128c0-17.7-14.3-32-32-32s-32 14.3-32 32V240c0 8.8-7.2 16-16 16s-16-7.2-16-16V64c0-17.7-14.3-32-32-32s-32 14.3-32 32V240c0 8.8-7.2 16-16 16s-16-7.2-16-16V32z"/></svg>',"fa-brush":'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512">\x3c!--!Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2024 Fonticons, Inc.--\x3e<path d="M162.4 6c-1.5-3.6-5-6-8.9-6h-19c-3.9 0-7.5 2.4-8.9 6L104.9 57.7c-3.2 8-14.6 8-17.8 0L66.4 6c-1.5-3.6-5-6-8.9-6H48C21.5 0 0 21.5 0 48V224v22.4V256H9.6 374.4 384v-9.6V224 48c0-26.5-21.5-48-48-48H230.5c-3.9 0-7.5 2.4-8.9 6L200.9 57.7c-3.2 8-14.6 8-17.8 0L162.4 6zM0 288v32c0 35.3 28.7 64 64 64h64v64c0 35.3 28.7 64 64 64s64-28.7 64-64V384h64c35.3 0 64-28.7 64-64V288H0zM192 432a16 16 0 1 1 0 32 16 16 0 1 1 0-32z"/></svg>',"fa-rotate":'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512">\x3c!--!Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2024 Fonticons, Inc.--\x3e<path d="M142.9 142.9c62.2-62.2 162.7-62.5 225.3-1L327 183c-6.9 6.9-8.9 17.2-5.2 26.2s12.5 14.8 22.2 14.8H463.5c0 0 0 0 0 0H472c13.3 0 24-10.7 24-24V72c0-9.7-5.8-18.5-14.8-22.2s-19.3-1.7-26.2 5.2L413.4 96.6c-87.6-86.5-228.7-86.2-315.8 1C73.2 122 55.6 150.7 44.8 181.4c-5.9 16.7 2.9 34.9 19.5 40.8s34.9-2.9 40.8-19.5c7.7-21.8 20.2-42.3 37.8-59.8zM16 312v7.6 .7V440c0 9.7 5.8 18.5 14.8 22.2s19.3 1.7 26.2-5.2l41.6-41.6c87.6 86.5 228.7 86.2 315.8-1c24.4-24.4 42.1-53.1 52.9-83.7c5.9-16.7-2.9-34.9-19.5-40.8s-34.9 2.9-40.8 19.5c-7.7 21.8-20.2 42.3-37.8 59.8c-62.2 62.2-162.7 62.5-225.3 1L185 329c6.9-6.9 8.9-17.2 5.2-26.2s-12.5-14.8-22.2-14.8H48.4h-.7H40c-13.3 0-24 10.7-24 24z"/></svg>',"fa-pencil":'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512">\x3c!--!Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2024 Fonticons, Inc.--\x3e<path d="M410.3 231l11.3-11.3-33.9-33.9-62.1-62.1L291.7 89.8l-11.3 11.3-22.6 22.6L58.6 322.9c-10.4 10.4-18 23.3-22.2 37.4L1 480.7c-2.5 8.4-.2 17.5 6.1 23.7s15.3 8.5 23.7 6.1l120.3-35.4c14.1-4.2 27-11.8 37.4-22.2L387.7 253.7 410.3 231zM160 399.4l-9.1 22.7c-4 3.1-8.5 5.4-13.3 6.9L59.4 452l23-78.1c1.4-4.9 3.8-9.4 6.9-13.3l22.7-9.1v32c0 8.8 7.2 16 16 16h32zM362.7 18.7L348.3 33.2 325.7 55.8 314.3 67.1l33.9 33.9 62.1 62.1 33.9 33.9 11.3-11.3 22.6-22.6 14.5-14.5c25-25 25-65.5 0-90.5L453.3 18.7c-25-25-65.5-25-90.5 0zm-47.4 168l-144 144c-6.2 6.2-16.4 6.2-22.6 0s-6.2-16.4 0-22.6l144-144c6.2-6.2 16.4-6.2 22.6 0s6.2 16.4 0 22.6z"/></svg>',"fa-save":'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512">\x3c!--!Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2024 Fonticons, Inc.--\x3e<path d="M64 32C28.7 32 0 60.7 0 96V416c0 35.3 28.7 64 64 64H384c35.3 0 64-28.7 64-64V173.3c0-17-6.7-33.3-18.7-45.3L352 50.7C340 38.7 323.7 32 306.7 32H64zm0 96c0-17.7 14.3-32 32-32H288c17.7 0 32 14.3 32 32v64c0 17.7-14.3 32-32 32H96c-17.7 0-32-14.3-32-32V128zM224 288a64 64 0 1 1 0 128 64 64 0 1 1 0-128z"/></svg>',"fa-wand-magic-sparkles":'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512">\x3c!--!Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2024 Fonticons, Inc.--\x3e<path d="M234.7 42.7L197 56.8c-3 1.1-5 4-5 7.2s2 6.1 5 7.2l37.7 14.1L248.8 123c1.1 3 4 5 7.2 5s6.1-2 7.2-5l14.1-37.7L315 71.2c3-1.1 5-4 5-7.2s-2-6.1-5-7.2L277.3 42.7 263.2 5c-1.1-3-4-5-7.2-5s-6.1 2-7.2 5L234.7 42.7zM46.1 395.4c-18.7 18.7-18.7 49.1 0 67.9l34.6 34.6c18.7 18.7 49.1 18.7 67.9 0L529.9 116.5c18.7-18.7 18.7-49.1 0-67.9L495.3 14.1c-18.7-18.7-49.1-18.7-67.9 0L46.1 395.4zM484.6 82.6l-105 105-23.3-23.3 105-105 23.3 23.3zM7.5 117.2C3 118.9 0 123.2 0 128s3 9.1 7.5 10.8L64 160l21.2 56.5c1.7 4.5 6 7.5 10.8 7.5s9.1-3 10.8-7.5L128 160l56.5-21.2c4.5-1.7 7.5-6 7.5-10.8s-3-9.1-7.5-10.8L128 96 106.8 39.5C105.1 35 100.8 32 96 32s-9.1 3-10.8 7.5L64 96 7.5 117.2zm352 256c-4.5 1.7-7.5 6-7.5 10.8s3 9.1 7.5 10.8L416 416l21.2 56.5c1.7 4.5 6 7.5 10.8 7.5s9.1-3 10.8-7.5L480 416l56.5-21.2c4.5-1.7 7.5-6 7.5-10.8s-3-9.1-7.5-10.8L480 352l-21.2-56.5c-1.7-4.5-6-7.5-10.8-7.5s-9.1 3-10.8 7.5L416 352l-56.5 21.2z"/></svg>',"fa-trash-can":'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512">\x3c!--!Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2024 Fonticons, Inc.--\x3e<path d="M135.2 17.7C140.6 6.8 151.7 0 163.8 0H284.2c12.1 0 23.2 6.8 28.6 17.7L320 32h96c17.7 0 32 14.3 32 32s-14.3 32-32 32H32C14.3 96 0 81.7 0 64S14.3 32 32 32h96l7.2-14.3zM32 128H416V448c0 35.3-28.7 64-64 64H96c-35.3 0-64-28.7-64-64V128zm96 64c-8.8 0-16 7.2-16 16V432c0 8.8 7.2 16 16 16s16-7.2 16-16V208c0-8.8-7.2-16-16-16zm96 0c-8.8 0-16 7.2-16 16V432c0 8.8 7.2 16 16 16s16-7.2 16-16V208c0-8.8-7.2-16-16-16zm96 0c-8.8 0-16 7.2-16 16V432c0 8.8 7.2 16 16 16s16-7.2 16-16V208c0-8.8-7.2-16-16-16z"/></svg>',"fa-sitemap":'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512">\x3c!--!Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2024 Fonticons, Inc.--\x3e<path d="M208 80c0-26.5 21.5-48 48-48h64c26.5 0 48 21.5 48 48v64c0 26.5-21.5 48-48 48h-8v40H464c30.9 0 56 25.1 56 56v32h8c26.5 0 48 21.5 48 48v64c0 26.5-21.5 48-48 48H464c-26.5 0-48-21.5-48-48V368c0-26.5 21.5-48 48-48h8V288c0-4.4-3.6-8-8-8H312v40h8c26.5 0 48 21.5 48 48v64c0 26.5-21.5 48-48 48H256c-26.5 0-48-21.5-48-48V368c0-26.5 21.5-48 48-48h8V280H112c-4.4 0-8 3.6-8 8v32h8c26.5 0 48 21.5 48 48v64c0 26.5-21.5 48-48 48H48c-26.5 0-48-21.5-48-48V368c0-26.5 21.5-48 48-48h8V288c0-30.9 25.1-56 56-56H264V192h-8c-26.5 0-48-21.5-48-48V80z"/></svg>',"fa-eye":'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512">\x3c!--!Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2024 Fonticons, Inc.--\x3e<path d="M288 32c-80.8 0-145.5 36.8-192.6 80.6C48.6 156 17.3 208 2.5 243.7c-3.3 7.9-3.3 16.7 0 24.6C17.3 304 48.6 356 95.4 399.4C142.5 443.2 207.2 480 288 480s145.5-36.8 192.6-80.6c46.8-43.5 78.1-95.4 93-131.1c3.3-7.9 3.3-16.7 0-24.6c-14.9-35.7-46.2-87.7-93-131.1C433.5 68.8 368.8 32 288 32zM144 256a144 144 0 1 1 288 0 144 144 0 1 1 -288 0zm144-64c0 35.3-28.7 64-64 64c-7.1 0-13.9-1.2-20.3-3.3c-5.5-1.8-11.9 1.6-11.7 7.4c.3 6.9 1.3 13.8 3.2 20.7c13.7 51.2 66.4 81.6 117.6 67.9s81.6-66.4 67.9-117.6c-11.1-41.5-47.8-69.4-88.6-71.1c-5.8-.2-9.2 6.1-7.4 11.7c2.1 6.4 3.3 13.2 3.3 20.3z"/></svg>',"fa-eye-slash":'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512">\x3c!--!Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2024 Fonticons, Inc.--\x3e<path d="M38.8 5.1C28.4-3.1 13.3-1.2 5.1 9.2S-1.2 34.7 9.2 42.9l592 464c10.4 8.2 25.5 6.3 33.7-4.1s6.3-25.5-4.1-33.7L525.6 386.7c39.6-40.6 66.4-86.1 79.9-118.4c3.3-7.9 3.3-16.7 0-24.6c-14.9-35.7-46.2-87.7-93-131.1C465.5 68.8 400.8 32 320 32c-68.2 0-125 26.3-169.3 60.8L38.8 5.1zM223.1 149.5C248.6 126.2 282.7 112 320 112c79.5 0 144 64.5 144 144c0 24.9-6.3 48.3-17.4 68.7L408 294.5c8.4-19.3 10.6-41.4 4.8-63.3c-11.1-41.5-47.8-69.4-88.6-71.1c-5.8-.2-9.2 6.1-7.4 11.7c2.1 6.4 3.3 13.2 3.3 20.3c0 10.2-2.4 19.8-6.6 28.3l-90.3-70.8zM373 389.9c-16.4 6.5-34.3 10.1-53 10.1c-79.5 0-144-64.5-144-144c0-6.9 .5-13.6 1.4-20.2L83.1 161.5C60.3 191.2 44 220.8 34.5 243.7c-3.3 7.9-3.3 16.7 0 24.6c14.9 35.7 46.2 87.7 93 131.1C174.5 443.2 239.2 480 320 480c47.8 0 89.9-12.9 126.2-32.5L373 389.9z"/></svg>',"fa-binoculars":'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512">\x3c!--!Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2024 Fonticons, Inc.--\x3e<path d="M128 32h32c17.7 0 32 14.3 32 32V96H96V64c0-17.7 14.3-32 32-32zm64 96V448c0 17.7-14.3 32-32 32H32c-17.7 0-32-14.3-32-32V388.9c0-34.6 9.4-68.6 27.2-98.3C40.9 267.8 49.7 242.4 53 216L60.5 156c2-16 15.6-28 31.8-28H192zm227.8 0c16.1 0 29.8 12 31.8 28L459 216c3.3 26.4 12.1 51.8 25.8 74.6c17.8 29.7 27.2 63.7 27.2 98.3V448c0 17.7-14.3 32-32 32H352c-17.7 0-32-14.3-32-32V128h99.8zM320 64c0-17.7 14.3-32 32-32h32c17.7 0 32 14.3 32 32V96H320V64zm-32 64V288H224V128h64z"/></svg>',"fa-crop-simple":'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512">\x3c!--!Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2024 Fonticons, Inc.--\x3e<path d="M128 32c0-17.7-14.3-32-32-32S64 14.3 64 32V64H32C14.3 64 0 78.3 0 96s14.3 32 32 32H64V384c0 35.3 28.7 64 64 64H352V384H128V32zM384 480c0 17.7 14.3 32 32 32s32-14.3 32-32V448h32c17.7 0 32-14.3 32-32s-14.3-32-32-32H448l0-256c0-35.3-28.7-64-64-64L160 64v64l224 0 0 352z"/></svg>',"fa-plus":'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512">\x3c!--!Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2024 Fonticons, Inc.--\x3e<path d="M256 80c0-17.7-14.3-32-32-32s-32 14.3-32 32V224H48c-17.7 0-32 14.3-32 32s14.3 32 32 32H192V432c0 17.7 14.3 32 32 32s32-14.3 32-32V288H400c17.7 0 32-14.3 32-32s-14.3-32-32-32H256V80z"/></svg>',"fa-caret-down":'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512">\x3c!--!Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2024 Fonticons, Inc.--\x3e<path d="M137.4 374.6c12.5 12.5 32.8 12.5 45.3 0l128-128c9.2-9.2 11.9-22.9 6.9-34.9s-16.6-19.8-29.6-19.8L32 192c-12.9 0-24.6 7.8-29.6 19.8s-2.2 25.7 6.9 34.9l128 128z"/></svg>',"fa-caret-up":'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512">\x3c!--!Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2024 Fonticons, Inc.--\x3e<path d="M182.6 137.4c-12.5-12.5-32.8-12.5-45.3 0l-128 128c-9.2 9.2-11.9 22.9-6.9 34.9s16.6 19.8 29.6 19.8H288c12.9 0 24.6-7.8 29.6-19.8s2.2-25.7-6.9-34.9l-128-128z"/></svg>',"fa-camera":'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512">\x3c!--!Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2024 Fonticons, Inc.--\x3e<path d="M149.1 64.8L138.7 96H64C28.7 96 0 124.7 0 160V416c0 35.3 28.7 64 64 64H448c35.3 0 64-28.7 64-64V160c0-35.3-28.7-64-64-64H373.3L362.9 64.8C356.4 45.2 338.1 32 317.4 32H194.6c-20.7 0-39 13.2-45.5 32.8zM256 192a96 96 0 1 1 0 192 96 96 0 1 1 0-192z"/></svg>'},K=function(){return e=function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._setupSymbols(t)},t=[{key:"makeFaIcon",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=document.createElementNS("http://www.w3.org/2000/svg","svg");n.classList.add("icon"),t&&n.setAttribute("fill","currentColor");var o=document.createElementNS("http://www.w3.org/2000/svg","use");return o.setAttribute("href","#".concat(e)),n.appendChild(o),n}},{key:"convertFaIcons",value:function(e,t){var n=this,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:["fa","fa-solid"];t||(t=Object.keys(X));var r,i=V(t);try{var a=function(){var t=r.value;e.querySelectorAll(".".concat(t)).forEach((function(e){var r,i=n.makeFaIcon(t);(r=e.classList).remove.apply(r,[t].concat(W(o))),e.appendChild(i)}))};for(i.s();!(r=i.n()).done;)a()}catch(e){i.e(e)}finally{i.f()}}},{key:"_setupSymbols",value:function(e){var t=document.createElement("div");e.appendChild(t),t.style.position="absolute",t.style.display="none";var n=document.createElementNS("http://www.w3.org/2000/svg","svg");t.appendChild(n);for(var o="",r=0,i=Object.entries(X);r<i.length;r++){var a=U(i[r],2),s=a[0];o+=a[1].replace("<svg",'<symbol id="'.concat(s,'"')).replace("/svg>","/symbol>")}n.innerHTML=o}}],t&&J(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t}();function Q(e){var t,n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],o=document.createElement("template");return X[e]?(o.innerHTML=X[e],t=o.content.children[0]):t=document.createElementNS("http://www.w3.org/2000/svg","svg"),t.classList.add("icon"),n&&t.setAttribute("fill","currentColor"),t}function $(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:["fa","fa-solid"];t||(t=Object.keys(X));var o,r=V(t);try{var i=function(){var t=o.value;e.querySelectorAll(".".concat(t)).forEach((function(e){var o,r=Q(t);(o=e.classList).remove.apply(o,[t].concat(W(n))),e.appendChild(r)}))};for(r.s();!(o=r.n()).done;)i()}catch(e){r.e(e)}finally{r.f()}}function ee(e){return ee="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ee(e)}function te(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function ne(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,re(o.key),o)}}function oe(e,t,n){return t&&ne(e.prototype,t),n&&ne(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function re(e){var t=function(e){if("object"!=ee(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=ee(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==ee(t)?t:t+""}function ie(e,t,n){return t=se(t),function(e,t){if(t&&("object"==ee(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,ae()?Reflect.construct(t,n||[],se(e).constructor):t.apply(e,n))}function ae(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(ae=function(){return!!e})()}function se(e){return se=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},se(e)}function le(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&ce(e,t)}function ce(e,t){return ce=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},ce(e,t)}var ue=function(){function e(t){var n;return te(this,e),(n=ie(this,e,[t])).setToolbarControl(new pe(n)),n}return le(e,G),oe(e,[{key:"onDeactivate",value:function(){}},{key:"onActivate",value:function(){this.resetCanvasZIndex()}}])}(),pe=function(){function e(t){var n;te(this,e),n=ie(this,e,[t]);var o=Q("fa-hand");return n.button.configure(o,"Image Navigation Tool"),n}return le(e,z),oe(e,[{key:"isEnabledForMode",value:function(e){return!0}}])}();function de(e){return de="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},de(e)}function fe(){fe=function(){return t};var e,t={},n=Object.prototype,o=n.hasOwnProperty,r=Object.defineProperty||function(e,t,n){e[t]=n.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",s=i.asyncIterator||"@@asyncIterator",l=i.toStringTag||"@@toStringTag";function c(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{c({},"")}catch(e){c=function(e,t,n){return e[t]=n}}function u(e,t,n,o){var i=t&&t.prototype instanceof m?t:m,a=Object.create(i.prototype),s=new x(o||[]);return r(a,"_invoke",{value:O(e,n,s)}),a}function p(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}t.wrap=u;var d="suspendedStart",f="suspendedYield",h="executing",y="completed",v={};function m(){}function g(){}function b(){}var w={};c(w,a,(function(){return this}));var A=Object.getPrototypeOf,C=A&&A(A(T([])));C&&C!==n&&o.call(C,a)&&(w=C);var S=b.prototype=m.prototype=Object.create(w);function I(e){["next","throw","return"].forEach((function(t){c(e,t,(function(e){return this._invoke(t,e)}))}))}function k(e,t){function n(r,i,a,s){var l=p(e[r],e,i);if("throw"!==l.type){var c=l.arg,u=c.value;return u&&"object"==de(u)&&o.call(u,"__await")?t.resolve(u.__await).then((function(e){n("next",e,a,s)}),(function(e){n("throw",e,a,s)})):t.resolve(u).then((function(e){c.value=e,a(c)}),(function(e){return n("throw",e,a,s)}))}s(l.arg)}var i;r(this,"_invoke",{value:function(e,o){function r(){return new t((function(t,r){n(e,o,t,r)}))}return i=i?i.then(r,r):r()}})}function O(t,n,o){var r=d;return function(i,a){if(r===h)throw Error("Generator is already running");if(r===y){if("throw"===i)throw a;return{value:e,done:!0}}for(o.method=i,o.arg=a;;){var s=o.delegate;if(s){var l=E(s,o);if(l){if(l===v)continue;return l}}if("next"===o.method)o.sent=o._sent=o.arg;else if("throw"===o.method){if(r===d)throw r=y,o.arg;o.dispatchException(o.arg)}else"return"===o.method&&o.abrupt("return",o.arg);r=h;var c=p(t,n,o);if("normal"===c.type){if(r=o.done?y:f,c.arg===v)continue;return{value:c.arg,done:o.done}}"throw"===c.type&&(r=y,o.method="throw",o.arg=c.arg)}}}function E(t,n){var o=n.method,r=t.iterator[o];if(r===e)return n.delegate=null,"throw"===o&&t.iterator.return&&(n.method="return",n.arg=e,E(t,n),"throw"===n.method)||"return"!==o&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+o+"' method")),v;var i=p(r,t.iterator,n.arg);if("throw"===i.type)return n.method="throw",n.arg=i.arg,n.delegate=null,v;var a=i.arg;return a?a.done?(n[t.resultName]=a.value,n.next=t.nextLoc,"return"!==n.method&&(n.method="next",n.arg=e),n.delegate=null,v):a:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,v)}function P(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function _(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function x(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(P,this),this.reset(!0)}function T(t){if(t||""===t){var n=t[a];if(n)return n.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var r=-1,i=function n(){for(;++r<t.length;)if(o.call(t,r))return n.value=t[r],n.done=!1,n;return n.value=e,n.done=!0,n};return i.next=i}}throw new TypeError(de(t)+" is not iterable")}return g.prototype=b,r(S,"constructor",{value:b,configurable:!0}),r(b,"constructor",{value:g,configurable:!0}),g.displayName=c(b,l,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===g||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,b):(e.__proto__=b,c(e,l,"GeneratorFunction")),e.prototype=Object.create(S),e},t.awrap=function(e){return{__await:e}},I(k.prototype),c(k.prototype,s,(function(){return this})),t.AsyncIterator=k,t.async=function(e,n,o,r,i){void 0===i&&(i=Promise);var a=new k(u(e,n,o,r),i);return t.isGeneratorFunction(n)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},I(S),c(S,l,"Generator"),c(S,a,(function(){return this})),c(S,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),n=[];for(var o in t)n.push(o);return n.reverse(),function e(){for(;n.length;){var o=n.pop();if(o in t)return e.value=o,e.done=!1,e}return e.done=!0,e}},t.values=T,x.prototype={constructor:x,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(_),!t)for(var n in this)"t"===n.charAt(0)&&o.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var n=this;function r(o,r){return s.type="throw",s.arg=t,n.next=o,r&&(n.method="next",n.arg=e),!!r}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],s=a.completion;if("root"===a.tryLoc)return r("end");if(a.tryLoc<=this.prev){var l=o.call(a,"catchLoc"),c=o.call(a,"finallyLoc");if(l&&c){if(this.prev<a.catchLoc)return r(a.catchLoc,!0);if(this.prev<a.finallyLoc)return r(a.finallyLoc)}else if(l){if(this.prev<a.catchLoc)return r(a.catchLoc,!0)}else{if(!c)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return r(a.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var r=this.tryEntries[n];if(r.tryLoc<=this.prev&&o.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var i=r;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=e,a.arg=t,i?(this.method="next",this.next=i.finallyLoc,v):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),v},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),_(n),v}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var o=n.completion;if("throw"===o.type){var r=o.arg;_(n)}return r}}throw Error("illegal catch attempt")},delegateYield:function(t,n,o){return this.delegate={iterator:T(t),resultName:n,nextLoc:o},"next"===this.method&&(this.arg=e),v}},t}function he(e,t,n,o,r,i,a){try{var s=e[i](a),l=s.value}catch(e){return void n(e)}s.done?t(l):Promise.resolve(l).then(o,r)}function ye(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function ve(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,ge(o.key),o)}}function me(e,t,n){return t&&ve(e.prototype,t),n&&ve(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function ge(e){var t=function(e){if("object"!=de(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=de(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==de(t)?t:t+""}function be(e,t,n){return t=Ae(t),function(e,t){if(t&&("object"==de(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,we()?Reflect.construct(t,n||[],Ae(e).constructor):t.apply(e,n))}function we(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(we=function(){return!!e})()}function Ae(e){return Ae=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},Ae(e)}function Ce(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Se(e,t)}function Se(e,t){return Se=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},Se(e,t)}var Ie=function(){function e(t){var n;ye(this,e);var o=n=be(this,e,[t]),r=n.tool;return n._ignoreNextSelectionChange=!1,n._targetItems=[],n.setToolbarControl(new ke(n)),n.colorpicker=new Oe(12,9,n.project.toolLayer),n.cursor=n.colorpicker.element,n.cursor.applyRescale(),n.extensions.onActivate=function(){o.pickingColor&&(o.project.overlay.addClass("tool-action").setAttribute("data-tool-action","colorpicker"),o.cursor.visible=!0),o.selectionChanged(),o.captureUserInput(!!o.pickingColor)},n.extensions.onDeactivate=function(e){o.project.overlay.removeClass("tool-action").setAttribute("data-tool-action",""),o.cursor.visible=!1,e&&o.cancelColorpicker()},r.extensions.onKeyUp=function(e){"escape"==e.key&&o.cancelColorpicker()},n.project.paperScope.project.on("edit-style",(function(e){n.activateForItem(e.item)})),n}return Ce(e,G),me(e,[{key:"onMouseMove",value:function(e){this.pickingColor&&this.colorpicker.updatePosition(e.original.point)}},{key:"onMouseUp",value:function(){this.pickingColor&&this.cursor.visible&&(this._colorpickerPromise&&this._colorpickerPromise.resolve(this.colorpicker.selectedColor),this._colorpickerPromise=null,this.cancelColorpicker())}},{key:"activateForItem",value:function(e){this.targetItems=e,this._ignoreNextSelectionChange=!0,this.activate(),this.toolbarControl.updateDisplay(),this._ignoreNextSelectionChange=!1}},{key:"onSelectionChanged",value:function(){this._ignoreNextSelectionChange||(this.targetItems=this.items,this.toolbarControl.updateDisplay()),this._ignoreNextSelectionChange=!1}},{key:"defaultTarget",get:function(){return this.project.paperScope.project}},{key:"targetItems",get:function(){return this._targetItems},set:function(e){this._targetItems=e?[e].flat().filter((function(e){return e.defaultStyle||e.style})):[],0==this._targetItems.length&&(this._targetItems=[this.defaultTarget])}},{key:"targetItemStyles",get:function(){return this._targetItems.map((function(e){return e.defaultStyle||e.style}))}},{key:"targetDescription",get:function(){if(0==this._targetItems.length)return"No target";if(this._targetItems.length>1)return"".concat(this._targetItems.length," items");var e=this._targetItems[0];return e==this.defaultTarget?"Default style":e.displayName}},{key:"pickColor",value:function(){var e=this;return e.captureUserInput(!0),new Promise((function(t,n){e._colorpickerPromise&&e._colorpickerPromise.reject("Canceled"),e._colorpickerPromise={resolve:t,reject:n},e.activate(),e.pickingColor=!0,e.cursor.visible=!0,e.project.paperScope.project.layers.toolLayer.bringToFront(),e.tool.onMouseMove({point:e.cursor.view.center}),e.project.overlay.addClass("tool-action").setAttribute("data-tool-action","colorpicker")})).finally((function(){e.captureUserInput(!1)}))}},{key:"cancelColorpicker",value:function(){this.cursor.addTo(this.project.toolLayer),this.pickingColor=!1,this.cursor.visible=!1,this.project.overlay.removeClass("tool-action").setAttribute("data-tool-action",""),this._colorpickerPromise&&this._colorpickerPromise.reject("Canceled")}},{key:"createMaskedImage",value:function(e){var t=e.clone(),n=new i.Group([t]),o=this.project.paperScope.view.projectToView(t.bounds),r=o.x,a=o.y,s=t.bounds.width*this.project.getZoom(),l=t.bounds.height*this.project.getZoom(),c=this.project.paperScope.view.pixelRatio,u=document.createElement("canvas");canvas.setAttribute("width",s*c),canvas.setAttribute("height",l*c),u.getContext("2d").drawImage(this.project.overlay.viewer.drawer.canvas,r*c,a*c,s*c,l*c,0,0,s*c,l*c);var p=u.toDataURL(),d=new i.Raster({source:p,position:t.bounds.center});return d.scale(1/(c*this.project.getZoom())),n.addChild(d),n.clipped=!0,n.position.x=n.position.x+500,n}},{key:"applyStrokeWidth",value:function(e){this.targetItems.forEach((function(t){t.defaultStyle&&(t=t.defaultStyle),t.strokeWidth=e,t.rescale&&(t.rescale.strokeWidth=e),t.isGeoJSONFeature&&t.applyRescale()}))}},{key:"applyOpacity",value:function(e,t){this.targetItems.forEach((function(n){(n.defaultStyle||n.style)[t]=e,n.isGeoJSONFeature&&(n.updateFillOpacity(),n.updateStrokeOpacity())}))}},{key:"applyColor",value:function(e,t,n){"fill"==t?this.applyFillColor(e,n):"stroke"==t?this.applyStrokeColor(e,n):console.warn('Cannot apply color change - type "'.concat(t,'" not recognized'))}},{key:"applyFillColor",value:function(e,t){(t?[t]:this.targetItems).forEach((function(t){var n=new i.Color(e);(t.defaultStyle||t.style).fillColor=n,t.isGeoJSONFeature&&t.updateFillOpacity()}))}},{key:"applyStrokeColor",value:function(e,t){(t?[t]:this.targetItems).forEach((function(t){var n=new i.Color(e);(t.defaultStyle||t.style).strokeColor=n,t.isGeoJSONFeature&&t.updateStrokeOpacity()}))}}])}(),ke=function(){function e(t){var n;ye(this,e);var o=n=be(this,e,[t]),r=Q("fa-palette");return n.button.configure(r,"Style Tool"),n.dropdown.innerHTML=n.uiHTML(),$(n.dropdown),n._hierarchy=[],n.dropdown.querySelectorAll('[data-action="pick-color"]').forEach((function(e){e.addEventListener("click",(function(){var e,t=this.getAttribute("data-type"),n=o.dropdown.querySelector('input[type="color"][data-type="'.concat(t,'"]'));o.dropdown.querySelectorAll('[data-action="pick-color"]').forEach((function(e){return e.classList.remove("active")})),(e=n).offsetWidth||e.offsetHeight||e.getClientRects().length?o.dropdown.querySelectorAll(".colorpicker-row").forEach((function(e){return e.classList.add("hidden")})):(o.dropdown.querySelectorAll(".colorpicker-row").forEach((function(e){return e.classList.add("hidden")})),n.closest(".colorpicker-row").classList.remove("hidden"),this.classList.add("active"))}))})),n.dropdown.querySelectorAll('input[type="color"]').forEach((function(e){return e.addEventListener("input",(function(){var e=this.getAttribute("data-type");o.tool.applyColor(this.value,e),"fill"==e&&o.setFillButtonColor(new i.Color(this.value)),"stroke"==e&&o.setStrokeButtonColor(new i.Color(this.value))}))})),n.dropdown.querySelectorAll('input[type="number"]').forEach((function(e){return e.addEventListener("input",(function(){o.tool.applyStrokeWidth(this.value)}))})),n.dropdown.querySelectorAll('input[data-action="opacity"]').forEach((function(e){return e.addEventListener("input",(function(){var e=this.getAttribute("data-type"),t=this.getAttribute("data-property");o.tool.applyOpacity(this.value,t),"fill"==e&&o.setFillButtonOpacity(this.value),"stroke"==e&&o.setStrokeButtonOpacity(this.value)}))})),n.dropdown.querySelectorAll('[data-action="from-image"]').forEach((function(e){return e.addEventListener("click",(function(){var e=this;o.tool.pickColor().then((function(t){e.parentElement.querySelectorAll('input[type="color"]').forEach((function(e){e.value=t.toCSS(!0),e.dispatchEvent(new Event("input"))}))})).catch((function(e){}))}))})),n.dropdown.querySelectorAll('[data-action="from-average"]').forEach((function(e){return e.addEventListener("click",(function(){var e=this.getAttribute("data-type");o.fromAverage(e)}))})),n.dropdown.querySelectorAll(".style-item").forEach((function(e){return e.addEventListener("click",(function(){var e=o.tool.targetItems,t=e.every((function(e){return e.selected})),n=e.filter((function(e){return e.isGeoJSONFeature}));n.length>0&&(o.tool._ignoreNextSelectionChange=!0,n.forEach((function(e){return t?e.deselect():e.select()}))),o.updateTargetDescription()}))})),n.dropdown.querySelectorAll(".hierarchy-up").forEach((function(e){return e.addEventListener("click",(function(){if(o._hierarchy&&o._hierarchy.length>0)o._hierarchy.index=(o._hierarchy.index+1)%o._hierarchy.length;else{var e=o.tool.targetItems,t=new Set(e.map((function(e){return e.hierarchy.filter((function(t){return t.isGeoJSONFeatureCollection&&t!==e}))})).flat());0==t.size?e.indexOf(o.tool.defaultTarget)>-1?(o._hierarchy=[o.tool.defaultTarget],o._hierarchy.index=0):(o._hierarchy=[e,o.tool.defaultTarget],o._hierarchy.index=1):1==t.size?(o._hierarchy=[o.tool.targetItems,t.values().next().value,o.tool.defaultTarget],o._hierarchy.index=1):(o._hierarchy=[o.tool.targetItems,o.tool.defaultTarget],o._hierarchy.index=1)}var n=o._hierarchy;o.tool.activateForItem(o._hierarchy[o._hierarchy.index]),o._hierarchy=n}))})),n}return Ce(e,z),me(e,[{key:"fromAverage",value:function(e){var t=this,n=this.tool.targetItems.map((function(n){return Ee(n).then((function(o){t.tool.applyColor(o,e,n)}))}));Promise.all(n).then((function(){return t.updateDisplay()}))}},{key:"isEnabledForMode",value:function(e){return!0}},{key:"uiHTML",value:function(){return'\n            <div class="style-toolbar">\n                <div class="flex-row style-row annotation-ui-buttonbar" >\n                    <span><span class="hierarchy-up fa-solid fa-sitemap" title=\'Cycle through hierarchy\'></span><span class=\'style-item\' title=\'Toggle selection\'></span></span>\n                    <span class=\'btn\' data-action="pick-color" data-type="fill"><span class="preview"><span class="color bg"></span><span class="color text">Fill</span></span></span>\n                    <span class=\'btn\' data-action="pick-color" data-type="stroke"><span class="preview"><span class="color bg"></span><span class="color text">Stroke</span></span></span>\n                    <input type="number" min=0 value=1>\n                </div>\n                <div class="colorpicker-row hidden">\n                    <input type="color" data-action="color" data-type="fill">\n                    <input type="range" data-action="opacity" data-type="fill" data-property="fillOpacity" min=0 max=1 step=0.01 value=1>\n                    <span class=\'btn\' data-action="from-image">From image</span>\n                    <span class=\'btn\' data-action="from-average" data-type="fill">Area average</span>\n                </div>\n                <div class="colorpicker-row hidden">\n                    <input type="color" data-action="color" data-type="stroke">\n                    <input type="range" data-action="opacity" data-type="stroke" data-property="strokeOpacity" min=0 max=1 step=0.01 value=1>\n                    <span class=\'btn\' data-action="from-image">From image</span>\n                    <span class=\'btn\' data-action="from-average" data-type="stroke">Area average</span>\n                </div>\n            </div>\n        '}},{key:"updateTargetDescription",value:function(){var e=this.tool.targetDescription,t=this.tool.targetItems.every((function(e){return e.selected&&e.isGeoJSONFeature})),n=this.dropdown.querySelector(".style-item");n.innerHTML=e,t?n.classList.add("selected"):n.classList.remove("selected")}},{key:"updateDisplay",value:function(){this._hierarchy=[];var e=this.tool.targetItemStyles;this.updateTargetDescription();var t=e.map((function(e){return e.fillColor}));1==t.length||1==new Set(t.map((function(e){return e.toCSS()}))).size?this.setFillButtonColor(t[0]):this.setFillButtonColor();var n=e.map((function(e){return e.strokeColor}));1==n.length||1==new Set(n.map((function(e){return e.toCSS()}))).size?this.setStrokeButtonColor(n[0]):this.setStrokeButtonColor();var o=e.map((function(e){return e.fillOpacity}));1==o.length||1==new Set(o).size?this.setFillButtonOpacity(o[0]):this.setFillButtonOpacity(1);var r=e.map((function(e){return e.strokeOpacity}));1==r.length||1==new Set(r).size?this.setStrokeButtonOpacity(r[0]):this.setStrokeButtonOpacity(1);var i=e.map((function(e){return e.rescale?e.rescale.strokeWidth:e.strokeWidth}));1==i.length||1==new Set(i).size?this.dropdown.querySelectorAll('input[type="number"]').forEach((function(e){return e.value=i[0]})):this.dropdown.querySelectorAll('input[type="number"]').forEach((function(e){return e.value=""}))}},{key:"setFillButtonColor",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new i.Color("white");e||(e=new i.Color("white"));var t=e.toCSS(!0),n=_e(e.toCSS(!0));this.dropdown.querySelectorAll('[data-type="fill"] .preview .text').forEach((function(e){return e.style.color=n})),this.dropdown.querySelectorAll('[data-type="fill"] .preview .color').forEach((function(e){e.style.backgroundColor=t,e.style.outlineColor=n})),this.dropdown.querySelectorAll('input[type="color"][data-type="fill"]').forEach((function(e){return e.value=t}))}},{key:"setStrokeButtonColor",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new i.Color("black");e||(e=new i.Color("black"));var t=e.toCSS(!0),n=_e(e.toCSS(!0));this.dropdown.querySelectorAll('[data-type="stroke"] .preview .text').forEach((function(e){return e.style.color=n})),this.dropdown.querySelectorAll('[data-type="stroke"] .preview .color').forEach((function(e){e.style.backgroundColor=t,e.style.outlineColor=n})),this.dropdown.querySelectorAll('input[type="color"][data-type="stroke"]').forEach((function(e){return e.value=t}))}},{key:"setFillButtonOpacity",value:function(e){this.dropdown.querySelectorAll('[data-type="fill"] .preview .bg').forEach((function(t){return t.style.opacity=e})),this.dropdown.querySelectorAll('[data-type="fill"][data-action="opacity"]').forEach((function(t){return t.value=e}))}},{key:"setStrokeButtonOpacity",value:function(e){this.dropdown.querySelectorAll('[data-type="stroke"] .preview .bg').forEach((function(t){return t.style.opacity=e})),this.dropdown.querySelectorAll('[data-type="stroke"][data-action="opacity"]').forEach((function(t){return t.value=e}))}}])}();function Oe(e,t,n){var o=new i.Group({visible:!1,applyMatrix:!1});function r(){var e=o.view.getFlipped()?o.view.getRotation():180-o.view.getRotation();o.rotate(-e),o.scale(-1,1),o.rotate(e)}this.element=o,n.addChild(o),o.view.on("rotate",(function(e){return o.rotate(-e.rotatedBy)})),o.view.on("flip",r),o.numRows=t,o.numColumns=t;var a=document.createElement("canvas");a.height=o.numRows,a.width=o.numColumns;for(var s=a.getContext("2d",{willReadFrequently:!0}),l=e,c=-(t-1)/2,u=c+t,p=c;p<u;p++)for(var d=c;d<u;d++){var f=new i.Shape.Rectangle({point:[d*l,p*l],size:[l,l],strokeWidth:.5,strokeColor:"white",fillColor:"white",rescale:{position:[d*l,p*l],size:[l,l],strokeWidth:.5}});o.addChild(f),0==d&&0==p&&(o.centerCell=f)}d=0,p=0;var h=new i.Shape.Rectangle({point:[d*l,p*l],size:[l,l],strokeWidth:1,strokeColor:"black",fillColor:null,rescale:{position:[d*l,p*l],size:[l,l],strokeWidth:1}});o.addChild(h),d=0,p=0;var y=e*(t+2),v=new i.Shape.Rectangle({point:[d*l,p*l],size:[y,y],strokeWidth:1,strokeColor:"black",fillColor:null,rescale:{position:[d*l,p*l],size:[y,y],strokeWidth:1}});return o.addChild(v),o.borderElement=v,v.sendToBack(),o.applyRescale=function(){o.children.forEach((function(e){return e.applyRescale()}))},o.view.getFlipped()&&r(),this.updatePosition=function(e){var t=this;o.position=e;var n=o.project.overlay.paperToCanvasCoordinates(e.x,e.y),r=Math.round(n.x)-Math.floor(o.numColumns/2),i=Math.round(n.y)-Math.floor(o.numRows/2),a=o.numColumns,l=o.numRows,c=o.view.pixelRatio,u=o.project.overlay.getImageData(r*c,i*c,a*c,l*c);s.clearRect(0,0,a,l),window.createImageBitmap(u).then((function(e){s.drawImage(e,0,0,o.numColumns,o.numRows);var n,r,i=s.getImageData(0,0,a,l);for(n=0,r=1;n<i.data.length;n+=4,r+=1)o.children[r].fillColor.red=i.data[n]/255,o.children[r].fillColor.green=i.data[n+1]/255,o.children[r].fillColor.blue=i.data[n+2]/255;o.borderElement.fillColor=o.centerCell.fillColor,t.selectedColor=o.centerCell.fillColor}))},this}function Ee(e){return Pe.apply(this,arguments)}function Pe(){var e;return e=fe().mark((function e(t){var n;return fe().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=(t.project&&t.project.overlay||t.overlay).getViewportRaster(),e.abrupt("return",new Promise((function(e,o){n.onLoad=function(){var r=t.clone();r.transform(r.layer.matrix);var i=n.getAverageColor(r);n.remove(),r.remove(),i||o("Error: The item must be visible on the screen to pick the average color of visible pixels. Please navigate and retry."),e(i)}})));case 2:case"end":return e.stop()}}),e)})),Pe=function(){var t=this,n=arguments;return new Promise((function(o,r){var i=e.apply(t,n);function a(e){he(i,o,r,a,s,"next",e)}function s(e){he(i,o,r,a,s,"throw",e)}a(void 0)}))},Pe.apply(this,arguments)}function _e(e){return e=e.replace("#",""),(299*parseInt(e.substr(0,2),16)+587*parseInt(e.substr(2,2),16)+114*parseInt(e.substr(4,2),16))/1e3>=140?"black":"white"}function xe(e){return xe="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},xe(e)}function Te(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,Be(o.key),o)}}function je(e,t,n){return t&&Te(e.prototype,t),n&&Te(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function Be(e){var t=function(e){if("object"!=xe(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=xe(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==xe(t)?t:t+""}var Le=je((function e(t){if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.width=t.width,this.height=t.height,this.data=new Uint8Array(t.data),this.data){if(this.height*this.width!=this.data.length)throw"MORPH_DIMENSION_ERROR: incorrect dimensions"}else this.data=Array(this.width*this.height).fill(0);this.dilate=function(){for(var e=Array.from(this.data),t=this.width,n=this.height,o=0;o<n;o++)for(var r=0;r<t;r++){var i=o*t+r;this.data[i]=e[i]?e[i]:this.adjacentIndices(i).some((function(t){return e[t]}))?1:0}return{width:this.width,height:this.height,data:this.data}},this.addBorder=function(){this.width=this.width+2,this.height=this.height+2;var e=this.data;this.data=new Uint8Array(this.width*this.height).fill(0);for(var t=1;t<this.height-1;t++)for(var n=1;n<this.width-1;n++)this.data[t*this.width+n]=e[(t-1)*(this.width-2)+(n-1)];return{width:this.width,height:this.height,data:this.data}},this.adjacentIndices=function(e){var t=e-this.width-1,n=e+this.width-1,o=this.data.length;return[t,t+1,t+2,e-1,e+1,n,n+1,n+2].filter((function(e){return e>=0&&e<o}))}}));function Me(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var o,r,i,a,s=[],l=!0,c=!1;try{if(i=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;l=!1}else for(;!(l=(o=i.call(n)).done)&&(s.push(o.value),s.length!==t);l=!0);}catch(e){c=!0,r=e}finally{try{if(!l&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(c)throw r}}return s}}(e,t)||function(e,t){if(e){if("string"==typeof e)return Re(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Re(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Re(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,o=Array(t);n<t;n++)o[n]=e[n];return o}function Ne(e){return Ne="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Ne(e)}function Fe(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,De(o.key),o)}}function De(e){var t=function(e){if("object"!=Ne(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=Ne(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==Ne(t)?t:t+""}var Ge=new(function(){return e=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._map=new WeakMap},t=[{key:"set",value:function(e,t,n){if(this._map.has(e)||this._map.set(e,new Map),"object"===Ne(t))for(var o=t,r=this._map.get(e),i=0,a=Object.entries(o);i<a.length;i++){var s=Me(a[i],2),l=s[0],c=s[1];r.set(l,c)}else this._map.get(e).set(t,n)}},{key:"get",value:function(e,t){if(this._map.has(e))return void 0===t?Object.fromEntries(this._map.get(e)):this._map.get(e).get(t);this._map.set(e,new Map)}},{key:"remove",value:function(e,t){if(this._map.has(e)){var n=this._map.get(e).delete(t);return 0===this._map.get(e).size&&this._map.delete(e),n}}}],t&&Fe(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t}());function ze(e){return ze="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ze(e)}function He(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Ue(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,Ve(o.key),o)}}function We(e,t,n){return t&&Ue(e.prototype,t),n&&Ue(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function Ve(e){var t=function(e){if("object"!=ze(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=ze(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==ze(t)?t:t+""}function Ye(e,t,n){return t=Je(t),function(e,t){if(t&&("object"==ze(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,qe()?Reflect.construct(t,n||[],Je(e).constructor):t.apply(e,n))}function qe(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(qe=function(){return!!e})()}function Je(e){return Je=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},Je(e)}function Ze(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Xe(e,t)}function Xe(e,t){return Xe=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},Xe(e,t)}var Ke=function(){function e(t){var n;He(this,e);var o,r=n=Ye(this,e,[t]),a=n.tool;n.paperScope=r.project.paperScope,n.reduceMode=!1,n.replaceMode=!0,n.floodMode=!0,n.colors={pixelAllowed:new i.Color({red:0,green:0,blue:100}),pixelNotAllowed:new i.Color({red:100,green:0,blue:0}),currentItem:new i.Color({red:0,green:100,blue:0,alpha:.5}),nullColor:new i.Color({red:0,green:0,blue:0,alpha:0}),defaultColor:new i.Color({red:255,green:255,blue:255})},n.threshold=10,n.minThreshold=-1,n.maxThreshold=100,n.startThreshold=10,n.colorPicker=new Oe(10,7,r.project.toolLayer),n.colorPicker.element.applyRescale(),n.MagicWand=(o={floodFill:function(e,t,n,o,r,i){return i?function(e,t,n,o,r){var i,a,s,l,c,u,p,d,f,h,y=e.data,v=e.width,m=e.height,g=e.bytes,b=-1,w=v+1,A=-1,C=m+1,S=n*v+t,I=new Uint8Array(v*m),k=new Uint8Array(r||v*m);if(1===k[S])return null;var O=[y[S*=g],y[S+1],y[S+2],y[S+3]],E=[{y:n,left:t-1,right:t+1,dir:1}];do{for(h=!1,a=(l=E.shift()).left+1;a<l.right;a++)if(S=((p=l.y*v)+a)*g,1!==k[p+a]&&(h=!0,I[p+a]=1,k[p+a]=1,!((i=y[S]-O[0])>o||i<-o||(i=y[S+1]-O[1])>o||i<-o||(i=y[S+2]-O[2])>o||i<-o||0===y[S+3]))){for(u=a-1;u>-1&&(S=(d=p+u)*g,1!==k[d])&&(I[d]=1,k[d]=1,u--,!((i=y[S]-O[0])>o||i<-o))&&!((i=y[S+1]-O[1])>o||i<-o)&&!((i=y[S+2]-O[2])>o||i<-o)&&0!==y[S+3];);for(c=a+1;c<v&&(S=(f=p+c)*g,1!==k[f])&&(I[f]=1,k[f]=1,c++,!((i=y[S]-O[0])>o||i<-o))&&!((i=y[S+1]-O[1])>o||i<-o)&&!((i=y[S+2]-O[2])>o||i<-o)&&0!==y[S+3];);u<w&&(w=u+1),c>b&&(b=c-1),(s=l.y-l.dir)>=0&&s<m&&(u<l.left&&E.push({y:s,left:u,right:l.left,dir:-l.dir}),l.right<c&&E.push({y:s,left:l.right,right:c,dir:-l.dir})),(s=l.y+l.dir)>=0&&s<m&&u<c&&E.push({y:s,left:u,right:c,dir:l.dir})}h&&(l.y<C&&(C=l.y),l.y>A&&(A=l.y))}while(E.length>0);return{data:I,width:e.width,height:e.height,bounds:{minX:w,minY:C,maxX:b,maxY:A},sampleColor:O}}(e,t,n,o,r):function(e,t,n,o,r){var i,a,s,l,c,u,p,d,f,h,y=e.data,v=e.width,m=e.height,g=e.bytes,b=-1,w=v+1,A=-1,C=m+1,S=n*v+t,I=new Uint8Array(v*m),k=new Uint8Array(r||v*m);if(1===k[S])return null;var O=[y[S*=g],y[S+1],y[S+2],y[S+3]],E=[{y:n,left:t-1,right:t+1,dir:1}];do{for(h=!1,a=(l=E.shift()).left+1;a<l.right;a++)if(S=((p=l.y*v)+a)*g,1!==k[p+a]&&!((i=y[S]-O[0])>o||i<-o||(i=y[S+1]-O[1])>o||i<-o||(i=y[S+2]-O[2])>o||i<-o||0===y[S+3])){for(h=!0,I[p+a]=1,k[p+a]=1,u=a-1;u>-1&&(S=(d=p+u)*g,1!==k[d])&&!((i=y[S]-O[0])>o||i<-o)&&!((i=y[S+1]-O[1])>o||i<-o)&&!((i=y[S+2]-O[2])>o||i<-o)&&0!==y[S+3];)I[d]=1,k[d]=1,u--;for(c=a+1;c<v&&(S=(f=p+c)*g,1!==k[f])&&!((i=y[S]-O[0])>o||i<-o)&&!((i=y[S+1]-O[1])>o||i<-o)&&!((i=y[S+2]-O[2])>o||i<-o)&&0!==y[S+3];)I[f]=1,k[f]=1,c++;u<w&&(w=u+1),c>b&&(b=c-1),(s=l.y-l.dir)>=0&&s<m&&(u<l.left&&E.push({y:s,left:u,right:l.left,dir:-l.dir}),l.right<c&&E.push({y:s,left:l.right,right:c,dir:-l.dir})),(s=l.y+l.dir)>=0&&s<m&&u<c&&E.push({y:s,left:u,right:c,dir:l.dir})}h&&(l.y<C&&(C=l.y),l.y>A&&(A=l.y))}while(E.length>0);return{data:I,width:e.width,height:e.height,bounds:{minX:w,minY:C,maxX:b,maxY:A},sampleColor:O}}(e,t,n,o,r)},thresholdMask:function(e,t,n,o){var r,i,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{},s=e.data,l=e.width,c=e.height,u=e.bytes,p=n*l+t,d=new Uint8Array(a.append?a.append:l*c),f=new Uint8Array(a.ignore?a.ignore:l*c);if(1===f[p])return null;var h=[s[p*=u],s[p+1],s[p+2],s[p+3]];for(p=0,i=0;p<s.length;p+=4,i+=1)f[i]||d[i]||0!==s[p+3]&&((r=s[p]-h[0])>o||r<-o||(r=s[p+1]-h[1])>o||r<-o||(r=s[p+2]-h[2])>o||r<-o||(d[i]=1));return{data:d,width:e.width,height:e.height,bounds:{minX:0,minY:0,maxX:l,maxY:c},sampleColor:h}},gaussBlur:function(e,t){var n,o,r,i,a,s,l,c=2*t+1,u=t*t,p=new Float32Array(c),d=0,f=e.width,h=e.height,y=e.data,v=e.bounds.minX,m=e.bounds.maxX,g=e.bounds.minY,b=e.bounds.maxY;for(n=0;n<t;n++){var w=(t-n)*(t-n),A=Math.exp(-w/(2*u))/(2*Math.PI*u);p[t+n]=p[t-n]=A,d+=2*A}for(n=0;n<c;n++)p[n]/=d;var C=new Uint8Array(f*h),S=t+f,I=t+h;for(a=g;a<b+1;a++)for(i=v;i<m+1;i++){for(s=0,l=S-i<c?S-i:c,r=(o=a*f+i)-t,n=t-i>0?t-i:0;n<l;n++)s+=y[r+n]*p[n];for(l=I-a<c?I-a:c,r=o-t*f,n=t-a>0?t-a:0;n<l;n++)s+=y[r+n*f]*p[n];C[o]=s>.5?1:0}return{data:C,width:f,height:h,bounds:{minX:v,minY:g,maxX:m,maxY:b}}},gaussBlurOnlyBorder:function(e,t,n){var o,r,i,a,s,l,c,u,p,d,f=function(e,t,n){var o,r,i,a,s,l,c,u=e.width,p=e.height,d=e.data,f=new Uint8Array(d),h=e.bounds.minX,y=e.bounds.maxX,v=e.bounds.minY,m=e.bounds.maxY,g=u*p,b=new Uint8Array(g),w=[],A=Math.max(h,1),C=Math.min(y,u-2),S=Math.max(v,1),I=Math.min(m,p-2);if(n&&n.length>0)for(s=0;s<g;s++)1===n[s]&&(f[s]=1);for(a=S;a<I+1;a++)for(o=A;o<C+1;o++)0!==d[s=a*u+o]&&(l=s+u,c=s-u,0!==f[s+1]&&0!==f[s-1]&&0!==f[l]&&0!==f[l+1]&&0!==f[l-1]&&0!==f[c]&&0!==f[c+1]&&0!==f[c-1]||w.push(s));if(0==h)for(a=v;a<m+1;a++)1===d[a*u]&&w.push(a*u);if(y==u-1)for(a=v;a<m+1;a++)1===d[a*u+y]&&w.push(a*u+y);if(0==v)for(o=h;o<y+1;o++)1===d[o]&&w.push(o);if(m==p-1)for(o=h;o<y+1;o++)1===d[m*u+o]&&w.push(m*u+o);var k,O=[],E=t+u,P=t+p,_=2*t+1;for(g=w.length,i=0;i<g;i++){for(b[s=w[i]]=1,O.push(s),a=(s-(o=s%u))/u,k=E-o<_?E-o:_,l=s-t,r=t-o>0?t-o:0;r<k;r++)0===b[c=l+r]&&(b[c]=1,O.push(c));for(k=P-a<_?P-a:_,l=s-t*u,r=t-a>0?t-a:0;r<k;r++)0===b[c=l+r*u]&&(b[c]=1,O.push(c))}return O}(e,t,n),h=2*t+1,y=2*t*t,v=new Float32Array(h),m=0,g=e.width,b=e.height,w=e.data,A=e.bounds.minX,C=e.bounds.maxX,S=e.bounds.minY,I=e.bounds.maxY,k=f.length;for(i=0;i<t;i++)r=(t-i)*(t-i),o=Math.exp(-r/y)/Math.PI,v[t+i]=v[t-i]=o,m+=2*o;for(i=0;i<h;i++)v[i]/=m;var O=new Uint8Array(w),E=t+g,P=t+b;for(i=0;i<k;i++){for(p=0,u=((s=f[i])-(c=s%g))/g,d=E-c<h?E-c:h,l=s-t,a=t-c>0?t-c:0;a<d;a++)p+=w[l+a]*v[a];if(p>.5)O[s]=1,c<A&&(A=c),c>C&&(C=c),u<S&&(S=u),u>I&&(I=u);else{for(d=P-u<h?P-u:h,l=s-t*g,a=t-u>0?t-u:0;a<d;a++)p+=w[l+a*g]*v[a];p>.5?(O[s]=1,c<A&&(A=c),c>C&&(C=c),u<S&&(S=u),u>I&&(I=u)):O[s]=0}}return{data:O,width:g,height:b,bounds:{minX:A,minY:S,maxX:C,maxY:I}}},createBorderMask:function(e){var t,n,o,r,i,a=e.width,s=e.height,l=e.data,c=e.bounds.minX,u=e.bounds.maxX,p=e.bounds.minY,d=e.bounds.maxY,f=u-c+1,h=d-p+1,y=new Uint8Array(f*h),v=Math.max(c,1),m=Math.min(u,a-2),g=Math.max(p,1),b=Math.min(d,s-2);for(n=g;n<b+1;n++)for(t=v;t<m+1;t++)0!==l[o=n*a+t]&&(r=o+a,i=o-a,0!==l[o+1]&&0!==l[o-1]&&0!==l[r]&&0!==l[r+1]&&0!==l[r-1]&&0!==l[i]&&0!==l[i+1]&&0!==l[i-1]||(y[(n-p)*f+(t-c)]=1));if(0==c)for(n=p;n<d+1;n++)1===l[n*a]&&(y[(n-p)*f]=1);if(u==a-1)for(n=p;n<d+1;n++)1===l[n*a+u]&&(y[(n-p)*f+(u-c)]=1);if(0==p)for(t=c;t<u+1;t++)1===l[t]&&(y[t-c]=1);if(d==s-1)for(t=c;t<u+1;t++)1===l[d*a+t]&&(y[(d-p)*f+(t-c)]=1);return{data:y,width:f,height:h,offset:{x:c,y:p}}},getBorderIndices:function(e){var t,n,o,r,i,a=e.width,s=e.height,l=e.data,c=[],u=a-1,p=s-1;for(n=1;n<p;n++)for(t=1;t<u;t++)0!==l[o=n*a+t]&&(r=o+a,i=o-a,0!==l[o+1]&&0!==l[o-1]&&0!==l[r]&&0!==l[r+1]&&0!==l[r-1]&&0!==l[i]&&0!==l[i+1]&&0!==l[i-1]||c.push(o));for(n=0;n<s;n++)1===l[n*a]&&c.push(n*a);for(t=0;t<a;t++)1===l[t]&&c.push(t);for(o=a-1,n=0;n<s;n++)1===l[n*a+o]&&c.push(n*a+o);for(o=(s-1)*a,t=0;t<a;t++)1===l[o+t]&&c.push(o+t);return c},traceContours:function(e){var t,n,o,r,i,a,s,l,c,u,p,d,f,h,y,v=function(e){var t,n,o=e.width,r=e.data,i=e.bounds.minX,a=e.bounds.maxX,s=e.bounds.minY,l=e.bounds.maxY,c=a-i+3,u=l-s+3,p=new Uint8Array(c*u);for(n=s;n<l+1;n++)for(t=i;t<a+1;t++)1===r[n*o+t]&&(p[(n-s+1)*c+(t-i+1)]=1);return{data:p,width:c,height:u,offset:{x:i-1,y:s-1}}}(e),m=[],g=0,b=v.width,w=2*b,A=v.height,C=v.data,S=v.offset.x,I=v.offset.y,k=new Uint8Array(C),O=[[1,0],[1,1],[0,1],[-1,1],[-1,0],[-1,-1],[0,-1],[1,-1]];for(r=1;r<A-1;r++)for(o=1;o<b-1;o++)if(1===C[i=r*b+o])for(t=-b;t<w;t+=w)if(0===C[i+t]&&0===k[i+t]){for(g++,s=[],c=(l=t===b)?2:6,d=f=u={x:o,y:r},p=null;;){for(k[d.y*b+d.x]=g,n=0;n<8;n++){if(y=O[c=(c+1)%8],1===C[a=(h={x:d.x+y[0],y:d.y+y[1]}).y*b+h.x]){k[a]=g;break}k[a]=-1,h=null}if(null===h)break;if(d=h,p){if(f.x===u.x&&f.y===u.y&&d.x===p.x&&d.y===p.y)break}else p=h;s.push({x:f.x+S,y:f.y+I}),f=d,c=(c+4)%8}null!=h&&(s.push({x:u.x+S,y:u.y+I}),m.push({inner:l,label:g,points:s}))}return m},simplifyContours:function(e,t,n){var o,r,i,a,s,l,c,u,p,d,f,h,y,v,m,g,b,w,A,C,S,I=e.length,k=[];for(r=0;r<I;r++)if(s=(a=e[r]).points,(l=a.points.length)<n){for(c=[],i=0;i<l;i++)c.push({x:s[i].x,y:s[i].y});k.push({inner:a.inner,label:a.label,points:c,initialCount:l})}else{u=[0,l-1],p=[{first:0,last:l-1}];do{if(!((d=p.shift()).last<=d.first+1)){for(f=-1,h=d.first,o=d.first+1;o<d.last;o++)A=s[o],C=s[d.first],S=s[d.last],b=A.x-C.x,w=A.y-C.y,v=Math.sqrt(b*b+w*w),b=A.x-S.x,w=A.y-S.y,m=Math.sqrt(b*b+w*w),b=C.x-S.x,w=C.y-S.y,g=Math.sqrt(b*b+w*w),(y=v>=Math.sqrt(m*m+g*g)?m:m>=Math.sqrt(v*v+g*g)?v:Math.abs((w*A.x-b*A.y+C.x*S.y-S.x*C.y)/g))>f&&(h=o,f=y);f>t&&(u.push(h),p.push({first:d.first,last:h}),p.push({first:h,last:d.last}))}}while(p.length>0);for(c=[],l=u.length,u.sort((function(e,t){return e-t})),i=0;i<l;i++)c.push({x:s[u[i]].x,y:s[u[i]].y});k.push({inner:a.inner,label:a.label,points:c,initialCount:a.points.length})}return k}},o),n.setToolbarControl(new Qe(n)),n.toolbarControl.setThreshold(n.threshold);var s=function(){r.getImageData()};return n.onSelectionChanged=s,n.extensions.onActivate=function(){var e=r.item||r.itemToCreate;r.itemLayer=e?e.layer:null,r.getImageData(),r.project.overlay.viewer.addHandler("animation-finish",s),r.project.overlay.viewer.addHandler("rotate",s),r.colorPicker.element.visible=!0,r.project.toolLayer.bringToFront()},n.extensions.onDeactivate=function(e){r.project.overlay.viewer.removeHandler("animation-finish",s),r.project.overlay.viewer.removeHandler("rotate",s),r.colorPicker.element.visible=!1,this.preview&&this.preview.remove(),e&&r.finish(),r.project.toolLayer.sendToBack()},a.extensions.onKeyUp=function(e){"a"==e.key&&r.applyChanges(),"e"==e.key&&r.toolbarControl.cycleReduceMode(),"r"==e.key&&r.toolbarControl.cycleReplaceMode(),"f"==e.key&&r.toolbarControl.cycleFloodMode()},n}return Ze(e,G),We(e,[{key:"onMouseDown",value:function(e){this.startThreshold=this.threshold,this.imageData.dragStartMask=this.imageData.binaryMask,this.applyMagicWand(e.original.point),this.colorPicker.element.visible=!1}},{key:"onMouseDrag",value:function(e){var t=e.original.point.subtract(e.original.downPoint).multiply(this.project.getZoom());this.reduceMode&&(t=t.multiply(-1));var n=Math.round((t.x+-1*t.y)/2);this.threshold=Math.min(Math.max(this.startThreshold+n,this.minThreshold),this.maxThreshold),Number.isNaN(this.threshold)&&console.warn("NaN value for threshold"),this.toolbarControl.setThreshold(this.threshold),this.applyMagicWand(e.original.downPoint)}},{key:"onMouseMove",value:function(e){this.colorPicker.updatePosition(e.original.point)}},{key:"onMouseUp",value:function(e){this.colorPicker.element.visible=!0,this.colorPicker.element.bringToFront(),this.colorPicker.updatePosition(e.original.point)}},{key:"finish",value:function(){this.itemLayer=null,this.preview&&this.preview.remove(),this.deactivate()}},{key:"setThreshold",value:function(e){this.threshold=parseInt(e)}},{key:"setReduceMode",value:function(e){this.reduceMode=e,this.getImageData()}},{key:"setFloodMode",value:function(e){this.floodMode=e}},{key:"setReplaceMode",value:function(e){this.replaceMode=e}},{key:"applyChanges",value:function(){this.itemToCreate&&(this.itemToCreate.initializeGeoJSONFeature("MultiPolygon"),this.refreshItems());var e={width:this.imageData.width,height:this.imageData.height,data:this.imageData.wandMask,bounds:{minX:0,minY:0,maxX:this.preview.width,maxY:this.preview.height}};if(this.reduceMode){var t=$e(this.MagicWand,e);t.translate(-1,-1),t.translate(-this.preview.width/2,-this.preview.height/2),t.matrix=this.preview.matrix,t.transform(this.item.layer.matrix.inverted());var n=this.item.subtract(t,!1).toCompoundPath();t.remove(),this.item.children=n.children}else{var o=$e(this.MagicWand,e);o.translate(-1,-1),o.translate(-this.preview.width/2,-this.preview.height/2),o.matrix=this.preview.matrix,o.transform(this.item.layer.matrix.inverted());var r=this.itemLayer?this.itemLayer.getItems({match:function(e){return e.isBoundingElement}}):[];r.length>0&&(o.children=r.map((function(e){return e.intersect(o)})));var i=this.item.unite(o,!1).toCompoundPath();o.remove(),this.item.children=i.children}this.getImageData()}},{key:"getImageData",value:function(){var e=this,t=e.project.overlay.getImageData(),n=new i.Group({children:[],insert:!1}),o=e.tool.view.bounds,r=new i.Path(o.topLeft,o.topRight,o.bottomRight,o.bottomLeft);r.strokeWidth=0,n.addChild(r.clone()),n.addChild(r),n.clipped=!0;var a=this.itemLayer?this.itemLayer.getItems({match:function(e){return e.isBoundingElement}}):[];if(r.fillColor=0==a.length?e.colors.pixelAllowed:e.colors.pixelNotAllowed,a.forEach((function(t){var o=t.clone({insert:!1});o.transform(e.item.layer.matrix),o.fillColor=e.colors.pixelAllowed,o.strokeWidth=0,n.addChild(o)})),e.item){var s=e.item.clone({insert:!1});s.transform(e.item.layer.matrix),s.fillColor=e.colors.currentItem,s.strokeWidth=0,s.selected=!1,n.addChild(s)}n.selected=!1;var l=e.project.paperScope.project.getItems({match:function(e){return e.isGeoJSONFeatureCollection}}),c=l.map((function(e){return e.visible}));l.forEach((function(e){return e.visible=!1})),e.project.toolLayer.addChild(n),e.tool.view.update();var u=e.tool.view.getImageData();n.remove(),l.forEach((function(e,t){return e.visible=c[t]})),e.tool.view.update(),e.imageData={width:t.width,height:t.height,bytes:4,data:t.data,binaryMask:new Uint8ClampedArray(t.width*t.height),wandMask:new Uint8ClampedArray(t.width*t.height),colorMask:u};for(var p=0,d=0;p<e.imageData.data.length;p+=e.imageData.bytes,d+=1)e.imageData.binaryMask[d]=e.imageData.colorMask.data[p+1]?1:0;e.item&&e.item.isGeoJSONFeature&&e.item.getArea()?Ee(e.item).then((function(t){var n=[255*t.red,255*t.green,255*t.blue];e.imageData.sampleColor=n,e.rasterPreview(e.imageData.binaryMask,n)})):e.rasterPreview(e.imageData.binaryMask)}},{key:"applyMagicWand",value:function(e){var t,n=this.paperScope.view.projectToView(e),o=this.paperScope.view.pixelRatio;n=n.multiply(o),t=this.floodMode?this.MagicWand.floodFill(this.imageData,Math.round(n.x),Math.round(n.y),this.threshold):this.MagicWand.thresholdMask(this.imageData,Math.round(n.x),Math.round(n.y),this.threshold);var r=this.imageData.binaryMask,i=this.imageData.wandMask,a=this.imageData.dragStartMask,s=this.imageData.colorMask.data,l=t.data;if(this.replaceMode&&!this.reduceMode)for(var c=0,u=0;c<s.length;c+=this.imageData.bytes,u+=1)r[u]=s[c+1]>0||0==s[c]&&l[u],i[u]=l[u];else if(this.replaceMode&&this.reduceMode)for(var p=0,d=0;p<s.length;p+=this.imageData.bytes,d+=1)r[d]=s[p+1]>0&&!(0==s[p]&&l[d]),i[d]=l[d];else if(this.replaceMode||this.reduceMode){if(!this.replaceMode&&this.reduceMode)for(var f=0,h=0;f<s.length;f+=this.imageData.bytes,h+=1)r[h]=a[h]&&!(0==s[f]&&l[h]),i[h]=i[h]||l[h]}else for(var y=0,v=0;y<s.length;y+=this.imageData.bytes,v+=1)r[v]=a[v]||0==s[y]&&l[v],i[v]=i[v]||l[v];this.rasterPreview(this.imageData.binaryMask,this.imageData.sampleColor||t.sampleColor)}},{key:"rasterPreview",value:function(e,t){var n,o=this,r={0:this.colors.nullColor,1:this.colors.defaultColor};t&&(r[1]=new i.Color(t[0],t[1],t[2]),r[1].hue+=180,r[1].brightness=(180+r[1].brightness)%360),this.preview&&this.preview.remove(),this.preview=this.project.paperScope.overlay.getViewportRaster(!1),window.preview=this.preview,this.project.toolLayer.insertChild(0,this.preview);for(var a=this.preview.createImageData(this.preview.size),s=0,l=0;s<a.data.length;s+=4,l+=1)n=r[e[l]],a.data[s]=n.red,a.data[s+1]=n.blue,a.data[s+2]=n.green,a.data[s+3]=255*n.alpha;function c(){o.preview.tweenTo({opacity:.15},{duration:1200,easing:"easeInQuart"}).then(u)}function u(){o.preview.tweenTo({opacity:1},{duration:800,easing:"easeOutCubic"}).then(c)}this.preview.setImageData(a,new i.Point(0,0)),c()}}])}(),Qe=function(){function e(t){var n;He(this,e),n=Ye(this,e,[t]);var o=Q("fa-wand-magic-sparkles");o.classList.add("rotate-by"),o.style.setProperty("--rotate-angle","270deg"),n.button.configure(o,"Magic Wand Tool");var r=document.createElement("div");r.classList.add("wand-toolbar","dropdown"),r.setAttribute("data-tool","wand"),n.dropdown.appendChild(r);var i=document.createElement("div");i.classList.add("threshold-container"),r.appendChild(i);var a=document.createElement("label");i.appendChild(a),a.innerHTML="Threshold",n.thresholdInput=document.createElement("input"),i.appendChild(n.thresholdInput),Object.assign(n.thresholdInput,{type:"range",min:-1,max:100,value:20}),n.thresholdInput.onchange=function(){t.setThreshold(this.value)};var s=document.createElement("div");s.classList.add("toggles"),r.appendChild(s);var l=n.cycleReplaceModeButton=document.createElement("span");l.classList.add("option-toggle"),s.appendChild(l),Ge.set(l,{prefix:"On click:",actions:[{replace:"Start new mask"},{append:"Add to current"}],onclick:function(e){t.setReplaceMode("replace"==e)}});var c=n.cycleFloodModeButton=document.createElement("span");c.classList.add("option-toggle"),s.appendChild(c),Ge.set(c,{prefix:"Fill rule:",actions:[{flood:"Contiguous"},{everywhere:"Anywhere"}],onclick:function(e){t.setFloodMode("flood"==e)}});var u=n.cycleReduceModeButton=document.createElement("span");u.classList.add("option-toggle"),s.appendChild(u),Ge.set(u,{prefix:"Use to:",actions:[{expand:"Expand selection"},{reduce:"Reduce selection"}],onclick:function(e){t.setReduceMode("reduce"==e)}}),[l,c,u].forEach((function(e){var t=Ge.get(e),n=document.createElement("span");n.classList.add("label","prefix"),n.innerHTML=t.prefix,e.appendChild(n),t.actions.forEach((function(t,n){var o=Object.values(t)[0],r=Object.keys(t)[0],i=document.createElement("span");i.classList.add("option"),i.innerHTML=o,e.appendChild(i),Ge.set(i,{key:r,index:n}),t.htmlElement=i,t.key=r,0==n&&i.classList.add("selected")})),e.addEventListener("click",(function(){var e,t=Ge.get(this),n=t.actions,o=this.querySelector(".option.selected"),r=null===(e=Ge.get(o))||void 0===e?void 0:e.index,i=void 0===r?0:(r+1)%n.length;this.querySelectorAll(".option").forEach((function(e){return e.classList.remove("selected")}));var a=n[i];a.htmlElement.classList.add("selected"),t.onclick(a.key)}))}));var p=document.createElement("button");p.classList.add("btn","btn-secondary","btn-sm"),p.setAttribute("data-action","apply"),r.appendChild(p),p.innerHTML="Apply",p.onclick=function(){t.applyChanges()};var d=document.createElement("button");return d.classList.add("btn","btn-secondary","btn-sm"),d.setAttribute("data-action","done"),r.appendChild(d),d.innerHTML="Done",d.onclick=function(){t.finish()},n}return Ze(e,z),We(e,[{key:"isEnabledForMode",value:function(e){return["new","Polygon","MultiPolygon"].includes(e)}},{key:"setThreshold",value:function(e){this.thresholdInput.value=e}},{key:"cycleReduceMode",value:function(){this.cycleReduceModeButton.dispatchEvent(new Event("click"))}},{key:"cycleReplaceMode",value:function(){this.cycleReplaceModeButton.dispatchEvent(new Event("click"))}},{key:"cycleFloodMode",value:function(){this.cycleFloodModeButton.dispatchEvent(new Event("click"))}}])}();function $e(e,t,n){var o=new i.CompoundPath({children:[],fillRule:"evenodd",insert:!1});if(t){var r=new Le(t);t=r.addBorder(),"dilate"==n&&r.dilate(),t.bounds={minX:0,minY:0,maxX:t.width,maxY:t.height};var a=e.traceContours(t);o.children=a.map((function(e){var t=e.points.map((function(e){return new i.Point(e)})),n=new i.Path(t,{insert:!1});return n.closed=!0,n})).filter((function(e){if(Math.abs(e.area)>=50)return!0;e.remove()}))}return o}function et(e,t,n,o){var r=e.curve===t,a=t.getNormalAtTime(r?0:1).multiply(o),s=e.point.add(a),l=new i.Segment(s),c=r?"handleOut":"handleIn";return l[c]=e[c].add(n.subtract(a).divide(2)),l}function tt(e,t){var n=new i.Curve(e.segment1.handleOut.add(e.segment1.point),new i.Point(0,0),new i.Point(0,0),e.segment2.handleIn.add(e.segment2.point)).getNormalAtTime(.5).multiply(t),o=et(e.segment1,e,n,t),r=et(e.segment2,e,n,t),a=new i.Curve(o,r);if(0===a.getIntersections(a).length){var s=Math.min(Math.abs(t)/10,1),l=a.getPointAtTime(.5).getDistance(e.getPointAtTime(.5));if(Math.abs(l-Math.abs(t))>s){var c=e.divideAtTime(.5);if(null!=c)return tt(e,t).concat(tt(c,t))}}return[o,r]}function nt(e,t){return e.x*t.y-e.y*t.x}function ot(e,t,n,o,r,a){var s,l,c,u,p,d,f,h,y,v,m,g,b,w,A=new i.Curve(e[0],e[1]),C=new i.Curve(t[0],t[1]),S=A.getIntersections(C),I=e[1].point.getDistance(t[0].point);if(n.isSmooth())t[0].handleOut=t[0].handleOut.project(n.handleOut),t[0].handleIn=e[1].handleIn.project(n.handleIn),t[0].point=e[1].point.add(t[0].point).divide(2),e.pop();else if(0===S.length)if(I>.1*Math.abs(r))switch(o){case"miter":var k=(f=A.point2,h=A.point2.add(A.getTangentAtTime(1)),y=C.point1,v=C.point1.add(C.getTangentAtTime(0)),m=f.subtract(h),g=y.subtract(v),b=nt(f,h),w=nt(y,v),new i.Point(b*g.x-m.x*w,b*g.y-m.y*w).divide(nt(m,g)));Math.max(k.getDistance(A.point2),k.getDistance(C.point1))<Math.abs(r)*a&&e.push(new i.Segment(k));break;case"round":var O=(s=e[1],l=t[0],c=n.point,u=r,p=s.point.subtract(c).add(l.point.subtract(c)).normalize(Math.abs(u)).add(c),d=new i.Path.Arc({from:s.point,to:l.point,through:p,insert:!1}),s.handleOut=d.firstSegment.handleOut,l.handleIn=d.lastSegment.handleIn,3===d.segments.length?d.segments[1]:null);O&&e.push(O)}else t[0].handleIn=e[1].handleIn,e.pop();else{var E=A.divideAt(S[0]);if(E){k=E.segment1;var P=C.divideAt(C.getIntersections(A)[0]);k.handleOut=P?P.segment1.handleOut:t[0].handleOut,e.pop(),t[0]=k}else t[0].handleIn=e[1].handleIn,e.pop()}}function rt(e){return 1===e.children.length&&(e=e.children[0]).remove(),e}function it(e,t){if(void 0===t&&(t=.01),e.closed){var n=Math.abs(e.area*t);if(e.clockwise||e.reverse(),(e=e.unite(e,{insert:!1}))instanceof i.CompoundPath&&(e.children.filter((function(e){return Math.abs(e.area)<n})).forEach((function(e){return e.remove()})),1===e.children.length))return rt(e)}return e}function at(e,t){var n=(e.segments[0].location.offset+e.segments[Math.max(1,Math.floor(e.segments.length/2))].location.offset)/3;return t.getNearestLocation(e.getPointAt(n)).offset<t.getNearestLocation(e.getPointAt(2*n)).offset}function st(e,t,n,o){var r,a;r=function(e,t){var n=e.clone({insert:!1});return n.reduce({}),e.clockwise||(n.reverse(),t=-t),[n,t]}(e,t),a=r[0],t=r[1];for(var s=a.curves.slice().map((function(e){return tt(e,t)})).flat(),l=[],c=0;c<s.length;c+=2)l.push(s.slice(c,c+2));var u=function(e,t,n,o,r){var i=n.segments;if(0==e.length)return n.segments;for(var a=e[0].slice(),s=0;s<e.length-1;++s)ot(e[s],e[s+1],i[s+1],t,o,r);return n.closed&&(ot(e[e.length-1],a,i[0],t,o,r),e[0][0]=a[0]),e}(l,n,a,t,o).flat(),p=function(e){if(e.closed){var t=e.unite(e,{insert:!1});if(t instanceof i.CompoundPath)return t.children.filter((function(t){return!(t.segments.length>1&&at(t,e))})).forEach((function(e){return e.remove()})),rt(t)}return e}(new i.Path({segments:u,insert:!1,closed:e.closed}));return p.reduce({}),a.closed&&(a.clockwise&&t<0||!a.clockwise&&t>0)&&function(e,t){var n=function(e){return e instanceof i.CompoundPath?e.children.map((function(e){return e.segments})).flat():e.segments}(e).slice();n.forEach((function(e){t.contains(e.point)||e.remove()}))}(p,e),a.clockwise!==e.clockwise&&p.reverse(),it(p)}function lt(e,t,n){var o=e.point.add(t.point).divide(2),r=t.point.subtract(e.point).rotate(-90,new i.Point(0,0)).normalize(n),a=o.add(r);return new i.Path.Arc({from:e.point,to:t.point,through:a,insert:!1}).segments}function ct(e,t,n,o,r){var a=st(e,t=e.clockwise?t:-t,n,r),s=st(e,-t,n,r);if(e.closed)return a.subtract(s,{insert:!1});var l=s,c=new Array;s instanceof i.CompoundPath&&((c=s.children.filter((function(e){return e.closed}))).forEach((function(e){return e.remove()})),l=s.children[0]),l.reverse();var u=function(e,t,n,o){if(e instanceof i.CompoundPath){var r=e.children.map((function(e){return{c:e,a:Math.abs(e.area)}}));e=(r=r.sort((function(e,t){return t.a-e.a})))[0].c}var a=e.segments.slice(),s=t.segments.slice();if("round"===o){var l=lt(s[s.length-1],a[0],n),c=lt(a[a.length-1],s[0],n),u=new i.Path({segments:l.concat(a,c,s),closed:!0,insert:!1});return u.reduce({}),u}return new i.Path({segments:a.concat(s),closed:!0,insert:!1})}(a,l,t,o);if(c.length>0)for(var p=0,d=c;p<d.length;p++){var f=d[p];u=u.subtract(f,{insert:!1})}return u}function ut(e){return e.closed?e.unite(e,{insert:!1}):e}void 0===i&&console.error("paper-offset.mjs requires paper.js to have been loaded");var pt=function(){function e(){}return e.offset=function(e,t,n){var o=function(e,t,n,o){var r=ut(e),a=r;if(r instanceof i.Path)a=st(r,t,n,o);else{var s=r.children.map((function(r){if(r.segments.length>1){at(r,e)||r.reverse();var a=st(r,t,n,o);return(a=it(a)).clockwise!==r.clockwise&&a.reverse(),a instanceof i.CompoundPath?(a.applyMatrix=!0,a.children):a}return null})).flat().filter((function(e){return!!e}));a=new i.CompoundPath({children:s,insert:!1})}return a.copyAttributes(r,!1),a.remove(),a}(e,t,(n=n||{}).join||"miter",n.limit||10);return void 0===n.insert&&(n.insert=!0),n.insert&&(e.parent||i.project.activeLayer).addChild(o),o},e.offsetStroke=function(e,t,n){var o=function(e,t,n,o,r){var a=ut(e),s=a;return(s=a instanceof i.Path?ct(a,t,n,o,r):a.children.flatMap((function(e){return ct(e,t,n,o,r)})).reduce((function(e,t){return e.unite(t,{insert:!1})}))).strokeWidth=0,s.fillColor=a.strokeColor,s.shadowBlur=a.shadowBlur,s.shadowColor=a.shadowColor,s.shadowOffset=a.shadowOffset,s}(e,t,(n=n||{}).join||"miter",n.cap||"butt",n.limit||10);return void 0===n.insert&&(n.insert=!0),n.insert&&(e.parent||i.project.activeLayer).addChild(o),o},e}();function dt(e){return dt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},dt(e)}function ft(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function ht(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,vt(o.key),o)}}function yt(e,t,n){return t&&ht(e.prototype,t),n&&ht(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function vt(e){var t=function(e){if("object"!=dt(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=dt(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==dt(t)?t:t+""}function mt(e,t,n){return t=bt(t),function(e,t){if(t&&("object"==dt(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,gt()?Reflect.construct(t,n||[],bt(e).constructor):t.apply(e,n))}function gt(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(gt=function(){return!!e})()}function bt(e){return bt=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},bt(e)}function wt(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&At(e,t)}function At(e,t){return At=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},At(e,t)}var Ct=function(){function e(t){var n;ft(this,e);var o=n=mt(this,e,[t]);return n.setToolbarControl(new St(n)),n.eraseMode=!1,n.drawColor=new i.Color("green"),n.eraseColor=new i.Color("red"),n.drawColor.alpha=.5,n.eraseColor.alpha=.5,n.autoSimplify=!1,n.radius=0,n.cursor=new i.Shape.Circle(new i.Point(0,0),n.radius),n.cursor.set({strokeWidth:1,strokeColor:"black",fillColor:n.drawColor,opacity:1,visible:!1}),n.cursor.name="brushtool",n.pathGroup=new i.Group([new i.Path,new i.Path]),o.project.toolLayer.addChild(n.pathGroup),o.project.toolLayer.addChild(n.cursor),n.extensions.onActivate=function(){o.cursor.radius=o.radius/o.project.getZoom(),o.cursor.strokeWidth=1/o.project.getZoom(),o.cursor.visible=!0,o.tool.minDistance=3/o.project.getZoom(),o.tool.maxDistance=10/o.project.getZoom(),o.targetLayer.addChild(o.pathGroup)},n.extensions.onDeactivate=function(e){o.cursor.visible=!1,o.project.toolLayer.addChild(o.pathGroup),e&&o.finish()},n.tool.onMouseWheel=function(e){e.preventDefault(),e.stopPropagation(),0!=e.deltaY&&o.toolbarControl.updateBrushRadius({larger:e.deltaY<0})},n.tool.extensions.onKeyDown=function(e){"e"==e.key&&(!1===o.eraseMode?o.setEraseMode(!0):o.eraseMode="keyhold")},n.tool.extensions.onKeyUp=function(e){"e"==e.key&&"keyhold"==o.eraseMode&&o.setEraseMode(!1)},n}return wt(e,G),yt(e,[{key:"onMouseDown",value:function(e){e.preventDefault(),e.stopPropagation(),this.itemToCreate&&(this.itemToCreate.initializeGeoJSONFeature("MultiPolygon"),this.refreshItems()),this.cursor.position=e.original.point;var t=new i.Path([e.point]);t.mode=this.eraseMode?"erase":"draw",t.radius=this.radius/this.project.getZoom();var n=2*this.cursor.radius/this.targetLayer.scaling.x;this.pathGroup.lastChild.replaceWith(t),this.pathGroup.lastChild.set({strokeWidth:n,fillColor:null,strokeCap:"round"}),"erase"==t.mode?(this.pathGroup.firstChild.fillColor=this.eraseColor,this.pathGroup.lastChild.strokeColor=this.eraseColor):(this.pathGroup.firstChild.fillColor=this.drawColor,this.pathGroup.lastChild.strokeColor=this.drawColor)}},{key:"onMouseUp",value:function(e){this.modifyArea()}},{key:"onMouseMove",value:function(e){this.cursor.position=e.original.point}},{key:"onMouseDrag",value:function(e){this.cursor.position=e.original.point,this.item&&(this.pathGroup.lastChild.add(e.point),this.pathGroup.lastChild.smooth({type:"continuous"}))}},{key:"setRadius",value:function(e){this.radius=e,this.cursor.radius=e/this.project.getZoom()}},{key:"setAutoSimplify",value:function(e){this.autoSimplify=!!e}},{key:"setEraseMode",value:function(e){this.eraseMode=e,this.cursor.fillColor=e?this.eraseColor:this.drawColor,this.toolbarControl.setEraseMode(this.eraseMode)}},{key:"finish",value:function(){this.deactivate()}},{key:"modifyArea",value:function(){var e,t,n=this.pathGroup.lastChild,o=n.radius/this.targetLayer.scaling.x;if(n.segments.length>1?(e=pt.offsetStroke(n,o,{join:"round",cap:"round",insert:!0})).contains(n.segments[0].point)||(console.error("Oops! Bad stroke offset! Trying to correct"),n.segments[0].point.x+=.001,e=pt.offsetStroke(n,o,{join:"round",cap:"round",insert:!0})):e=new i.Path.RegularPolygon({center:n.firstSegment.point,radius:o,sides:360}),e.strokeWidth=1/this.project.getZoom(),e.strokeColor="black",e.fillColor="yellow",e.flatten(),e.name="shapeobject",!this.item.isBoundingElement){var r=this.item.parent.children.filter((function(e){return e.isBoundingElement}));e.applyBounds(r)}if(n.visible=!1,this.autoSimplify&&(e=e.toCompoundPath(),this.doSimplify(e)),t=this.eraseMode?this.item.subtract(e,{insert:!1}):this.item.unite(e,{insert:!1})){var a=(t=t.toCompoundPath()).children.filter((function(e){return e.area>0||Math.abs(e.area)>10}));this.item.removeChildren(),this.item.addChildren(a),t.remove()}e.remove()}}])}(),St=function(){function e(t){var n;ft(this,e),n=mt(this,e,[t]);var o=Q("fa-brush");o.classList.add("rotate-by"),o.style.setProperty("--rotate-angle","225deg"),n.button.configure(o,"Brush Tool");var r=document.createElement("div");r.classList.add("dropdown","brush-toolbar"),r.setAttribute("data-tool","brush"),n.dropdown.appendChild(r);var i=document.createElement("label");return i.innerHTML="Radius",r.appendChild(i),n.rangeInput=document.createElement("input"),r.appendChild(n.rangeInput),Object.assign(n.rangeInput,{type:"range",min:1,max:100,step:1,value:20}),n.rangeInput.addEventListener("change",(function(){t.setRadius(this.value)})),n.eraseButton=document.createElement("button"),r.appendChild(n.eraseButton),n.eraseButton.innerHTML="Eraser",n.eraseButton.setAttribute("data-action","erase"),n.eraseButton.addEventListener("click",(function(){var e=this.classList.toggle("active");t.setEraseMode(e)})),setTimeout((function(){return t.setRadius(20)}),0),n}return wt(e,z),yt(e,[{key:"isEnabledForMode",value:function(e){return["new","Polygon","MultiPolygon"].includes(e)}},{key:"updateBrushRadius",value:function(e){e.larger?(this.rangeInput.value=parseInt(this.rangeInput.value)+parseInt(this.rangeInput.step),this.rangeInput.dispatchEvent(new Event("change"))):(this.rangeInput.value=parseInt(this.rangeInput.value)-parseInt(this.rangeInput.step),this.rangeInput.dispatchEvent(new Event("change")))}},{key:"setEraseMode",value:function(e){e?this.eraseButton.classList.add("active"):this.eraseButton.classList.remove("active")}}])}();function It(e){return It="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},It(e)}function kt(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function Ot(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?kt(Object(n),!0).forEach((function(t){Et(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):kt(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Et(e,t,n){return(t=Tt(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Pt(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _t(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,Tt(o.key),o)}}function xt(e,t,n){return t&&_t(e.prototype,t),n&&_t(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function Tt(e){var t=function(e){if("object"!=It(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=It(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==It(t)?t:t+""}var jt=function(){return xt((function e(t){var n;if(Pt(this,e),!1===Bt.includes((null===(n=t.geometry)||void 0===n?void 0:n.type)||t.geometry))throw"Bad GeoJSON Geometry type";this._paperItem=null,this._props=t.properties||{}}),[{key:"_supportsGeoJSONObj",value:function(e){var t,n;return this.constructor.supportsGeoJSONType(null===(t=e.geometry)||void 0===t?void 0:t.type,null===(n=e.geometry)||void 0===n||null===(n=n.properties)||void 0===n?void 0:n.subtype)}},{key:"getCoordinates",value:function(){return[]}},{key:"getProperties",value:function(){return{}}},{key:"getStyleProperties",value:function(){return this.paperItem.style.toJSON()}},{key:"supportsGeoJSONType",value:function(e,t){return this.constructor.supportsGeoJSONType(e,t)}},{key:"getGeoJSONType",value:function(){return{type:void 0,subtype:void 0}}},{key:"getLabel",value:function(){if(this.paperItem.displayName)return this.paperItem.displayName;var e=this.getGeoJSONType();return e.subtype||e.type}},{key:"type",get:function(){return this.getGeoJSONType().type}},{key:"subtype",get:function(){return this.getGeoJSONType().subtype}},{key:"paperItem",get:function(){return this._paperItem},set:function(e){var t,n,o,r;this._paperItem=e,n=(t=this).paperItem,o=t.constructor,r=t._props,Ia.registerFeature(n),n.onTransform=o.onTransform,t.setStyle(r),n.fillOpacity=n.fillColor?n.fillColor.alpha:1,n.displayName=r.label||t.getLabel(),n.annotationItem=t,n.replaceWith=Rt,"selected"in r&&(n.selected=r.selected)}},{key:"setStyle",value:function(e){this._paperItem&&this._paperItem.style.set(e)}},{key:"toGeoJSONFeature",value:function(){return{type:"Feature",geometry:this.toGeoJSONGeometry(),properties:Ot(Ot({label:this.paperItem.displayName,selected:this.paperItem.selected},this.getStyleProperties()),{},{userdata:this.paperItem.data.userdata})}}},{key:"toGeoJSONGeometry",value:function(){var e={type:this.type,properties:this.getProperties(),coordinates:this.getCoordinates()};return this.subtype&&(e.properties=Object.assign(e.properties,{subtype:this.subtype})),e}}],[{key:"supportsGeoJSONType",value:function(e,t){return!1}},{key:"onTransform",value:function(){}}])}(),Bt=["Point","LineString","Polygon","MultiPoint","MultiLineString","MultiPolygon","GeometryCollection",null],Lt=[],Mt=function(){function e(){Pt(this,e)}return xt(e,null,[{key:"register",value:function(e){if(e.supportsGeoJSONType===jt.supportsGeoJSONType)throw console.error("Static accessor supportsGeoJSONType must be implemented"),"Static accessor supportsGeoJSONType must be implemented";Lt.includes(e)||Lt.push(e)}},{key:"getConstructor",value:function(e){var t,n;if("geometry"in e&&"properties"in e){var o=null===(t=e.geometry)||void 0===t?void 0:t.type,r=null===(n=e.geometry)||void 0===n||null===(n=n.properties)||void 0===n?void 0:n.subtype;return Lt.filter((function(e){return e.supportsGeoJSONType(o,r)})).slice(-1)[0]}console.error("Invalid GeoJSON Feature object. Returning undefined.")}},{key:"itemFromGeoJSON",value:function(t){Bt.includes(t.type)&&(t={type:"Feature",geometry:t,properties:{}});var n=e.getConstructor(t);if(n){var o,r=new n(t);return r.paperItem.data.userdata=null===(o=t.properties)||void 0===o?void 0:o.userdata,r.paperItem}}},{key:"itemFromAnnotationItem",value:function(t){if(t.annotationItem){var n={type:"Feature",geometry:t.annotationItem.toGeoJSONGeometry(),properties:t.annotationItem._props};return e.itemFromGeoJSON(n)}error("Only paper.Items constructed by AnnotationItem implementations are supported")}}])}();function Rt(e){e.isGeoJSONFeature||console.warn("An item with isGeoJSONFeature==false was used to replace an item."),e._callbacks=this._callbacks;var t=r.extend(!0,this.rescale,e.rescale);return e.style=this.style,e.rescale=t,this.emit("item-replaced",{item:e}),e.project.emit("item-replaced",{item:e}),i.Item.prototype.replaceWith.call(this,e),e.selected=this.selected,e.updateFillOpacity(),e.applyRescale(),e.project.view.update(),e}function Nt(e){return Nt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Nt(e)}function Ft(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,o=Array(t);n<t;n++)o[n]=e[n];return o}function Dt(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,Gt(o.key),o)}}function Gt(e){var t=function(e){if("object"!=Nt(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=Nt(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==Nt(t)?t:t+""}function zt(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(zt=function(){return!!e})()}function Ht(e){return Ht=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},Ht(e)}function Ut(e,t){return Ut=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},Ut(e,t)}var Wt=function(){function e(t){var n;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),n=function(e,t,n){return t=Ht(t),function(e,t){if(t&&("object"==Nt(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,zt()?Reflect.construct(t,n||[],Ht(e).constructor):t.apply(e,n))}(this,e,[t]),"Point"!==t.geometry.type&&error('Bad geoJSON object: type !=="Point"');var o=t.geometry.coordinates.slice(0,2),r=new i.Group;r.pivot=new i.Point(0,0),r.applyMatrix=!0;var a=new i.Path.Circle(new i.Point(0,0),6);a.scale(new i.Point(1,.5),new i.Point(0,0)),r.addChild(a);var s=new i.Path.Line(new i.Point(0,0),new i.Point(0,-6));r.addChild(s);var l=new i.Path.Circle(new i.Point(0,-9),3);return r.addChild(l),r.position=function(e,t,n){if(zt())return Reflect.construct.apply(null,arguments);var o=[null];o.push.apply(o,t);var r=new(e.bind.apply(e,o));return n&&Ut(r,n.prototype),r}(i.Point,function(e){return function(e){if(Array.isArray(e))return Ft(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return Ft(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Ft(e,t):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}(o)),r.scaleFactor=r.project._scope.scaleByCurrentZoom(1),r.scale(r.scaleFactor,a.bounds.center),r.rescale=r.rescale||{},r.rescale.size=function(e){r.scale(1/(r.scaleFactor*e)),r.scaleFactor=1/e},r.applyRescale(),n.paperItem=r,n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Ut(e,t)}(e,jt),t=e,o=[{key:"supportsGeoJSONType",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return"point"===e.toLowerCase()&&null===t}},{key:"onTransform",value:function(){switch(arguments[0]){case"rotate":var e=arguments[1],t=arguments[2];this.rotate(-e,t);var n=this.position.subtract(t),o=t.add(n.rotate(e)).subtract(this.position);this.translate(o);break;case"scale":var r=arguments[1],i=arguments[2],a=arguments[3];this.matrix.append(a.inverted());var s=this.pivot.transform(this.matrix).subtract(r),l=s.rotate(-i).multiply(a.scaling).rotate(i).subtract(s);this.translate(l)}}}],(n=[{key:"setStyle",value:function(e){e.rescale=r.extend(!0,e.rescale,this.paperItem.rescale),this.paperItem.style.set(e)}},{key:"getGeoJSONType",value:function(){return{type:"Point"}}},{key:"getCoordinates",value:function(){var e=this.paperItem.children[0];return[e.bounds.center.x,e.bounds.center.y]}},{key:"getStyleProperties",value:function(){return this.paperItem.children[0].style.toJSON()}}])&&Dt(t.prototype,n),o&&Dt(t,o),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,n,o}();function Vt(e){return Vt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Vt(e)}function Yt(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function qt(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,Zt(o.key),o)}}function Jt(e,t,n){return t&&qt(e.prototype,t),n&&qt(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function Zt(e){var t=function(e){if("object"!=Vt(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=Vt(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==Vt(t)?t:t+""}function Xt(e,t,n){return t=Qt(t),function(e,t){if(t&&("object"==Vt(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,Kt()?Reflect.construct(t,n||[],Qt(e).constructor):t.apply(e,n))}function Kt(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(Kt=function(){return!!e})()}function Qt(e){return Qt=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},Qt(e)}function $t(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&en(e,t)}function en(e,t){return en=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},en(e,t)}var tn=function(){function e(t){var n;Yt(this,e),n=Xt(this,e,[t]);var o=new Wt({geometry:{type:"Point",coordinates:[0,0]},properties:{label:"Point Tool"}}).paperItem;return o.visible=!1,delete o.isGeoJSONFeature,n.cursor=o,n.dragging=!1,n.project.toolLayer.addChild(o),n.setToolbarControl(new nn(n)),n.extensions.onActivate=function(){n.project.toolLayer.bringToFront(),n.setCursorProps()},n.extensions.onDeactivate=function(){n.project.toolLayer.sendToBack(),n.cursor.visible=!1,n.project.overlay.removeClass("point-tool-grab","point-tool-grabbing")},n.onSelectionChanged=function(){n.setCursorProps()},n}return $t(e,G),Jt(e,[{key:"setCursorProps",value:function(){this.itemToCreate?(this.cursor.fillColor=this.itemToCreate.fillColor,this.cursor.strokeColor=this.itemToCreate.strokeColor,this.cursor.visible=!0):this.cursor.visible=!1}},{key:"onMouseMove",value:function(e){this.cursor.position=e.original.point,this.item.hitTest(e.point)?this.project.overlay.addClass("point-tool-grab"):this.project.overlay.removeClass("point-tool-grab")}},{key:"onMouseDown",value:function(e){this.itemToCreate?(this.itemToCreate.initializeGeoJSONFeature("Point"),this.refreshItems(),this.item.position=e.point,this.cursor.visible=!1,this.toolbarControl.updateInstructions("Point")):this.item&&this.item.hitTest(e.point)&&(this.dragging=!0,this.project.overlay.addClass("point-tool-grabbing"))}},{key:"onMouseDrag",value:function(e){this.dragging&&this.item&&(this.item.position=this.item.position.add(e.delta))}},{key:"onMouseUp",value:function(){this.dragging=!1,this.project.overlay.removeClass("point-tool-grabbing")}}])}(),nn=function(){function e(t){var n;Yt(this,e),n=Xt(this,e,[t]);var o=Q("fa-map-pin");return n.button.configure(o,"Point Tool"),n.instructions=document.createElement("span"),n.instructions.classList.add("instructions"),n.dropdown.appendChild(n.instructions),n}return $t(e,z),Jt(e,[{key:"isEnabledForMode",value:function(e){return this.updateInstructions(e),["new","Point"].includes(e)}},{key:"updateInstructions",value:function(e){var t="new"==e?"Click to drop a pin":"Point"==e?"Drag to reposition":"???";this.instructions.innerHTML=t}}])}();function on(e){return on="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},on(e)}function rn(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,o=Array(t);n<t;n++)o[n]=e[n];return o}function an(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,sn(o.key),o)}}function sn(e){var t=function(e){if("object"!=on(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=on(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==on(t)?t:t+""}function ln(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(ln=function(){return!!e})()}function cn(e){return cn=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},cn(e)}function un(e,t){return un=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},un(e,t)}var pn=function(){function e(t){var n;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),n=function(e,t,n){return t=cn(t),function(e,t){if(t&&("object"==on(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,ln()?Reflect.construct(t,n||[],cn(e).constructor):t.apply(e,n))}(this,e,[t]),"Point"!==t.geometry.type&&error('Bad geoJSON object: type !=="Point"');var o=t.geometry.coordinates.slice(0,2),r=n.paperItem=new i.Group;r.pivot=new i.Point(0,0),r.applyMatrix=!0;var a=new i.Path.Circle(new i.Point(0,0),4);r.addChild(a);var s=new i.PointText({point:new i.Point(0,0),pivot:new i.Point(0,0),content:t.geometry.properties.content||"PointText",fontSize:18,strokeWidth:1});function l(){var e=r.view.getFlipped()?r.view.getRotation():180-r.view.getRotation();r.rotate(-e),r.scale(-1,1),r.rotate(e)}r.addChild(s),n.refreshTextOffset(),s.on("content-changed",(function(){n.refreshTextOffset()})),r.position=function(e,t,n){if(ln())return Reflect.construct.apply(null,arguments);var o=[null];o.push.apply(o,t);var r=new(e.bind.apply(e,o));return n&&un(r,n.prototype),r}(i.Point,function(e){return function(e){if(Array.isArray(e))return rn(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return rn(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?rn(e,t):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}(o)),r.scaleFactor=r.project._scope.scaleByCurrentZoom(1),r.scale(r.scaleFactor,a.bounds.center),r.rescale=r.rescale||{},r.rescale.size=function(e){r.scale(1/(r.scaleFactor*e)),r.scaleFactor=1/e,s.strokeWidth=0},r.view.getFlipped()&&l();var c=r.view.getFlipped()?180-r.view.getRotation():-r.view.getRotation();return r.rotate(c),r.view.on("rotate",(function(e){var t=-e.rotatedBy;r.rotate(t)})),r.view.on("flip",(function(){l()})),r.applyRescale(),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&un(e,t)}(e,jt),t=e,o=[{key:"supportsGeoJSONType",value:function(e,t){return"point"===e.toLowerCase()&&"pointtext"===(null==t?void 0:t.toLowerCase())}},{key:"onTransform",value:function(){switch(arguments[0]){case"rotate":var e=arguments[1],t=arguments[2];this.rotate(-e,t);var n=this.position.subtract(t),o=t.add(n.rotate(e)).subtract(this.position);this.translate(o);break;case"scale":var r=arguments[1],i=arguments[2],a=arguments[3];this.matrix.append(a.inverted());var s=this.pivot.transform(this.matrix).subtract(r),l=s.rotate(-i).multiply(a.scaling).rotate(i).subtract(s);this.translate(l)}}}],(n=[{key:"setStyle",value:function(e){e.rescale=r.extend(!0,e.rescale,this.paperItem.rescale),this.paperItem.style.set(e)}},{key:"textitem",get:function(){return this.paperItem.children[1]}},{key:"circle",get:function(){return this.paperItem.children[0]}},{key:"getGeoJSONType",value:function(){return{type:"Point",subtype:"PointText"}}},{key:"getCoordinates",value:function(){var e=this.paperItem.children[0];return[e.bounds.center.x,e.bounds.center.y]}},{key:"getProperties",value:function(){return{content:this.paperItem.children[1].content}}},{key:"getStyleProperties",value:function(){return this.paperItem.children[0].style.toJSON()}},{key:"refreshTextOffset",value:function(){var e=this.textitem.view.getFlipped(),t=this.textitem.getInternalBounds(),n=t.width/2/this.textitem.layer.scaling.x*(e?1:-1),o=-t.height/2/this.textitem.layer.scaling.x,r=e?180-this.textitem.view.getRotation():this.textitem.view.getRotation(),a=new i.Point(n,o).divide(this.textitem.view.getZoom()).rotate(-r);this.textitem.position=this.circle.bounds.center.add(a)}}])&&an(t.prototype,n),o&&an(t,o),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,n,o}();function dn(e){return dn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},dn(e)}function fn(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function hn(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,An(o.key),o)}}function yn(e,t,n){return t&&hn(e.prototype,t),n&&hn(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function vn(e,t,n){return t=gn(t),function(e,t){if(t&&("object"==dn(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,mn()?Reflect.construct(t,n||[],gn(e).constructor):t.apply(e,n))}function mn(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(mn=function(){return!!e})()}function gn(e){return gn=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},gn(e)}function bn(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&wn(e,t)}function wn(e,t){return wn=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},wn(e,t)}function An(e){var t=function(e){if("object"!=dn(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=dn(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==dn(t)?t:t+""}var Cn=function(){function e(t){var n,o,r,i;fn(this,e),o=n=vn(this,e,[t]),i=function(e){this.dragging&&this.item&&(this.item.position=this.item.position.add(e.delta))},(r=An(r="onMouseDrag"))in o?Object.defineProperty(o,r,{value:i,enumerable:!0,configurable:!0,writable:!0}):o[r]=i,n.dragging=!1;var a=new pn({geometry:{type:"Point",coordinates:[0,0],properties:{subtype:"PointText",content:"Click to place"}},properties:{label:"Text Tool"}}),s=n.cursor=a.paperItem;return s.isGeoJSONFeature=!1,s.fillColor="grey",s.strokeColor="black",s.strokeWidth=1,s.visible=!1,n.project.toolLayer.addChild(s),a.refreshTextOffset(),s.applyRescale(),n.setToolbarControl(new Sn(n)),n.extensions.onActivate=function(){n.itemToCreate?(n.cursor.visible=!0,a.refreshTextOffset(),s.applyRescale()):n.item&&n._updateTextInput()},n.extensions.onDeactivate=function(){n.project.toolLayer.addChild(n.cursor),n.cursor.visible=!1,n.project.overlay.removeClass("point-tool-grab","point-tool-grabbing")},n}return bn(e,G),yn(e,[{key:"onSelectionChanged",value:function(){this.cursor.visible=!!this.itemToCreate,this._updateTextInput()}},{key:"onMouseMove",value:function(e){this.cursor.position=e.original.point,this.item.hitTest(e.point)?this.project.overlay.addClass("point-tool-grab"):this.project.overlay.removeClass("point-tool-grab")}},{key:"onMouseDown",value:function(e){this.itemToCreate?(this.itemToCreate.initializeGeoJSONFeature("Point","PointText"),this.refreshItems(),this.item.children[1].content=this.toolbarControl.getValue(),this.item.position=e.point,this.cursor.visible=!1,this.toolbarControl.updateInstructions("Point:PointText")):this.item&&this.item.hitTest(e.point)&&(this.dragging=!0,this.project.overlay.addClass("point-tool-grabbing"))}},{key:"onMouseUp",value:function(){this.dragging=!1,this.project.overlay.removeClass("point-tool-grabbing")}},{key:"_updateTextInput",value:function(){var e=this.item&&"PointText"==this.item.annotationItem.subtype?this.item.children[1].content:"";this.toolbarControl.setItemText(e),this.cursor.children[1].content=e.length?e:this.toolbarControl.input.getAttribute("placeholder")}}])}(),Sn=function(){function e(t){var n;fn(this,e);var o=n=vn(this,e,[t]),r=Q("fa-font");return n.button.configure(r,"Text Tool"),n.instructions=document.createElement("span"),n.instructions.classList.add("instructions"),n.dropdown.appendChild(n.instructions),n.input=document.createElement("input"),n.input.setAttribute("type","text"),n.input.setAttribute("placeholder","Enter text"),n.dropdown.appendChild(n.input),n.input.addEventListener("input",(function(){var e=o.getValue();o.tool.item&&"PointText"==o.tool.item.annotationItem.subtype&&(o.tool.item.children[1].content=e),o.tool.cursor.children[1].content=e})),n.input.dispatchEvent(new Event("input")),n}return bn(e,z),yn(e,[{key:"setItemText",value:function(e){this.input.value=e}},{key:"getValue",value:function(){var e=this.input;return e.value.trim()||e.getAttribute("placeholder")}},{key:"isEnabledForMode",value:function(e){return this.updateInstructions(e),["new","Point:PointText"].includes(e)}},{key:"updateInstructions",value:function(e){var t="new"==e?"Click to place":"Point:PointText"==e?"Drag to reposition":"???";this.instructions.innerHTML=t}}])}();function In(e){return In="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},In(e)}function kn(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function On(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,Pn(o.key),o)}}function En(e,t,n){return t&&On(e.prototype,t),n&&On(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function Pn(e){var t=function(e){if("object"!=In(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=In(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==In(t)?t:t+""}function _n(e,t,n){return t=Tn(t),function(e,t){if(t&&("object"==In(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,xn()?Reflect.construct(t,n||[],Tn(e).constructor):t.apply(e,n))}function xn(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(xn=function(){return!!e})()}function Tn(e){return Tn=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},Tn(e)}function jn(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Bn(e,t)}function Bn(e,t){return Bn=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},Bn(e,t)}var Ln=function(){function e(t){var n;kn(this,e);var o=n=_n(this,e,[t]),r=new i.Group({visible:!1}),a=new i.Path({segments:[new i.Point(0,0),new i.Point(0,0)],strokeScaling:!1,strokeWidth:1,strokeColor:"black"}),s=new i.Path({segments:[new i.Point(0,0),new i.Point(0,0)],strokeScaling:!1,strokeWidth:1,strokeColor:"white",dashArray:[6,6]}),l=new i.Path({segments:[new i.Point(0,0),new i.Point(0,0)],strokeScaling:!1,strokeWidth:1,strokeColor:"black"}),c=new i.Path({segments:[new i.Point(0,0),new i.Point(0,0)],strokeScaling:!1,strokeWidth:1,strokeColor:"white",dashArray:[6,6]});return r.addChildren([a,s,l,c]),n.project.toolLayer.addChild(r),n.h1=a,n.h2=s,n.v1=l,n.v2=c,n.crosshairTool=r,n.mode=null,n.creating=null,n.setToolbarControl(new Mn(n)),n.extensions.onActivate=n.onSelectionChanged=function(){o.itemToCreate?(o.mode="creating",r.visible=!0,o.creating=null,o.toolbarControl.updateInstructions("new")):o.creating&&o.creating.parent==o.item?(o.mode="creating",r.visible=!0,o.toolbarControl.updateInstructions("new")):o.item?(o.creating=null,o.mode="modifying",r.visible=!1,o.toolbarControl.updateInstructions("Point:Rectangle")):o.deactivate()},n.extensions.onDeactivate=function(e){e&&(o.creating=null),r.visible=!1,o.mode=null,o.project.overlay.removeClass("rectangle-tool-resize"),o.project.overlay.removeClass("rectangle-tool-move")},n}return jn(e,G),En(e,[{key:"rectangle",get:function(){return this.item.children&&this.item.children[0]||this.item}},{key:"setCursorPosition",value:function(e){var t=this.tool,n=t.view.projectToView(e),o=t.view.viewToProject(new i.Point(0,n.y)),r=t.view.viewToProject(new i.Point(t.view.viewSize.width,n.y)),a=t.view.viewToProject(new i.Point(n.x,0)),s=t.view.viewToProject(new i.Point(n.x,t.view.viewSize.height));this.h1.segments[0].point=o,this.h2.segments[0].point=o,this.h1.segments[1].point=r,this.h2.segments[1].point=r,this.v1.segments[0].point=a,this.v2.segments[0].point=a,this.v1.segments[1].point=s,this.v2.segments[1].point=s}},{key:"onMouseDown",value:function(e){if(this.itemToCreate){this.itemToCreate.initializeGeoJSONFeature("Point","Rectangle"),this.refreshItems();var t=new i.Path.Rectangle(e.point,e.point);this.creating=t,this.item.removeChildren(),this.item.addChild(t),this.mode="creating"}else if(this.item){var n=this.item.hitTest(e.point,{fill:!1,stroke:!1,segments:!0,tolerance:this.getTolerance(5)});if(n){this.mode="corner-drag";var o=(n.segment.path.segments.indexOf(n.segment)+2)%n.segment.path.segments.length;return this.refPoint=n.segment.path.segments[o].point,void(this.ctrlPoint=n.segment.point.clone())}if(this.item.contains(e.point))return void(this.mode="fill-drag")}}},{key:"onMouseMove",value:function(e){this.setCursorPosition(e.original.point),"modifying"==this.mode&&(this.item.hitTest(e.point,{fill:!1,stroke:!1,segments:!0,tolerance:this.getTolerance(5)})?this.project.overlay.addClass("rectangle-tool-resize"):this.project.overlay.removeClass("rectangle-tool-resize"),this.item.contains(e.point)?this.project.overlay.addClass("rectangle-tool-move"):this.project.overlay.removeClass("rectangle-tool-move"))}},{key:"onMouseDrag",value:function(e){var t,n,o,r=this.item.center;if("creating"==this.mode)if(o=-(this.item.view.getRotation()+this.item.layer.getRotation()),t=e.downPoint,e.modifiers.command||e.modifiers.control){var a=e.point.subtract(e.downPoint),s=[[1,1],[1,-1],[-1,-1],[-1,1]].map((function(e){return new i.Point(e[0],e[1]).rotate(o)})).sort((function(e,t){return e.dot(a)-t.dot(a)}))[0],l=a.project(s);n=e.downPoint.add(l)}else n=e.point;else{if("corner-drag"!=this.mode)return"fill-drag"==this.mode?void this.item.translate(e.delta):void this.setCursorPosition(e.original.point);if(o=this.rectangle.segments[1].point.subtract(this.rectangle.segments[0].point).angle,t=this.refPoint,e.modifiers.command||e.modifiers.control){var c=e.point.subtract(this.refPoint),u=this.ctrlPoint.subtract(this.refPoint),p=c.project(u);n=this.refPoint.add(p)}else n=e.point}this.setCursorPosition(this.targetLayer.matrix.transform(n));var d=new i.Rectangle(t.rotate(-o,r),n.rotate(-o,r)),f=[d.topLeft,d.topRight,d.bottomRight,d.bottomLeft].map((function(e){return e.rotate(o,r)}));this.rectangle.set({segments:f})}},{key:"onMouseUp",value:function(){this.mode="modifying",this.crosshairTool.visible=!1,this.creating=null,this.toolbarControl.updateInstructions("Point:Rectangle")}}])}(),Mn=function(){function e(t){var n;kn(this,e),n=_n(this,e,[t]);var o=Q("fa-vector-square");return n.button.configure(o,"Rectangle Tool"),n.instructions=document.createElement("span"),n.instructions.innerHTML="Click and drag to create a rectangle",n.dropdown.appendChild(n.instructions),n}return jn(e,z),En(e,[{key:"isEnabledForMode",value:function(e){return["new","Point:Rectangle"].includes(e)}},{key:"updateInstructions",value:function(e){var t="new"==e?"Click and drag to create a rectangle":"Point:Rectangle"==e?"Drag a corner to resize":"???";this.instructions.innerHTML=t}}])}();function Rn(e){return Rn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Rn(e)}function Nn(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Fn(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,Gn(o.key),o)}}function Dn(e,t,n){return t&&Fn(e.prototype,t),n&&Fn(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function Gn(e){var t=function(e){if("object"!=Rn(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=Rn(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==Rn(t)?t:t+""}function zn(e,t,n){return t=Un(t),function(e,t){if(t&&("object"==Rn(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,Hn()?Reflect.construct(t,n||[],Un(e).constructor):t.apply(e,n))}function Hn(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(Hn=function(){return!!e})()}function Un(e){return Un=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},Un(e)}function Wn(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Vn(e,t)}function Vn(e,t){return Vn=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},Vn(e,t)}var Yn=function(){function e(t){var n;Nn(this,e);var o=n=zn(this,e,[t]);return n.crosshairTool=new i.Group({visible:!1}),n.h1=new i.Path({segments:[new i.Point(0,0),new i.Point(0,0)],strokeScaling:!1,strokeWidth:1,strokeColor:"black"}),n.h2=new i.Path({segments:[new i.Point(0,0),new i.Point(0,0)],strokeScaling:!1,strokeWidth:1,strokeColor:"white",dashArray:[6,6]}),n.v1=new i.Path({segments:[new i.Point(0,0),new i.Point(0,0)],strokeScaling:!1,strokeWidth:1,strokeColor:"black"}),n.v2=new i.Path({segments:[new i.Point(0,0),new i.Point(0,0)],strokeScaling:!1,strokeWidth:1,strokeColor:"white",dashArray:[6,6]}),n.crosshairTool.addChildren([n.h1,n.h2,n.v1,n.v2]),n.project.toolLayer.addChild(n.crosshairTool),n.mode=null,n.creating=null,n.setToolbarControl(new qn(n)),n.extensions.onActivate=n.onSelectionChanged=function(){o.itemToCreate?(o.mode="creating",o.crosshairTool.visible=!0,o.creating=null,o.toolbarControl.updateInstructions("new")):o.creating&&o.creating.parent==o.item?(o.mode="creating",o.crosshairTool.visible=!0,o.toolbarControl.updateInstructions("new")):o.item?(o.creating=null,o.mode="modifying",o.crosshairTool.visible=!1,o.toolbarControl.updateInstructions("Point:Ellipse")):(o.creating=null,o.mode=null,o.crosshairTool.visible=!1,o.toolbarControl.updateInstructions("Point:Ellipse"))},n.extensions.onDeactivate=function(e){e&&(o.creating=null),o.crosshairTool.visible=!1,o.mode=null,o.project.overlay.removeClass("rectangle-tool-resize")},n}return Wn(e,G),Dn(e,[{key:"onMouseDown",value:function(e){if(this.itemToCreate){this.itemToCreate.initializeGeoJSONFeature("Point","Ellipse"),this.refreshItems();var t=new i.Path.Ellipse(e.point,e.point);this.creating=t,this.item.removeChildren(),this.item.addChild(t),this.mode="creating"}else if(this.item){var n=this.item.hitTest(e.point,{fill:!1,stroke:!1,segments:!0,tolerance:this.getTolerance(5)});if(n){this.mode="segment-drag";var o=(n.segment.path.segments.indexOf(n.segment)+2)%n.segment.path.segments.length;return void(this.points={opposite:n.segment.path.segments[o].point.clone(),drag:n.segment.point.clone(),p1:n.segment.next.point.clone(),p2:n.segment.previous.point.clone()})}if(this.item.contains(e.point))return void(this.mode="fill-drag")}}},{key:"onMouseDrag",value:function(e){var t,n=this.item.bounds.center;if("creating"==this.mode){var o=-(this.item.view.getRotation()+this.item.layer.getRotation());if(this.item.view.getFlipped()&&(o=180-o),e.modifiers.command||e.modifiers.control){var r=e.point.subtract(e.downPoint),a=[[1,1],[1,-1],[-1,-1],[-1,1]].map((function(e){return new i.Point(e[0],e[1]).rotate(o)})).sort((function(e,t){return e.dot(r)-t.dot(r)}))[0],s=r.project(a);t=e.downPoint.add(s)}else t=e.point;var l=new i.Rectangle(e.downPoint.rotate(-o,n),t.rotate(-o,n)),c=new i.Path.Ellipse(l);c.rotate(o,n),this.item.children[0].set({segments:c.segments}),c.remove()}else{if("segment-drag"!=this.mode)return"fill-drag"==this.mode?void this.item.translate(e.delta):void this.setCursorPosition(e.original.point);var u=e.point.subtract(this.points.opposite),p=this.points.drag.subtract(this.points.opposite),d=u.project(p),f=p.angle;if(e.modifiers.command||e.modifiers.control){var h=d.length/p.length,y=d.divide(2),v=this.points.opposite.add(y),m=y.length,g=Math.abs(this.points.p1.subtract(this.points.opposite).multiply(h).cross(d.normalize())),b=new i.Path.Ellipse({center:v,radius:[m,g]}).rotate(f);this.item.children[0].set({segments:b.segments}),b.remove()}else{var w=d.divide(2),A=this.points.opposite.add(w),C=w.length,S=Math.abs(this.points.p1.subtract(this.points.opposite).cross(d.normalize())),I=new i.Path.Ellipse({center:A,radius:[C,S]}).rotate(f);this.item.children[0].set({segments:I.segments}),I.remove()}}this.setCursorPosition(this.targetLayer.matrix.transform(t))}},{key:"onMouseMove",value:function(e){this.setCursorPosition(e.original.point),"modifying"==this.mode&&(this.item.hitTest(e.point,{fill:!1,stroke:!1,segments:!0,tolerance:this.getTolerance(5)})?this.project.overlay.addClass("rectangle-tool-resize"):this.project.overlay.removeClass("rectangle-tool-resize"),this.item.contains(e.point)?this.project.overlay.addClass("rectangle-tool-move"):this.project.overlay.removeClass("rectangle-tool-move"))}},{key:"onMouseUp",value:function(){this.mode="modifying",this.crosshairTool.visible=!1,this.creating=null,this.toolbarControl.updateInstructions("Point:Ellipse")}},{key:"setCursorPosition",value:function(e){var t=this.tool.view.projectToView(e),n=this.tool.view.viewToProject(new i.Point(0,t.y)),o=this.tool.view.viewToProject(new i.Point(this.tool.view.viewSize.width,t.y)),r=this.tool.view.viewToProject(new i.Point(t.x,0)),a=this.tool.view.viewToProject(new i.Point(t.x,this.tool.view.viewSize.height)),s=this.h1,l=this.h2,c=this.v1,u=this.v2;s.segments[0].point=n,l.segments[0].point=n,s.segments[1].point=o,l.segments[1].point=o,c.segments[0].point=r,u.segments[0].point=r,c.segments[1].point=a,u.segments[1].point=a}}])}(),qn=function(){function e(t){var n;Nn(this,e),n=zn(this,e,[t]);var o=Q("fa-circle");return n.button.configure(o,"Ellipse Tool"),n.instructions=document.createElement("span"),n.instructions.innerHTML="Click and drag to create an ellipse",n.dropdown.appendChild(n.instructions),n}return Wn(e,z),Dn(e,[{key:"isEnabledForMode",value:function(e){return["new","Point:Ellipse"].includes(e)}},{key:"updateInstructions",value:function(e){var t="new"==e?"Click and drag to create an ellipse":"Point:Ellipse"==e?"Drag a point to resize":"???";this.instructions.innerHTML=t}}])}();function Jn(e){return Jn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Jn(e)}function Zn(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Xn(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,Qn(o.key),o)}}function Kn(e,t,n){return t&&Xn(e.prototype,t),n&&Xn(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function Qn(e){var t=function(e){if("object"!=Jn(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=Jn(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==Jn(t)?t:t+""}function $n(e,t,n){return t=to(t),function(e,t){if(t&&("object"==Jn(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,eo()?Reflect.construct(t,n||[],to(e).constructor):t.apply(e,n))}function eo(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(eo=function(){return!!e})()}function to(e){return to=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},to(e)}function no(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&oo(e,t)}function oo(e,t){return oo=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},oo(e,t)}var ro=function(){function e(t){var n;Zn(this,e);var o=n=$n(this,e,[t]),r=n.tool;return n._lastClickTime=0,n.drawingGroup=new i.Group,n._currentItem=null,n._currentItemSelectedColor=null,n.project.toolLayer.addChild(n.drawingGroup),n.drawingGroup.visible=!1,n.draggingSegment=null,n.eraseMode=!1,n.simplifying=null,n.setToolbarControl(new io(n)),n.extensions.onActivate=function(){r.minDistance=4/o.project.getZoom(),r.maxDistance=20/o.project.getZoom(),o.drawingGroup.visible=!0,o.drawingGroup.selected=!0,o.targetLayer.addChild(o.drawingGroup),o._cacheCurrentItem()},n.extensions.onDeactivate=function(e){e&&(o.finish(),o.project.toolLayer.addChild(o.drawingGroup),o.drawingGroup.removeChildren(),o.drawingGroup.visible=!1,o.drawingGroup.selected=!1,o._restoreCachedItem(),o._currentItem=null)},r.extensions.onKeyDown=function(e){"e"==e.key&&(!1===o.eraseMode?o.setEraseMode(!0):!0===o.eraseMode&&(o.eraseMode="keyhold")),!e.event.metaKey&&!e.event.ctrlKey||e.event.shiftKey||"z"!==e.event.key||o.undo(),(e.event.metaKey||e.event.ctrlKey)&&e.event.shiftKey&&"z"===e.event.key&&o.redo()},r.extensions.onKeyUp=function(e){"e"==e.key&&"keyhold"==o.eraseMode&&o.setEraseMode(!1)},n}return no(e,G),Kn(e,[{key:"_cacheCurrentItem",value:function(){this._currentItem=this.item,this._currentItem&&(this._currentItem.selectedColor=this._currentItemSelectedColor)}},{key:"_restoreCachedItem",value:function(){this._currentItem&&(this._currentItem.selectedColor=this._currentItemSelectedColor)}},{key:"onSelectionChanged",value:function(){this.item!==this._currentItem&&(this._restoreCachedItem(),this._cacheCurrentItem(),this.targetLayer.addChild(this.drawingGroup),this.drawingGroup.removeChildren(),this.setEraseMode(this.eraseMode))}},{key:"onMouseDown",value:function(e){this.draggingSegment=null;var t=Date.now(),n=t-this._lastClickTime<300;this._lastClickTime=t,this.simplifying&&this.cancelSimplify(),this.itemToCreate&&(this.itemToCreate.initializeGeoJSONFeature("MultiPolygon"),this.refreshItems(),this._cacheCurrentItem(),this.saveHistory());var o=this.drawing();if(o&&n)return this.finishCurrentPath(),void(this.draggingSegment=null);var r=(o&&o.path||this.item).hitTest(e.point,{fill:!1,stroke:!0,segments:!0,tolerance:this.getTolerance(5)});if(r){if("segment"==r.type&&this.eraseMode)r.segment.remove();else if("segment"==r.type)this.draggingSegment=r.segment;else if("stroke"==r.type){var a=r.location.index+1;r.item.insert(a,e.point)}}else if(o){if(e.point.subtract(o.path.lastSegment).length<5/this.project.getZoom())return;o.path.add(e.point)}else this.drawingGroup.removeChildren(),this.drawingGroup.addChild(new i.Path([e.point])),this.drawingGroup.visible=!0,this.drawingGroup.selected=!0,this.drawingGroup.selectedColor=this.eraseMode?"red":null}},{key:"onMouseUp",value:function(e){var t=this.drawing();if(t&&t.path.segments.length>1){var n=t.path.hitTest(e.point,{fill:!1,stroke:!1,segments:!0,tolerance:this.getTolerance(5)});n&&n.segment==t.path.firstSegment&&this.finishCurrentPath()}else if(this.draggingSegment&&(this.draggingSegment=null,!this.item.isBoundingElement)){var o=this.item.parent.children.filter((function(e){return e.isBoundingElement}));this.item.applyBounds(o)}this.saveHistory()}},{key:"onMouseMove",value:function(e){var t=this.drawing(),n=this.item&&(t&&t.path||this.item).hitTest(e.point,{fill:!1,stroke:!0,segments:!0,tolerance:this.getTolerance(5)});if(n){var o=n.type+(this.eraseMode?"-erase":"");this.project.overlay.addClass("tool-action").setAttribute("data-tool-action",o)}else this.project.overlay.removeClass("tool-action").setAttribute("data-tool-action","")}},{key:"onMouseDrag",value:function(e){var t=this.drawing();t?t.path.add(e.point):this.draggingSegment&&(this.draggingSegment.point=this.draggingSegment.point.add(e.delta))}},{key:"drawing",value:function(){return this.drawingGroup.lastChild&&{path:this.drawingGroup.lastChild}}},{key:"finish",value:function(){this.setEraseMode(!1),this.draggingSegment=null,this.project.overlay.removeClass("tool-action").setAttribute("data-tool-action",""),this.deactivate(),this.drawingGroup.selected=!1,this.drawingGroup.visible=!1}},{key:"setEraseMode",value:function(e){this.eraseMode=e,this.item&&(this.item.selectedColor=e?"red":null),this.drawingGroup.selectedColor=e?"red":null,this.toolbarControl.setEraseMode(e)}},{key:"finishCurrentPath",value:function(){var e=this.drawing();if(e&&this.item&&this.item.parent){e.path.closed=!0;var t=this.eraseMode?this.item.subtract(e.path,{insert:!1}):this.item.unite(e.path,{insert:!1});if(t){if(t=t.toCompoundPath(),!this.item.isBoundingElement){var n=this.item.parent.children.filter((function(e){return e.isBoundingElement}));t.applyBounds(n)}this.item.removeChildren(),this.item.addChildren(t.children),this.item.children.forEach((function(e){return e.selected=!1})),t.remove()}this.drawingGroup.removeChildren()}}},{key:"saveHistory",value:function(){var e=(this.item.history||[]).position||0;this.item.history=[{children:this.item.children.map((function(e){return e.clone({insert:!1,deep:!0})})),drawingGroup:this.drawingGroup.children.map((function(e){return e.clone({insert:!1,deep:!0})}))}].concat((this.item.history||[]).slice(e,10))}},{key:"undo",value:function(){var e=this.item.history||[],t=(e.position||0)+1;t<e.length&&(this.drawingGroup.removeChildren(),this.item.removeChildren(),this.item.children=e[t].children.map((function(e){return e.clone({insert:!0,deep:!0})})),this.drawingGroup.children=e[t].drawingGroup.map((function(e){return e.clone({insert:!0,deep:!0})})),e.position=t)}},{key:"redo",value:function(){var e=this.item.history||[],t=(e.position||0)-1;t>=0&&(this.drawingGroup.removeChildren(),this.item.removeChildren(),this.item.children=e[t].children.map((function(e){return e.clone({insert:!0,deep:!0})})),this.drawingGroup.children=e[t].drawingGroup.map((function(e){return e.clone({insert:!0,deep:!0})})),e.position=t)}}])}(),io=function(){function e(t){var n;Zn(this,e),n=$n(this,e,[t]);var o=Q("fa-draw-polygon");n.button.configure(o,"Polygon Tool");var r=document.createElement("div");r.classList.add("dropdown","polygon-toolbar"),r.setAttribute("data-tool","polygon"),n.dropdown.appendChild(r);var i=document.createElement("span");i.innerHTML="Click or Drag",r.appendChild(i);var a=document.createElement("div");r.appendChild(a),n.simplifyButton=document.createElement("button"),n.simplifyButton.setAttribute("data-action","simplify"),n.simplifyButton.innerHTML="Simplify",a.append(n.simplifyButton),n.simplifyButton.addEventListener("click",(function(){t.doSimplify(),t.saveHistory()})),n.eraseButton=document.createElement("button"),r.appendChild(n.eraseButton),n.eraseButton.setAttribute("data-action","erase"),n.eraseButton.innerHTML="Eraser",n.eraseButton.addEventListener("click",(function(){var e=this.classList.toggle("active");t.setEraseMode(e)}));var s=document.createElement("span");return r.appendChild(s),n.undoButton=document.createElement("button"),s.appendChild(n.undoButton),n.undoButton.setAttribute("data-action","undo"),n.undoButton.setAttribute("title","Undo (ctrl-Z)"),n.undoButton.innerHTML="<",n.undoButton.addEventListener("click",(function(){t.undo()})),n.redoButton=document.createElement("button"),s.appendChild(n.redoButton),n.redoButton.setAttribute("data-action","redo"),n.redoButton.setAttribute("title","Redo (ctrl-shift-Z)"),n.redoButton.innerHTML=">",n.redoButton.addEventListener("click",(function(){t.redo()})),n}return no(e,z),Kn(e,[{key:"isEnabledForMode",value:function(e){return["new","MultiPolygon","Polygon"].includes(e)}},{key:"setEraseMode",value:function(e){e?this.eraseButton.classList.add("active"):this.eraseButton.classList.remove("active")}}])}();function ao(e){return ao="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ao(e)}function so(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function lo(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,uo(o.key),o)}}function co(e,t,n){return t&&lo(e.prototype,t),n&&lo(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function uo(e){var t=function(e){if("object"!=ao(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=ao(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==ao(t)?t:t+""}function po(e,t,n){return t=ho(t),function(e,t){if(t&&("object"==ao(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,fo()?Reflect.construct(t,n||[],ho(e).constructor):t.apply(e,n))}function fo(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(fo=function(){return!!e})()}function ho(e){return ho=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},ho(e)}function yo(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&vo(e,t)}function vo(e,t){return vo=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},vo(e,t)}var mo=function(){function e(t){var n;so(this,e);var o=n=po(this,e,[t]),r=n.tool;n.setToolbarControl(new go(n));var a=new i.Color("green");return new i.Color("red"),n.radius=0,n.cursor=new i.Shape.Circle(new i.Point(0,0),n.radius),n.cursor.set({strokeWidth:1,strokeColor:"black",fillColor:a,opacity:1,visible:!1}),o.project.toolLayer.addChild(n.cursor),n.clickAction="startPath",n.extensions.onActivate=function(){n.cursor.radius=n.radius/n.project.getZoom(),n.cursor.strokeWidth=1/n.project.getZoom(),n.refreshCursorVisibility(),r.minDistance=4/o.project.getZoom(),r.maxDistance=10/o.project.getZoom()},n.extensions.onDeactivate=function(e){n.cursor.visible=!1,e&&n.finish()},r.onMouseWheel=function(e){e.preventDefault(),e.stopPropagation(),0!=e.deltaY&&n.toolbarControl.updateBrushRadius({larger:e.deltaY<0})},n}return yo(e,ro),co(e,[{key:"setRadius",value:function(e){this.radius=e,this.cursor.radius=e/this.project.getZoom()}},{key:"onMouseDown",value:function(e){var t;if(this.draggingSegment=null,this.itemToCreate)return this.itemToCreate.initializeGeoJSONFeature("MultiLineString"),this.refreshItems(),void this.startNewPath(e);var n=null===(t=this.item)||void 0===t?void 0:t.hitTest(e.point,{fill:!1,stroke:!1,segments:!0,tolerance:this.getTolerance(5)});if(n){if("segment"==n.type&&this.eraseMode)n.segment.remove();else if("segment"==n.type)this.draggingSegment=n.segment;else if("stroke"==n.type&&!this.eraseMode){var o=n.location.index+1;n.item.insert(o,e.point)}}else this.eraseMode||this.startNewPath(e)}},{key:"onMouseMove",value:function(e){var t;this.cursor.position=e.original.point;var n=null===(t=this.item)||void 0===t?void 0:t.hitTest(e.point,{fill:!1,stroke:!1,segments:!0,tolerance:this.getTolerance(5)});if(n){var o=n.type+(this.eraseMode?"-erase":"");this.project.overlay.addClass("tool-action").setAttribute("data-tool-action",o),this.clickAction=o}else this.project.overlay.removeClass("tool-action").setAttribute("data-tool-action",""),this.clickAction="startPath";this.refreshCursorVisibility()}},{key:"onMouseDrag",value:function(e){this.cursor.position=e.original.point,ro.prototype.onMouseDrag.call(this,e);var t=this.drawing();t&&(t.path.segments=this.simplifier.simplify(t.path.segments.map((function(e){return e.point}))))}},{key:"onMouseUp",value:function(e){this.finishCurrentPath()}},{key:"startNewPath",value:function(e){this.finishCurrentPath(),this.drawingGroup.removeChildren(),this.drawingGroup.addChild(new i.Path([e.point])),this.drawingGroup.visible=!0,this.drawingGroup.selected=!0,this.drawingGroup.selectedColor=this.eraseMode?"red":null,this.drawing().path.set({strokeWidth:2*this.radius/this.targetLayer.scaling.x/this.project.getZoom(),strokeColor:this.item.strokeColor,strokeJoin:"round",strokeCap:"round"})}},{key:"finishCurrentPath",value:function(){this.drawing()&&this.item&&(this.drawing().path.segments.length>1&&this.item.addChild(this.drawing().path),this.drawingGroup.removeChildren())}},{key:"refreshCursorVisibility",value:function(){this.cursor.visible=!this.eraseMode&&"startPath"===this.clickAction}}])}(),go=function(){function e(t){var n;so(this,e),(n=po(this,e,[t])).linestringTool=t;var o=Q("fa-pen-nib");n.button.configure(o,"Linestring Tool");var r=document.createElement("div");r.classList.add("dropdown","linestring-toolbar"),r.setAttribute("data-tool","linestring"),n.dropdown.appendChild(r);var i=document.createElement("label");return i.innerHTML="Set pen width:",r.appendChild(i),n.rangeInput=document.createElement("input"),r.appendChild(n.rangeInput),Object.assign(n.rangeInput,{type:"range",min:.2,max:12,step:.1,value:4}),n.rangeInput.addEventListener("change",(function(){t.setRadius(this.value)})),n.eraseButton=document.createElement("button"),r.appendChild(n.eraseButton),n.eraseButton.innerHTML="Eraser",n.eraseButton.setAttribute("data-action","erase"),n.eraseButton.addEventListener("click",(function(){var e=this.classList.toggle("active");t.setEraseMode(e)})),setTimeout((function(){return t.setRadius(4)})),n}return yo(e,z),co(e,[{key:"updateBrushRadius",value:function(e){e.larger?(this.rangeInput.value=parseFloat(this.rangeInput.value)+parseFloat(this.rangeInput.step),this.rangeInput.dispatchEvent(new Event("change"))):(this.rangeInput.value=parseFloat(this.rangeInput.value)-parseFloat(this.rangeInput.step),this.rangeInput.dispatchEvent(new Event("change")))}},{key:"isEnabledForMode",value:function(e){return["new","LineString","MultiLineString"].includes(e)}},{key:"setEraseMode",value:function(e){e?this.eraseButton.classList.add("active"):this.eraseButton.classList.remove("active"),this.linestringTool.refreshCursorVisibility()}}])}();function bo(e){return bo="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},bo(e)}function wo(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Ao(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,So(o.key),o)}}function Co(e,t,n){return t&&Ao(e.prototype,t),n&&Ao(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function So(e){var t=function(e){if("object"!=bo(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=bo(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==bo(t)?t:t+""}function Io(e,t,n){return t=Oo(t),function(e,t){if(t&&("object"==bo(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,ko()?Reflect.construct(t,n||[],Oo(e).constructor):t.apply(e,n))}function ko(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(ko=function(){return!!e})()}function Oo(e){return Oo=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},Oo(e)}function Eo(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Po(e,t)}function Po(e,t){return Po=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},Po(e,t)}var _o=function(){function e(t){var n;wo(this,e);var o=n=Io(this,e,[t]);n.ps=n.project.paperScope,n.setToolbarControl(new xo(n));var r=new i.Path.Rectangle({strokeWidth:1,rescale:{strokeWidth:1},strokeColor:"black"}),a=new i.Path.Rectangle({strokeWidth:1,dashArray:[10,10],rescale:{strokeWidth:1,dashArray:[10,10]},strokeColor:"white"});return n.project.toolLayer.addChild(r),n.project.toolLayer.addChild(a),r.applyRescale(),a.applyRescale(),r.visible=!1,a.visible=!1,n.extensions.onActivate=function(){o.tool.onMouseMove=function(e){return o.onMouseMove(e)}},n.extensions.onDeactivate=function(e){o.project.overlay.removeClass("selectable-layer"),o.tool.onMouseMove=null},n.tool.extensions.onKeyUp=function(e){"escape"==e.key&&o.project.paperScope.findSelectedItems().forEach((function(e){return e.deselect()}))},n.tool.onMouseUp=function(e){if(r.visible=!1,a.visible=!1,0==e.downPoint.subtract(e.point).length){var t=o.hitTestPoint(e);t&&o._isItemSelectable(t.item)&&t.item.toggle(e.modifiers.control||e.modifiers.meta)}else{var n=o.hitTestArea(e);e.modifiers.control||e.modifiers.meta||o.project.paperScope.findSelectedItems().forEach((function(e){return e.deselect()})),n.forEach((function(e){return e.select(!0)}))}},n.tool.onMouseDrag=function(e){r.visible=!0,a.visible=!0;var t=new i.Rectangle(e.downPoint,e.point);r.set({segments:[t.topLeft,t.topRight,t.bottomRight,t.bottomLeft]}),a.set({segments:[t.topLeft,t.topRight,t.bottomRight,t.bottomLeft]})},n}return Eo(e,G),Co(e,[{key:"doAnnotationItemsExist",value:function(){return this.ps.project.getItems({match:function(e){return e.isGeoJSONFeature}}).length>0}},{key:"onMouseMove",value:function(e){e.item&&this._isItemSelectable(e.item)?(this.currentItem!=e.item&&e.item.emit("selection:mouseenter"),this.currentLayer!=e.item.layer&&e.item.layer.emit("selection:mouseenter"),this.currentItem=e.item,this.currentLayer=this.currentItem.layer,this.project.overlay.addClass("selectable-layer")):(this.currenItem&&this.currentItem.emit("selection:mouseleave",e),this.currentLayer&&this.currentLayer.emit("selection:mouseleave",e),this.project.overlay.removeClass("selectable-layer"),this.currentItem=null,this.currentLayer=null)}},{key:"hitTestPoint",value:function(e){var t=this.ps.project.hitTest(e.point,{fill:!0,stroke:!0,segments:!0,tolerance:this.getTolerance(5),match:function(e){return e.item.isGeoJSONFeature||e.item.parent.isGeoJSONFeature}});return t&&!t.item.isGeoJSONFeature&&(t.item=t.item.parent),t}},{key:"hitTestArea",value:function(e,t){var n={match:function(e){return e.isGeoJSONFeature}},o=new i.Rectangle(e.point,e.downPoint);return t?n.inside=o:n.overlapping=o,this.ps.project.getItems(n)}},{key:"_isItemSelectable",value:function(e){return!0}}])}(),xo=function(){function e(t){var n;wo(this,e),(n=Io(this,e,[t])).dropdown.classList.add("select-dropdown");var o=Q("fa-arrow-pointer");n.button.configure(o,"Selection Tool");var r=document.createElement("div");r.setAttribute("data-active","select"),n.dropdown.appendChild(r);var i=document.createElement("span");return i.innerHTML="(Ctrl)click to select items.",r.append(i),n}return Eo(e,z),Co(e,[{key:"isEnabledForMode",value:function(e){return this.tool.doAnnotationItemsExist()&&["default","select","multiselection","Polygon","MultiPolygon","Point:Rectangle","Point:Ellipse","Point","LineString","MultiLineString","GeometryColletion:Raster"].includes(e)}}])}();function To(e){return To="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},To(e)}function jo(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Bo(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,Mo(o.key),o)}}function Lo(e,t,n){return t&&Bo(e.prototype,t),n&&Bo(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function Mo(e){var t=function(e){if("object"!=To(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=To(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==To(t)?t:t+""}function Ro(e,t,n){return t=Fo(t),function(e,t){if(t&&("object"==To(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,No()?Reflect.construct(t,n||[],Fo(e).constructor):t.apply(e,n))}function No(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(No=function(){return!!e})()}function Fo(e){return Fo=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},Fo(e)}function Do(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Go(e,t)}function Go(e,t){return Go=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},Go(e,t)}var zo=function(){function e(t){var n;jo(this,e);var o=n=Ro(this,e,[t]);return n.ps=n.project.paperScope,n._mode="transform",n._moving=[],n._active=!1,n.setToolbarControl(new Ho(n)),n._makeTransformToolObject(o.project.getZoom()),n.extensions.onActivate=function(){o._active=!0,o.enableTransformToolObject()},n.extensions.onDeactivate=function(e){o._active=!1,o.project.overlay.removeClass("transform-tool-resize","transform-tool-rotate","transform-tool-move"),e&&o.disableTransformToolObject()},n}return Do(e,G),Lo(e,[{key:"onSelectionChanged",value:function(){this.enableTransformToolObject()}},{key:"setUniformScaling",value:function(e){this._alwaysRescaleUniformly=e}},{key:"_makeTransformToolObject",value:function(e){var t=this,n=this,o=12;this._transformTool&&this._transformTool.remove(),this._transformTool=new i.Group,this.project.toolLayer.addChild(this._transformTool),this._transformTool.applyMatrix=!1,this._transformTool.transforming=[],this._transformTool.boundingRect=new i.Shape.Rectangle(new i.Point(0,0),new i.Size(0,0)),this._transformTool.boundingDisplay=new i.Shape.Rectangle(new i.Point(0,0),new i.Size(0,0)),this._transformTool.boundingRect.set({strokeWidth:0,fillColor:new i.Color(0,0,0,.001)}),this._transformTool.boundingDisplay.set({strokeWidth:5,strokeColor:"lightblue",rescale:{strokeWidth:5}}),this._transformTool.addChild(this._transformTool.boundingRect),this._transformTool.addChild(this._transformTool.boundingDisplay),this._transformTool.corners=[["topLeft","bottomRight"],["topRight","bottomLeft"],["bottomRight","topLeft"],["bottomLeft","topRight"]].reduce((function(t,r){var a=new i.Shape.Rectangle(new i.Point(0,0),new i.Size(o/e,o/e));return a.set({rescale:{size:function(e){return new i.Size(o/e,o/e)}},fillColor:"red",strokeColor:"black"}),n._transformTool.addChild(a),a.anchor=r[0],a.opposite=r[1],a.onMouseDown=function(e){e.stopPropagation()},a.onMouseDrag=function(e){var t=n.targetLayer.getRotation(),o=this.parent.rotation,r=e.delta.rotate(-o),a=this.parent.corners[this.opposite].position;(n._alwaysRescaleUniformly||e.modifiers.command||e.modifiers.control)&&(r=r.project(this.position.subtract(a)));var s=this.position,l=this.position.add(r),c=new i.Rectangle(a,s).size,u=new i.Rectangle(a,l).size.divide(c),p=a.transform(this.parent.matrix),d=this.parent.matrix.inverseTransform(this.parent.corners[this.opposite].refPos);d=n.targetMatrix.inverseTransform(d),this.parent.transforming.forEach((function(e){var n=(new i.Matrix).rotate(-t,d).scale(u.width,u.height,d).rotate(t,d);e.matrix.append(n),e.onTransform&&e.onTransform("scale",p,o,n)})),this.parent.boundingRect.scale(u.width,u.height,a),this.parent.setBounds(!0)},t[r[0]]=a,t}),{}),this._transformTool.rotationHandle=new i.Shape.Circle(new i.Point(0,0),o/e),this._transformTool.rotationHandle.set({fillColor:"red",strokeColor:"black",rescale:{radius:o}}),this._transformTool.addChild(this._transformTool.rotationHandle),this._transformTool.rotationHandle.onMouseDown=function(e){e.stopPropagation()},this._transformTool.rotationHandle.onMouseDrag=function(e){var t=this.parent.matrix.transform(this.parent.boundingRect.position),o=e.point.subtract(e.delta).subtract(t),r=e.point.subtract(t).angle-o.angle;this.parent.rotate(r,t),this.parent.transforming.forEach((function(e){var o=n.targetMatrix.inverseTransform(t);e.rotate(r,o),e.onTransform&&e.onTransform("rotate",r,o)})),Object.values(this.parent.corners).forEach((function(e){e.refPos=e.refPos.rotate(r,t)}))},this.onMouseDrag=function(e){if(t._transformTool._moveOnDrag){t._transformTool.translate(e.original.delta);var n=e.delta;Object.values(t._transformTool.corners).forEach((function(t){t.refPos=t.refPos.add(e.original.delta)})),t._transformTool.transforming.forEach((function(e){e.translate(n),e.onTransform&&e.onTransform("translate",n)}))}},this._transformTool.setBounds=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!e){var t=this.transforming.reduce((function(e,t){return t.transform(n.targetLayer.matrix),e.minX=null===e.minX?t.bounds.topLeft.x:Math.min(e.minX,t.bounds.topLeft.x),e.minY=null===e.minY?t.bounds.topLeft.y:Math.min(e.minY,t.bounds.topLeft.y),e.maxX=null===e.maxX?t.bounds.bottomRight.x:Math.max(e.maxX,t.bounds.bottomRight.x),e.maxY=null===e.maxY?t.bounds.bottomRight.y:Math.max(e.maxY,t.bounds.bottomRight.y),t.transform(n.targetLayer.matrix.inverted()),e}),{minX:null,minY:null,maxX:null,maxY:null}),o=new i.Point(t.minX,t.minY),r=new i.Point(t.maxX,t.maxY),a=new i.Rectangle(o,r);this.matrix.reset(),this.boundingRect.set({position:a.center,size:a.size})}var s=this.boundingRect;this.boundingDisplay.set({position:s.position,size:s.bounds.size}),Object.values(this.corners).forEach((function(t){t.position=s.bounds[t.anchor],e||(t.refPos=t.position)})),this.rotationHandle.set({position:s.position.subtract(new i.Point(0,s.bounds.size.height/2+2*this.rotationHandle.radius))})},this._transformTool.transformItems=function(e){this.transforming.forEach((function(e){e.matrix.apply(!0,!0),e.onTransform&&e.onTransform("complete")})),this.transforming=e,e.forEach((function(e){return e.applyMatrix=!1})),this.matrix.reset(),this.boundingRect.matrix.reset(),this.boundingDisplay.matrix.reset(),this.setBounds()},this._transformTool.visible=!1}},{key:"enableTransformToolObject",value:function(){this.items.length>0&&(this.project.toolLayer.bringToFront(),this._transformTool.visible=!0,this._transformTool.transformItems(this.items))}},{key:"disableTransformToolObject",value:function(){this.project.toolLayer.sendToBack(),this._transformTool.transformItems([]),this._transformTool.visible=!1}},{key:"hitTest",value:function(e){var t=this.ps.project.hitTest(e,{fill:!0,stroke:!0,segments:!0,tolerance:this.getTolerance(5),match:function(e){return e.item.isGeoJSONFeature||e.item.parent.isGeoJSONFeature}});return t&&!t.item.isGeoJSONFeature&&(t.item=t.item.parent),t}},{key:"onMouseMove",value:function(e){if(this._active){var t=this.project.paperScope.project.hitTest(e.original.point);t?(Object.values(this._transformTool.corners).includes(t.item)?this.project.overlay.addClass("transform-tool-resize"):this.project.overlay.removeClass("transform-tool-resize"),this._transformTool.rotationHandle==t.item?this.project.overlay.addClass("transform-tool-rotate"):this.project.overlay.removeClass("transform-tool-rotate"),[this._transformTool.boundingRect,this._transformTool.boundingDisplay].includes(t.item)?(this.project.overlay.addClass("transform-tool-move"),this._transformTool._moveOnDrag=!0):(this.project.overlay.removeClass("transform-tool-move"),this._transformTool._moveOnDrag=!1)):this.project.overlay.removeClass("transform-tool-resize","transform-tool-rotate","transform-tool-move")}}}])}(),Ho=function(){function e(t){var n;jo(this,e),(n=Ro(this,e,[t])).dropdown.classList.add("transform-dropdown");var o=Q("fa-up-down-left-right");return n.button.configure(o,"Transform Tool"),n}return Do(e,z),Lo(e,[{key:"isEnabledForMode",value:function(e){var t=this.tool.project.paperScope.findSelectedItems();return t.length>0&&["select","multiselection","Polygon","MultiPolygon","Point:Rectangle","Point:Ellipse","LineString","GeometryCollection:Raster"].includes(e)&&1==new Set(t.map((function(e){return e.layer}))).size}}])}();function Uo(e){return Uo="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Uo(e)}function Wo(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Vo(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,qo(o.key),o)}}function Yo(e,t,n){return t&&Vo(e.prototype,t),n&&Vo(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function qo(e){var t=function(e){if("object"!=Uo(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=Uo(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==Uo(t)?t:t+""}function Jo(e,t,n){return t=Xo(t),function(e,t){if(t&&("object"==Uo(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,Zo()?Reflect.construct(t,n||[],Xo(e).constructor):t.apply(e,n))}function Zo(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(Zo=function(){return!!e})()}function Xo(e){return Xo=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},Xo(e)}function Ko(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Qo(e,t)}function Qo(e,t){return Qo=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},Qo(e,t)}var $o=function(){function e(t){var n;return Wo(this,e),(n=Jo(this,e,[t])).setToolbarControl(new er(n)),n}return Ko(e,G),Yo(e,[{key:"rasterize",value:function(){var e=this,t=this.item;if(t){var n=this.project.overlay.getViewportRaster();t.layer.addChild(n),n.onLoad=function(){var n=new i.Point(this.width/2,this.height/2),o=new i.Rectangle(n.add(this.matrix.inverseTransform(this.layer.matrix.transform(t.bounds.topLeft))).floor(),n.add(this.matrix.inverseTransform(this.layer.matrix.transform(t.bounds.bottomRight))).ceil()),r=this.getSubRaster(o);r.transform(this.layer.matrix.inverted()),r.selectedColor=null;var a={type:"Feature",geometry:{type:"GeometryCollection",properties:{subtype:"Raster",raster:{data:r}},geometries:[t]},properties:{}};t.replaceWith(i.Item.fromGeoJSON(a)),e.refreshItems(),this.remove()}}}}])}(),er=function(){function e(t){var n;Wo(this,e),n=Jo(this,e,[t]);var o=Q("fa-image");n.button.configure(o,"raster Tool");var r=document.createElement("div");n.dropdown.appendChild(r);var i=document.createElement("button");i.innerHTML="Convert to raster",r.appendChild(i);var a=document.createElement("span");return a.innerHTML="Warning: this cannot be undone!",r.appendChild(a),i.addEventListener("click",(function(){return t.rasterize()})),n}return Ko(e,z),Yo(e,[{key:"isEnabledForMode",value:function(e){return["Polygon","MultiPolygon","Point:Rectangle","Point:Ellipse"].includes(e)}}])}();function tr(e){return tr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},tr(e)}function nr(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,o=Array(t);n<t;n++)o[n]=e[n];return o}function or(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,rr(o.key),o)}}function rr(e){var t=function(e){if("object"!=tr(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=tr(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==tr(t)?t:t+""}var ir=function(){return e=function e(t,n){var o=this;if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),n&&!Array.isArray(n))throw"Bad option: if present, tools must be an Array of tool names or constructors to use.";this.ui=this._makeUI(),this.paperScope=t,this.currentMode=null,this.setModeTimeout=null;var r=new t.Layer;r.isGeoJSONFeatureCollection=!1,r.name="toolLayer",r.applyMatrix=!1,t.project.addLayer(r),this.toolConstructors={default:ue,select:_o,transform:zo,style:Ie,rectangle:Ln,ellipse:Yn,point:tn,text:Cn,polygon:ro,brush:Ct,wand:Ke,linestring:mo,raster:$o},this.tools={};var i=n||Object.keys(this.toolConstructors);-1==i.indexOf("default")&&(i=["default"].concat(function(e){return function(e){if(Array.isArray(e))return nr(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return nr(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?nr(e,t):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}(i))),this.paperScope.activate(),i.forEach((function(e){if("string"==typeof e){if(!o.toolConstructors[e])return void console.warn("The requested tool is invalid: ".concat(e,". No constructor found for that name."))}else if(!(e instanceof k))return void console.warn("".concat(e," must inherit from class ToolBase"));var t=e instanceof k?e:o.toolConstructors[e],n=o.tools[e]=new t(o.paperScope),r=n.getToolbarControl();r&&o.addToolbarControl(r),n.addEventListener("deactivated",(function(e){e.target==o.paperScope.getActiveTool()&&o.tools.default.activate()}))})),this.tools.default.activate(),this.setMode(),t.project.on({"item-replaced":function(){o.setMode()},"item-selected":function(){o.setMode()},"item-deselected":function(){o.setMode()},"item-removed":function(){o.setMode()},"items-changed":function(){o.setMode()}})},t=[{key:"element",get:function(){return this._element}},{key:"setMode",value:function(){var e=this,t=this;this.setModeTimeout&&clearTimeout(this.setModeTimeout),this.setModeTimeout=setTimeout((function(){e.setModeTimeout=null;var n=e.paperScope.findSelectedItems(),o=e.paperScope.getActiveTool();if(0===n.length)e.currentMode="select";else if(1===n.length){var r=n[0].annotationItem||{},i=r.type;r.subtype&&(i+=":"+r.subtype);var a=null===i?"new":i;e.currentMode=a}else e.currentMode="multiselection";!1===o.getToolbarControl().isEnabledForMode(e.currentMode)&&(o.deactivate(!0),e.tools.default.activate()),Object.values(e.tools).forEach((function(e){var n=e.getToolbarControl();n&&(n.isEnabledForMode(t.currentMode)?n.button.enable():n.button.disable())})),o.selectionChanged()}),0)}},{key:"addToolbarControl",value:function(e){var t=e.button.element,n=e.dropdown;this._buttonbar.appendChild(t),this._dropdowns.appendChild(n),e.isEnabledForMode(this.currentMode)?e.button.enable():e.button.disable()}},{key:"show",value:function(){this.element.style.display="inline-block"}},{key:"hide",value:function(){this.element.style.display="none"}},{key:"destroy",value:function(){this.element.remove()}},{key:"_makeUI",value:function(){var e=this;this._element=document.createElement("div"),this._buttonbar=document.createElement("div"),this._dropdowns=document.createElement("div");var t=document.createElement("div");this._element.appendChild(this._buttonbar),this._element.appendChild(t),t.appendChild(this._dropdowns),"annotation-ui-drawing-toolbar btn-group btn-group-sm mode-selection".split(" ").forEach((function(t){return e._element.classList.add(t)})),t.classList.add("dropdowns-container"),this._dropdowns.classList.add("dropdowns"),this._buttonbar.classList.add("annotation-ui-buttonbar")}}],t&&or(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t}();function ar(e){return ar="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ar(e)}function sr(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,lr(o.key),o)}}function lr(e){var t=function(e){if("object"!=ar(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=ar(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==ar(t)?t:t+""}var cr=function(){return e=function e(t){var n=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),t=Object.assign({},{initialContent:"Enter text...",iconFactory:null},t),this._element=document.createElement("span"),this._textcontainer=document.createElement("span"),this._textcontainer.classList.add("text-container"),this._element.appendChild(this._textcontainer),this._textcontent=document.createElement("span"),this._textcontent.classList.add("text-content"),this._textcontainer.appendChild(this._textcontent);var o=this._textarea=document.createElement("textarea");this._textcontainer.appendChild(o),o.setAttribute("rows","1"),this._button=document.createElement("span"),this._element.appendChild(this._button),this._oldtext="";var r=t.iconFactory?t.iconFactory.makeFaIcon("fa-edit"):Q("fa-edit");this._button.appendChild(r),r.classList.add("edit-button","onhover"),this._element.classList.add("editablecontent"),this._textarea.textContent=t.initialContent,this._textarea.addEventListener("focusout",(function(){n._element.classList.contains("editing")&&(n._element.classList.remove("editing"),n._updateText(!0))})),this._textarea.addEventListener("keypress",(function(e){n._element.classList.contains("editing")&&(e.stopPropagation(),"Enter"!=e.key&&"Escape"!=e.key||(e.preventDefault(),n._textarea.blur()))})),this._textarea.addEventListener("input",(function(){n._updateText()})),this._element.addEventListener("keydown keyup",(function(e){n._element.classList.contains("editing")&&e.stopPropagation()})),this._button.addEventListener("click",(function(e){n._onEditClicked&&n._onEditClicked(e),n._element.classList.toggle("editing"),n._oldtext=n._textarea.value.trim(),n._textarea.select()}))},(t=[{key:"element",get:function(){return this._element}},{key:"onChanged",get:function(){return this._onChanged},set:function(e){if("function"!=typeof e&&null!==e)throw"Value must be a function or null";this._onChanged=e}},{key:"onEditClicked",get:function(){return this._onEditClicked},set:function(e){if("function"!=typeof e&&null!==e)throw"Value must be a function or null";this._onEditClicked=e}},{key:"_updateText",value:function(e){var t=this._textarea.value;e&&(t=t.trim()),this._textcontent.textContent=t,t!==this._oldtext&&this.onChanged&&this.onChanged(t)}},{key:"setText",value:function(e){this._textarea.value=e,this._textcontent.textContent=e}}])&&sr(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t}();function ur(e){var t=document.createElement("template");return t.innerHTML=e,1===t.content.children.length?t.content.children[0]:t.content.children}function pr(e){return pr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},pr(e)}function dr(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,fr(o.key),o)}}function fr(e){var t=function(e){if("object"!=pr(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=pr(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==pr(t)?t:t+""}var hr=function(){return e=function e(t,n){var o=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.paperItem=t;var r=this._element=ur("\n    <div class='feature'>\n        <div class='annotation-header hoverable-actions'>\n            <span class='onhover fa-solid fa-crop-simple bounding-element' data-action=\"bounds\" title='Bounding element'></span>\n            <span class='feature-item name'></span>\n            <span class='onhover fa-solid fa-palette' data-action='style' title='Open style editor'></span>\n            <span class='onhover fa-solid fa-binoculars' data-action='zoom-to' title='View this feature'></span>\n            <span class='onhover fa-solid fa-trash-can' data-action='trash' title='Remove'></span>\n        </div>\n    </div>\n    ");n.iconFactory?n.iconFactory.convertFaIcons(r):$(r),this.paperItem.FeatureUI=this,this._editableName=new cr,r.querySelector(".feature-item.name").appendChild(this._editableName.element),this._editableName.onChanged=function(e){o.setLabel(e,"user-defined")},this._editableName.onEditClicked=function(e){e.preventDefault(),e.stopPropagation()},Ge.set(r,{feature:this}),r.addEventListener("click",(function(e){if(e.target.matches("[data-action]")){e.stopPropagation(),e.stopImmediatePropagation(),e.preventDefault();var t=e.target.dataset.action;switch(t){case"trash":o.removeItem();break;case"bounds":o.useAsBoundingElement(!0);break;case"style":o.openStyleEditor(e);break;case"zoom-to":o.centerItem();break;default:console.log("No function set for action:",t)}}})),r.addEventListener("click",(function(e){e.stopPropagation(),o.paperItem.toggle(e.metaKey||e.ctrlKey)})),this.element=r,this.paperItem.on({selected:function(){r.classList.add("selected"),r.dispatchEvent(new Event("selected"))},deselected:function(){r.classList.remove("selected"),r.dispatchEvent(new Event("deselected"))},"selection:mouseenter":function(){r.classList.add("item-hovered")},"selection:mouseleave":function(){r.classList.remove("item-hovered")},"item-replaced":function(e){"user-defined"==o.label.source&&(e.item.displayName=o.label),o.paperItem=e.item,o.paperItem.FeatureUI=o,o.updateLabel()},"display-name-changed":function(e){o.updateLabel()},removed:function(e){e.item==o.paperItem&&o.remove()}}),this.paperItem.selected&&this.paperItem.emit("selected"),this.label?this.updateLabel():this.setLabel("Creating...","initializing")},t=[{key:"label",get:function(){return this.paperItem.displayName},set:function(e){return this.setLabel(e)}},{key:"setLabel",value:function(e,t){var n=new String(e);return n.source=t,this.paperItem.displayName=n,this.updateLabel(),n}},{key:"updateLabel",value:function(){this._editableName.setText(this.label)}},{key:"removeItem",value:function(){this.paperItem.remove(),this.paperItem.deselect()}},{key:"remove",value:function(){this._element.remove(),this._element.dispatchEvent(new Event("removed"))}},{key:"useAsBoundingElement",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this.paperItem.canBeBoundingElement)return!1;var t=this._element.querySelector('[data-action="bounds"]');e?t.classList.toggle("active"):t.classList.add("active");var n=t.classList.contains("active");return this.paperItem.isBoundingElement=n,n}},{key:"openStyleEditor",value:function(){this.paperItem.project.emit("edit-style",{item:this.paperItem})||console.warn("No event listeners are registered for paperScope.project for event 'edit-style'")}},{key:"centerItem",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=this.paperItem.project.overlay.viewer.viewport,n=this.paperItem.bounds,o=t.imageToViewportCoordinates(n.center.x,n.center.y),i=1.5,a=t.imageToViewportCoordinates(n.center.x-n.width/i,n.center.y-n.height/i),s=t.imageToViewportCoordinates(2*n.width/i,2*n.height/i),l=new r.Rect(a.x,a.y,s.x,s.y),c=t.getBounds();l.width>c.width||l.height>c.height?t.fitBounds(l,e):t.panTo(o,e)}}],t&&dr(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t}();function yr(e){return yr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},yr(e)}function vr(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,mr(o.key),o)}}function mr(e){var t=function(e){if("object"!=yr(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=yr(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==yr(t)?t:t+""}var gr=function(){return e=function e(t){var n=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),t.parent?t.selector?t.dropTarget?(this.element=t.parent,this.selector=t.selector,this.droptarget=t.dropTarget,this.onDrop=t.onDrop,this.placeholder=null,this.dragging=null,this.refresh(),this.droptarget.addEventListener("dragover",(function(e){return e.preventDefault(),!1})),this.droptarget.addEventListener("dragleave",(function(e){return e.preventDefault(),!1})),this.droptarget.addEventListener("dragend",(function(e){if(n.dragging)return e.preventDefault(),n.cleanupDropTarget(),!1})),this.element.addEventListener("dragstart",(function(e){e.target.matches(n.selector)&&(e.stopPropagation(),n.dragging=e.target,n.placeholder=e.target.cloneNode(!0),n.placeholder.classList.add("draganddrop-placeholder"),e.target.classList.add("draganddrop-dragging"),n.setupDropTarget())})),this.element.addEventListener("dragend",(function(e){e.target.matches(n.selector)&&(e.stopPropagation(),e.target.classList.remove("draganddrop-dragging","draganddrop-hide"),n.placeholder&&n.placeholder.remove(),n.placeholder=null,n.dragging=null,n.cleanupDropTarget())})),this.element.addEventListener("dragleave",(function(e){e.target.matches(n.selector)&&e.stopPropagation()})),this.element.addEventListener("drop",(function(e){n.dragging&&n.placeholder.parentNode==n.droptarget&&(e.stopPropagation(),n.placeholder.replaceWith(n.dragging),n.dragging=null,n.placeholder=null,n.onDrop&&n.onDrop())})),this.element.addEventListener("dragover",(function(e){if(n.dragging)if(e.preventDefault(),n.dragging.classList.add("draganddrop-hide"),e.target.matches(n.selector)){e.stopPropagation();var t=e.target.getBoundingClientRect().top,o=e.target.getBoundingClientRect().bottom;if(n.placeholder==e.target)return;e.clientY<(t+o)/2?e.target.parentNode.insertBefore(n.placeholder,e.target):e.target.parentNode.insertBefore(n.placeholder,e.target.nextSibling)}else e.target==n.element&&(n.droptarget.appendChild(n.placeholder),e.stopPropagation())}))):console.error("droptarget is required"):console.error("selector is required"):console.error("element is required")},(t=[{key:"refresh",value:function(){this.element.querySelectorAll(this.selector).forEach((function(e){e.setAttribute("draggable",!0)}))}},{key:"setupDropTarget",value:function(){this.droptarget.classList.add("draganddrop-drop-target")}},{key:"cleanupDropTarget",value:function(){this.droptarget.classList.remove("draganddrop-drop-target")}}])&&vr(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t}();function br(e){return br="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},br(e)}function wr(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,Ar(o.key),o)}}function Ar(e){var t=function(e){if("object"!=br(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=br(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==br(t)?t:t+""}function Cr(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(Cr=function(){return!!e})()}function Sr(e){return Sr=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},Sr(e)}function Ir(e,t){return Ir=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},Ir(e,t)}var kr=function(){function e(t){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),(n=function(e,t,n){return t=Sr(t),function(e,t){if(t&&("object"==br(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,Cr()?Reflect.construct(t,n||[],Sr(e).constructor):t.apply(e,n))}(this,e,[{type:"Feature",geometry:null}])).paperItem=new i.Path,n.paperItem.style=new i.Style(t),n.paperItem.initializeGeoJSONFeature=Or,n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Ir(e,t)}(e,jt),t=e,o=[{key:"supportsGeoJSONType",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return null===e.toLowerCase()&&null===t}}],(n=[{key:"getGeoJSONType",value:function(){return{type:null}}},{key:"getCoordinates",value:function(){return[]}},{key:"getProperties",value:function(){return this.paperItem.style}}])&&wr(t.prototype,n),o&&wr(t,o),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,n,o}();function Or(e,t){var n={geometry:{type:e,coordinates:[],properties:{subtype:t}},properties:this.style},o=i.Item.fromGeoJSON(n);return this.replaceWith(o),o}function Er(e){return Er="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Er(e)}function Pr(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,_r(o.key),o)}}function _r(e){var t=function(e){if("object"!=Er(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=Er(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==Er(t)?t:t+""}var xr=function(){return e=function e(t,n){var o=this;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.element=ur("\n    <div class='feature-collection'>\n        <div class='annotation-header hoverable-actions'>\n            <span class=\"visibility-toggle\"><span class=\"fa fa-eye\" data-action=\"hide\"></span><span class=\"fa fa-eye-slash\" data-action=\"show\"></span></span>\n            <span class='annotation-name name'></span>\n            <span class='onhover fa-solid fa-palette' data-action='style' title='Open style editor'></span>\n            <span class='onhover fa-solid fa-trash-can' data-action='trash' title='Remove feature collection'></span>\n        </div>\n        <div class=\"flex-row features\">\n            <div class=\"toggle-list btn-group btn-group-sm\"><button class=\"btn btn-default\"><span class='fa-solid fa-caret-down' data-action=\"collapse-down\"></span><span class='fa-solid fa-caret-up' data-action=\"collapse-up\"></span></button></div>\n            <div class=\"annotation-details\">\n                <div>\n                    <div class='features-summary feature-item name'><span class='num-annotations'></span> annotation element<span class='pluralize'></span></div>\n                    <div class='features-list'></div>\n                </div>\n                <div class='new-feature feature'><span class='fa fa-plus' data-action=\"add-feature\"></span>Add feature</div>\n            </div>\n        </div>\n    </div>\n    "),n.iconFactory?n.iconFactory.convertFaIcons(this.element):$(this.element),this._editableName=new cr({iconFactory:n.iconFactory}),this.element.querySelector(".annotation-name.name").appendChild(this._editableName.element),this._editableName.onChanged=function(e){o.label=e},this._editableName.onEditClicked=function(e){e.preventDefault(),e.stopPropagation()},this._featurelist=this.element.querySelector(".features-list"),this._dragAndDrop=new gr({parent:this.element,selector:".features-list .feature",dropTarget:this._featurelist,onDrop:function(){o.features.forEach((function(e){return o.group.addChild(e.paperItem)}))}}),this.group=t,this.group.on({"selection:mouseenter":function(){o.element.classList.add("svg-hovered"),o.element.dispatchEvent(new Event("mouseover"))},"selection:mouseleave":function(){o.element.classList.remove("svg-hovered"),o.element.dispatchEvent(new Event("mouseout"))},selected:function(){o.element.classList.add("selected"),o.element.dispatchEvent(new Event("selected"))},deselected:function(){o.element.classList.remove("selected"),o.element.dispatchEvent(new Event("deselected"))},"display-name-changed":function(){o.updateLabel()},removed:function(){o.remove()},"child-added":function(e){var t=e.item.FeatureUI||new hr(e.item,n);o._addFeature(t)}}),this.group.featureCollectionUI=this,this.remove=function(){o.element.remove()},this.numFeatures=function(){return o.features.length},this._addFeature=function(e){return e.paperItem.updateFillOpacity(),o._featurelist.appendChild(e.element),o._sortableDebounce&&window.clearTimeout(o._sortableDebounce),self._sortableDebounce=window.setTimeout((function(){return o._dragAndDrop.refresh()}),15),e.element},this.createFeature=function(){var e=this.group.defaultStyle,t={fillColor:new i.Color(e.fillColor),strokeColor:new i.Color(e.strokeColor),rescale:r.extend(!0,{},e.rescale),fillOpacity:e.fillOpacity,strokeOpacity:e.strokeOpacity,strokeWidth:e.strokeWidth},n=new kr(t);return this.group.addChild(n.paperItem),n.paperItem},this.ui={setOpacity:function(e){o.group.opacity=e},setFillOpacity:function(e){o.group.fillOpacity=e}},Ge.set(this.element,{featureCollection:this}),this.label=this.group.displayName,this.element.addEventListener("click",(function(e){e.stopPropagation()})),this.element.querySelector(".toggle-list").addEventListener("click",(function(e){var t=o._featurelist.children.length;o.element.querySelector(".num-annotations").textContent=t,o.element.querySelector(".features-summary").dataset.numElements=t,o.element.querySelector(".features").classList.toggle("collapsed"),e.stopPropagation(),e.preventDefault()})),this.element.addEventListener("click",(function(e){if(e.target.matches(".annotation-header [data-action]")){e.stopPropagation(),e.stopImmediatePropagation(),e.preventDefault();var t=e.target.dataset.action;switch(t){case"trash":o.removeLayer(!0);break;case"style":o.openStyleEditor(e);break;case"show":case"hide":o.toggleVisibility();break;default:console.log("No function set for action:",t)}}})),this.element.querySelector(".new-feature").addEventListener("click",(function(e){e.stopPropagation(),o.createFeature().select()})),this},t=[{key:"features",get:function(){return Array.from(this._featurelist.querySelectorAll(".feature")).map((function(e){return Ge.get(e,"feature")}))}},{key:"label",get:function(){return this.group.displayName},set:function(e){return this.setLabel(e)}},{key:"setLabel",value:function(e,t){var n=new String(e);return n.source=t,this.group.displayName=n,this.updateLabel(),n}},{key:"updateLabel",value:function(){this._editableName.setText(this.label)}},{key:"toggleVisibility",value:function(){this.element.classList.toggle("annotation-hidden"),this.group.visible=!this.element.classList.contains("annotation-hidden")}},{key:"removeLayer",value:function(){(!(arguments.length>0&&void 0!==arguments[0])||arguments[0])&&1==window.confirm("Remove this layer?")&&this.group.remove()}},{key:"openStyleEditor",value:function(e){this.group.project.emit("edit-style",{item:this.group})||console.warn("No event listeners are registered for paperScope.project for event 'edit-style'")}}],t&&Pr(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t}();function Tr(e){return Tr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Tr(e)}function jr(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,Br(o.key),o)}}function Br(e){var t=function(e){if("object"!=Tr(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=Tr(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==Tr(t)?t:t+""}function Lr(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(Lr=function(){return!!e})()}function Mr(e){return Mr=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},Mr(e)}function Rr(e,t){return Rr=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},Rr(e,t)}var Nr=function(){function e(t,n){var o;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e);var r,i,a=o=function(e,t,n){return t=Mr(t),function(e,t){if(t&&("object"==Tr(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,Lr()?Reflect.construct(t,n||[],Mr(e).constructor):t.apply(e,n))}(this,e);o._tk=t,o.paperScope=o._tk.paperScope,o.paperScope.project.on("feature-collection-added",(function(e){return o._onFeatureCollectionAdded(e)})),o.element=(r=ur('\n        <div class="annotation-ui-mainwindow" title="Annotations">\n            <div><span class=\'fa-save\'></span> <span class="annotation-ui-title">Annotation Interface</span></div>\n            <div class=\'annotation-ui-toolbar annotation-visibility-controls\'>                \n                <div class="visibility-buttons btn-group btn-group-sm disable-when-deactivated" role="group">\n                    <button class="btn btn-default toggle-annotations" type="button" title="Toggle annotations">\n                        <span class="glyphicon glyphicon-eye-open fa fa-eye"></span><span class="glyphicon glyphicon-eye-close fa fa-eye-slash"></span>\n                    </button>\n                </div>\n                <span class="annotation-opacity-container disable-when-annotations-hidden" title="Change total opacity">\n                    <input class="annotation-total-opacity" type="range" min="0" max="1" step="0.01" value="1">\n                </span>\n                <span class="annotation-opacity-container disable-when-annotations-hidden" title="Change fill opacity">\n                    <input class="annotation-fill-opacity" type="range" min="0" max="1" step="0.01" value="0.25">\n                </span>\n            </div>\n            <div class=\'annotation-ui-feature-collections disable-when-annotations-hidden disable-when-deactivated\'></div>\n            <div class=\'new-feature-collection disable-when-deactivated\'><span class=\'glyphicon glyphicon-plus fa fa-plus\'></span>Add Feature Collection</div>\n            <div class=\'icon-factory-container\'></div>\n        </div>'),i="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)})),r.dataset.uiId=i,r),o.iconFactory=new K(o.element.querySelector(".icon-factory-container")),o.iconFactory.convertFaIcons(o.element),o.element.querySelector(".new-feature-collection").addEventListener("click",(function(e){e.stopPropagation(),e.preventDefault(),o._tk.addEmptyFeatureCollectionGroup()})),o.element.querySelector(".annotation-ui-feature-collections").addEventListener("click",(function(){0===this.textContent.trim().length&&a._tk.addEmptyFeatureCollectionGroup()})),o.element.querySelector(".toggle-annotations").addEventListener("click",(function(){var e=o.element.querySelectorAll(".annotation-ui-feature-collections .feature-collection.annotation-hidden");e.length>0?e.forEach((function(e){e.querySelectorAll('[data-action="show"]').forEach((function(e){return e.dispatchEvent(new Event("click",{bubbles:!0}))}))})):o.element.querySelectorAll('.annotation-ui-feature-collections .feature-collection:not(.hidden) [data-action="hide"]').forEach((function(e){return e.dispatchEvent(new Event("click",{bubbles:!0}))}))})),o._dragAndDrop=new gr({parent:o.element,selector:".feature-collection",dropTarget:o.element.querySelector(".annotation-ui-feature-collections"),onDrop:function(){o.element.querySelectorAll(".annotation-ui-feature-collections .feature-collection").forEach((function(e){Ge.get(e,"featureCollection").group.bringToFront()}))}}),o.element.addEventListener("selected",(function(e){e.target.matches(".feature")&&(e.stopPropagation(),this.classList.add("selected"),this.scrollIntoView({block:"nearest"}))})),o.element.addEventListener("deselected",(function(e){e.target.matches(".feature")&&(e.stopPropagation(),this.classList.remove("selected"))})),o.element.addEventListener("click",(function(e){e.target.matches(".toggle-list")&&(this.closest(".features").classList.toggle("collapsed"),e.stopPropagation())})),o.element.addEventListener("value-changed",(function(){o.element.querySelector(".feature.selected").dispatchEvent(new Event("selected")),o.element.querySelector(".feature-collection.active").dispatchEvent(new Event("selected"))}));var s=o.element.querySelector("input.annotation-total-opacity");s.addEventListener("input",(function(){var e,t;e=this.value,(t=Array.from(a.element.querySelectorAll(".feature-collection")).reduce((function(e,t){return t.classList.contains("selected")?e.selected.push(t):t.matches(":hover,.svg-hovered")?e.hover.push(t):e.other.push(t),e}),{selected:[],hover:[],other:[]})).selected.length>0?(t.selected.forEach((function(t){var n=1*e,o=Ge.get(t,"featureCollection");o&&o.ui.setOpacity(n)})),t.hover.concat(t.other).forEach((function(t){var n=.25*e,o=Ge.get(t,"featureCollection");o&&o.ui.setOpacity(n)}))):t.hover.length>0?(t.hover.forEach((function(t){var n=1*e,o=Ge.get(t,"featureCollection");o&&o.ui.setOpacity(n)})),t.other.forEach((function(t){var n=.25*e,o=Ge.get(t,"featureCollection");o&&o.ui.setOpacity(n)}))):t.other.forEach((function(t){var n=1*e,o=Ge.get(t,"featureCollection");o&&o.ui.setOpacity(n)}))})),s.dispatchEvent(new Event("input"));var l=o.element.querySelector("input.annotation-fill-opacity");return l.addEventListener("input",(function(){a.paperScope.view.fillOpacity=this.value})),l.dispatchEvent(new Event("input")),o}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Rr(e,t)}(e,r.EventSource),t=e,(n=[{key:"hide",value:function(){this.element.classList.add("hidden"),this.raiseEvent("hide")}},{key:"show",value:function(){this.element.classList.remove("hidden"),this.raiseEvent("show")}},{key:"toggle",value:function(){this.element.matches(":visible")?this.hide():this.show()}},{key:"deactivate",value:function(){this.element.classList.add("deactivated")}},{key:"activate",value:function(){this.element.classList.remove("deactivated")}},{key:"destroy",value:function(){this.raiseEvent("destroy"),this.element.remove()}},{key:"_onFeatureCollectionAdded",value:function(e){var t=e.group,n=new xr(t,{iconFactory:this.iconFactory});this.element.querySelector(".annotation-ui-feature-collections").appendChild(n.element),this._dragAndDrop.refresh(),n.element.dispatchEvent(new Event("element-added")),setTimeout((function(){n.element.classList.add("inserted")}),30)}}])&&jr(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,n}();function Fr(e){return Fr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Fr(e)}function Dr(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,Gr(o.key),o)}}function Gr(e){var t=function(e){if("object"!=Fr(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=Fr(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==Fr(t)?t:t+""}var zr=function(){return e=function e(t){var n=this,o=t.innerHTML,r=t.title;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e);var i=document.createElement("div");document.querySelector("body").appendChild(i),i.style.position="fixed",i.style.width="100vw",i.style.height="100vh",i.style.left=0,i.style.top=0;var a=document.createElement("div");i.appendChild(a),a.style.backgroundColor="gray",a.style.opacity=.9,a.style.width="100%",a.style.height="100%",a.style.position="absolute";var s=document.createElement("div");s.classList.add("ui-dialog"),i.appendChild(s),s.style.setProperty("max-height","80%"),s.style.setProperty("max-width","80%"),s.style.left="50%",s.style.top="50%",s.style.transform="translate(-50%, -50%)",s.style.overflow="auto",s.style.position="relative",s.style.backgroundColor="white",s.style.display="inline-block",s.style.padding="2px",s.style.borderRadius="2px";var l=document.createElement("div");s.appendChild(l),l.style.padding="0.3em 0.6em",l.style.backgroundColor="rgb(233, 233, 233)",l.style.borderColor="rgb(220, 220, 220)",l.style.borderRadius="2px",l.style.display="flex";var c=document.createElement("label");l.appendChild(c),c.innerText=r,c.style.fontWeight="bold",c.style.flexGrow=1;var u=document.createElement("button");u.innerText="x",u.style.marginLeft="1em",l.appendChild(u),u.addEventListener("click",(function(){return n.hide()}));var p=document.createElement("div");s.appendChild(p),p.innerHTML=o,a.addEventListener("click",(function(){return n.hide()})),this.element=i,this.container=p,this.background=a,this.foreground=s,this.topbar=l,this.hide()},(t=[{key:"show",value:function(){this.element.style.display="block"}},{key:"hide",value:function(){this.element.style.display="none"}},{key:"toggle",value:function(){"none"===this.element.style.display?this.show():this.hide()}}])&&Dr(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t}();function Hr(e){return Hr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Hr(e)}function Ur(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,Wr(o.key),o)}}function Wr(e){var t=function(e){if("object"!=Hr(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=Hr(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==Hr(t)?t:t+""}var Vr=function(){return e=function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e);var o=this;function r(e){var n,o=(null===(n=t.viewer.world.getItemAt(0))||void 0===n?void 0:n.source.name)||"";return o.length>0&&(o+=e),o}function a(){var e,t;null===(e=o.element.querySelector(".featurecollection-list"))||void 0===e||e.replaceChildren(),null===(t=o.element.querySelector(".finalize"))||void 0===t||t.replaceChildren()}function s(e){var t=o.element.querySelector(".featurecollection-list");return t.replaceChildren(),e.forEach((function(e){var n=e.label||e.displayName,o=document.createElement("div");t.appendChild(o);var r=document.createElement("input");o.appendChild(r),r.setAttribute("type","checkbox"),r.setAttribute("checked","true"),Ge.set(r,"fc",e);var i=document.createElement("label");i.innerText=n,o.appendChild(i)})),t}function l(e,t,n,r){function i(e,t,n){e&&(Object.keys(localStorage).includes(t)?n.classList.add("key-exists"):n.classList.remove("key-exists"))}var a,s=o.element.querySelector(".finalize"),l=document.createElement("button");if(l.innerText=e,s.appendChild(l),t){var c=document.createElement("div"),u=document.createElement("div");c.appendChild(u),s.appendChild(c),u.innerText=t,(a=new cr).setText(n),c.appendChild(a.element),r&&c.classList.add("localstorage-key-test"),a.onChanged=function(e){l.setAttribute("data-label",e),i(r,e,c)},i(r,n,c)}return s.appendChild(l),l.setAttribute("data-label",n),l}this.dialog=new zr({innerHTML:"\n                <div class=\"annotation-ui-filedialog\" title=\"Save and Load Feature Collections\">\n                    <div class=\"file-actions\">\n                        <div class='header'>1. Available actions</div>\n                        <button class='btn' data-action='geojson-load'>Load GeoJSON</button>\n                        <button class='btn' data-action='ls-load'>Load from browser</button>\n                        <hr>\n                        <button class='btn' data-action='geojson-save'>Save GeoJSON</button>\n                        <button class='btn' data-action='svg-export'>Export as SVG</button>\n                        <button class='btn' data-action='png-export'>Rasterize to PNG</button>\n                        <button class='btn' data-action='ls-store'>Store in browser</button>\n                    </div>\n                    <div class='featurecollection-selection'>\n                        <div class='header'>2. Select Feature Collections</div>\n                        <div class='featurecollection-list'></div>\n                    </div>\n                    <div class=\"finalize-panel\">\n                        <div class='header'>3. Finalize</div>\n                        <div class='finalize'>\n                        \n                        </div>\n                    </div>\n                </div>",title:""}),this.element=this.dialog.container,this.element.querySelector('button[data-action="geojson-load"]').addEventListener("click",(function(){a();var e=document.createElement("input");e.type="file",e.accept="text/geojson,.geojson,text/json,.json",e.addEventListener("change",(function(){var e=this.files[0],n=new FileReader,r=[];n.onload=function(){try{r=JSON.parse(this.result)}catch(e){return void alert("Bad file - JSON could not be parsed")}Array.isArray(r)||(r=[r]);var n=Array.from(new Set(r.map((function(e){return e.type}))));if(0==n.length&&o.element.find(".featurecollection-list").text("Bad file - no Features or FeatureCollections were found"),n.length>1)alert("Bad file - valid geoJSON consists of an array of objects with single type (FeatureCollection or Feature)");else{if("Feature"==n[0]){var i=[{type:"FeatureCollection",features:r,properties:{label:e.name}}];r=i}s(r);var a=document.createElement("button");o.element.querySelector(".finalize").appendChild(a),a.innerText="Replace existing layers",a.addEventListener("click",(function(){return t.addFeatureCollections(r,!0)}));var l=document.createElement("button");o.element.querySelector(".finalize").appendChild(l),l.innerText="Add new layers",l.addEventListener("click",(function(){return t.addFeatureCollections(r,!1)}))}},n.readAsText(e)})),e.click()})),this.element.querySelector('button[data-action="geojson-save"]').addEventListener("click",(function(){a();var e=s(t.toGeoJSON());l("Create file","Choose file name:",r("-")+"FeatureCollections.json").addEventListener("click",(function(){var t;null===(t=this.parentElement.querySelector(".download-link"))||void 0===t||t.remove();var n=Array.from(e.querySelectorAll("input:checked")).map((function(e){return Ge.get(e,"fc")})),o=JSON.stringify(n),r=new Blob([o],{type:"text/json"}),i=this.getAttribute("data-label"),a=document.createElement("div");a.classList.add("download-link"),this.parentElement.insertBefore(a,this.nextSibling);var s=document.createElement("a");s.href=window.URL.createObjectURL(r),s.download=i,s.target="_blank",s.innerText="Download file",a.appendChild(s)}))})),this.element.querySelector('button[data-action="svg-export"]').addEventListener("click",(function(){a();var e=s(t.getFeatureCollectionGroups());l("Create file","Choose file name:",r("-")+"FeatureCollections.svg").addEventListener("click",(function(){var t;null===(t=this.parentElement.querySelector(".download-link"))||void 0===t||t.remove();var n=Array.from(e.querySelectorAll("input:checked")).map((function(e){return Ge.get(e,"fc")}));if(n.length>0){var o=new i.PaperScope;o.setup(),n.forEach((function(e){o.project.activeLayer.addChildren(e.layer.clone({insert:!1,deep:!0}).children)}));var r=new Blob([o.project.exportSVG({asString:!0,bounds:"content"})],{type:"text/svg"}),a=this.getAttribute("data-label"),s=document.createElement("div");s.classList.add("download-link"),this.parentElement.insertBefore(s,this.nextSibling);var l=document.createElement("a");l.href=window.URL.createObjectURL(r),l.download=a,l.target="_blank",l.innerText="Download file",s.appendChild(l)}}))})),this.element.querySelector('button[data-action="png-export"]').addEventListener("click",(function(){a();var e=s(t.getFeatureCollectionGroups());l("Create file","Choose file name:",r("-")+"raster.png").addEventListener("click",(function(){var t;null===(t=this.parentElement.querySelector(".download-link"))||void 0===t||t.remove();var n=Array.from(e.querySelectorAll("input:checked")).map((function(e){return Ge.get(e,"fc")}));if(n.length>0){var o=new i.PaperScope;o.setup(),n.forEach((function(e){o.project.activeLayer.addChildren(e.layer.clone({insert:!1,deep:!0}).children)}));var r=this.getAttribute("data-label"),a=document.createElement("div");a.classList.add("download-link"),this.parentElement.insertBefore(a,this.nextSibling);var s=document.createElement("a");s.href=o.project.activeLayer.rasterize({insert:!1}).toDataURL(),s.download=r,s.target="_blank",s.innerText="Download file",a.appendChild(s)}}))})),this.element.querySelector('button[data-action="ls-store"]').addEventListener("click",(function(){a();var e=s(t.toGeoJSON());l("Save data","Local storage key:",r(),!0).addEventListener("click",(function(){var t=Array.from(e.querySelectorAll("input:checked")).map((function(e){return Ge.get(e,"fc")})),n=JSON.stringify(t),o=this.getAttribute("data-label");window.localStorage.setItem(o,n)}))})),this.element.querySelector('button[data-action="ls-load"]').addEventListener("click",(function(){a();var e=[],n=r(),i=Object.keys(window.localStorage),l=o.element.querySelector(".featurecollection-list");l.innerText="";var c=document.createElement("div");c.classList.add("localstorage-key-list"),l.appendChild(c),i.sort((function(e,t){return e.localeCompare(t)})).forEach((function(e){var t=document.createElement("div");t.classList.add("localstorage-key"),t.style.order=e==n?0:1,t.innerText=e,c.appendChild(t)})),c.querySelectorAll(".localstorage-key").forEach((function(n){return n.addEventListener("click",(function(){var n=window.localStorage.getItem(this.textContent);if(n){try{e=JSON.parse(n)}catch(e){return void alert("Bad data - JSON could not be parsed")}s(e);var r=document.createElement("button");r.innerText="Replace existing layers",r.addEventListener("click",(function(){return t.addFeatureCollections(e,!0)})),o.element.querySelector(".finalize").appendChild(r);var i=document.createElement("button");i.innerText="Add new layers",i.addEventListener("click",(function(){return t.addFeatureCollections(e,!1)})),o.element.querySelector(".finalize").appendChild(i)}else alert("No data found in local storage for key=".concat(this.textContent))}))}))}))},(t=[{key:"show",value:function(){this.dialog.show()}},{key:"hide",value:function(){this.dialog.hide()}},{key:"toggle",value:function(){this.dialog.toggle()}}])&&Ur(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t}();function Yr(e){return Yr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Yr(e)}function qr(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,o=Array(t);n<t;n++)o[n]=e[n];return o}function Jr(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,Zr(o.key),o)}}function Zr(e){var t=function(e){if("object"!=Yr(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=Yr(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==Yr(t)?t:t+""}var Xr=function(){return e=function e(t,n){var o=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),n=this.options=Object.assign({autoOpen:!0,featureCollections:[],addButton:!0,addToolbar:!0,tools:null,addLayerUI:!0,addFileButton:!0,buttonTogglesToolbar:!0,buttonTogglesLayerUI:!0},n);var r=this._viewer=t.viewer;this._isOpen=!!n.autoOpen,this._toolbar=new ir(t.overlay.paperScope,n.tools),this._fileDialog=new Vr(t,{appendTo:r.element}),this._filebutton=null,n.addFileButton&&(this._filebutton=t.overlay.addViewerButton({onClick:function(){o._fileDialog.toggle()},faIconClass:"fa-save",tooltip:"Save/Load Annotations"})),this._layerUI=new Nr(t,n.addFileButton),n.addLayerUI&&this._addToViewer(),n.autoOpen?(this._layerUI.show(),this._toolbar.show()):(this._layerUI.hide(),this._toolbar.hide()),this._button=null,n.addButton&&(this._button=t.overlay.addViewerButton({onClick:function(){o._isOpen=!o._isOpen,o._isOpen?(o.options.buttonTogglesToolbar&&o._toolbar.show(),o.options.buttonTogglesLayerUI&&o._layerUI.show()):(o.options.buttonTogglesToolbar&&o._toolbar.hide(),o.options.buttonTogglesLayerUI&&o._layerUI.hide())},faIconClass:"fa-pencil",tooltip:"Annotation Interface"})),n.featureCollections&&t.loadGeoJSON(n.featureCollections)},(t=[{key:"destroy",value:function(){if(this._layerUI.destroy(),this._toolbar.destroy(),this._button){var e=this._viewer.buttonGroup.buttons.indexOf(this._button);e>-1&&this._viewer.buttonGroup.buttons.splice(e,1),this._button.element.remove()}if(this._filebutton){var t=this._viewer.buttonGroup.buttons.indexOf(this._filebutton);t>-1&&this._viewer.buttonGroup.buttons.splice(t,1),this._filebutton.element.remove()}}},{key:"showUI",value:function(){this.ui.show()}},{key:"hideUI",value:function(){this.ui.hide()}},{key:"showToolbar",value:function(){this.toolbar.show()}},{key:"hideToolbar",value:function(){this.toolbar.hide()}},{key:"ui",get:function(){return this._layerUI}},{key:"toolbar",get:function(){return this._toolbar}},{key:"element",get:function(){return this._layerUI.element}},{key:"_addToViewer",value:function(){var e=document.createElement("div");this._viewer.element.appendChild(e);var t=document.createElement("div"),n=document.createElement("div"),o=document.createElement("div"),r=document.createElement("div"),i=document.createElement("div"),a=document.createElement("div"),s={"annotation-ui-grid":e,top:t,bottom:n,center:o,left:r,right:i,"resize-right":a};Object.entries(s).forEach((function(e){var t=function(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var o,r,i,a,s=[],l=!0,c=!1;try{if(i=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;l=!1}else for(;!(l=(o=i.call(n)).done)&&(s.push(o.value),s.length!==t);l=!0);}catch(e){c=!0,r=e}finally{try{if(!l&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(c)throw r}}return s}}(e,t)||function(e,t){if(e){if("string"==typeof e)return qr(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?qr(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}(e,2),n=t[0];return t[1].classList.add(n)})),[o,i,r,t,n].forEach((function(t){return e.appendChild(t)})),o.appendChild(this._viewer.container),i.appendChild(a),i.appendChild(this.element),t.appendChild(this._toolbar.element);var l,c=this.element,u=document.querySelector("body");function p(e){if(a.classList.contains("resizing")){if(e.movementX){var t=c.getBoundingClientRect();c.style.width=t.right-e.x-l+"px"}e.preventDefault()}}function d(e){document.removeEventListener("mousemove",p),document.removeEventListener("mouseleave",d),document.removeEventListener("mouseup",d),u.classList.remove(".annotation-ui-noselect"),a.classList.remove("resizing")}a.addEventListener("mousedown",(function(e){this.classList.add("resizing"),u.classList.add(".annotation-ui-noselect"),document.addEventListener("mousemove",p),document.addEventListener("mouseleave",d),document.addEventListener("mouseup",d),l=c.getBoundingClientRect().left-e.x}))}}])&&Jr(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t}();function Kr(){var e=this;this._computedFillOpacity=this.hierarchy.filter((function(t){return"fillOpacity"in t&&(t._multiplyOpacity||t==e)})).reduce((function(e,t){return e*t.fillOpacity}),1),this.fillColor&&(this.fillColor.alpha=this._computedFillOpacity)}i.View.prototype.getZoom=function(){var e=this._decompose().scaling;return(Math.abs(e.x)+Math.abs(e.y))/2},i.CanvasView.prototype._setElementSize.base=function(e,t){var n=this._element;e=Math.round(e),t=Math.round(t),n&&(n.width!==e&&(n.width=e),n.height!==t&&(n.height=t))},i.View.prototype.setRotation=function(e,t){var n=e-(this._rotation||0);this.rotate(n,t),this._rotation=r.positiveModulo(e,360),this.emit("rotate",{rotatedBy:n,currentRotation:this._rotation,center:t})},i.View.prototype.setFlipped=function(e,t){e!==this.getFlipped()&&(this.rotate(-t),this.scale(-1,1),this.rotate(t),this.emit("flip",{flipped:e}))},i.View.prototype.getFlipped=function(e){return this.scaling.x*this.scaling.y<0},Object.defineProperty(i.Item.prototype,"hierarchy",{get:function(){return this.parent?this.parent.hierarchy.concat(this):this.project?this.project.hierarchy.concat(this):[this.view,this]}}),Object.defineProperty(i.Item.prototype,"descendants",{get:function(){return(this.children?this.children.map((function(e){return e.descendants})).flat():[]).concat(this.isGeoJSONFeature?[this]:[])}}),Object.defineProperty(i.Item.prototype,"fillOpacity",{set:function(e){(this.style||this.defaultStyle).fillOpacity=e,this.descendants.forEach((function(e){return e.updateFillOpacity()}))},get:function(){return(this.style||this.defaultStyle).fillOpacity}}),Object.defineProperty(i.Item.prototype,"strokeOpacity",{set:function(e){(this.style||this.defaultStyle).strokeOpacity=e,this.descendants.forEach((function(e){return e.updateStrokeOpacity()}))},get:function(){return(this.style||this.defaultStyle).strokeOpacity}}),Object.defineProperty(i.Item.prototype,"rescale",{set:function(e){this._style.rescale=e},get:function(){return this._style.rescale}}),Object.defineProperty(i.Item.prototype,"stroke",{get:function(){return this._stroke},set:function(e){this._stroke=e,this.strokeWidth=e/(this.view.getZoom()*this.hierarchy.filter((function(e){return e.tiledImage}))[0].scaling.x)}}),Object.defineProperty(i.Style.prototype,"fillOpacity",{set:function(e){this._fillOpacity=this._values.fillOpacity=e},get:function(){return void 0===this._fillOpacity?1:this._fillOpacity}}),Object.defineProperty(i.Style.prototype,"strokeOpacity",{set:function(e){this._strokeOpacity=this._values.strokeOpacity=e},get:function(){return void 0===this._strokeOpacity?1:this._strokeOpacity}}),Object.defineProperty(i.Style.prototype,"rescale",{set:function(e){this._rescale=this._values.rescale=e},get:function(){return this._rescale}}),Object.defineProperty(i.CompoundPath.prototype,"descendants",{get:function(){return[this]}}),Object.defineProperty(i.Project.prototype,"hierarchy",{get:function(){return this.parent?this.parent.hierarchy.concat(this):this.project?this.project.hierarchy.concat(this):[this.view,this]}}),Object.defineProperty(i.Project.prototype,"fillOpacity",{set:function(e){(this.style||this.defaultStyle).fillOpacity=e,this.descendants.forEach((function(e){return e.updateFillOpacity()}))},get:function(){return(this.style||this.defaultStyle).fillOpacity}}),Object.defineProperty(i.View.prototype,"fillOpacity",{set:function(e){this._fillOpacity=e,this._project.descendants.forEach((function(e){return e.updateFillOpacity()}))},get:function(){return this._fillOpacity}}),Object.defineProperty(i.View.prototype,"_fillOpacity",{value:1,writable:!0}),Object.defineProperty(i.Project.prototype,"strokeOpacity",{set:function(e){(this.style||this.defaultStyle).strokeOpacity=e,this.descendants.forEach((function(e){return e.updateStrokeOpacity()}))},get:function(){return(this.style||this.defaultStyle).strokeOpacity}}),i.Item.prototype.updateFillOpacity=Kr,i.Item.prototype.updateStrokeOpacity=function(){var e=this;this.strokeColor&&(this.strokeColor.alpha=this.hierarchy.filter((function(t){return"strokeOpacity"in t&&(t._multiplyOpacity||t==e)})).reduce((function(e,t){return e*t.strokeOpacity}),1))},i.Project.prototype.updateFillOpacity=Kr,i.View.prototype._multiplyOpacity=!0,i.Style.prototype.set=function(e){var t=e instanceof i.Style,n=t?e._values:e;if(n)for(var o in n)if(o in this._defaults||i.Style.prototype.hasOwnProperty(o)){var r=n[o];this[o]=r&&t&&r.clone?r.clone():r}},i.Item.prototype.applyRescale=function(){var e=this,t=e.rescale;if(t){var n=e.view.scaling.x*e.layer.scaling.x;Object.keys(t).forEach((function(o){"function"==typeof t[o]?e[o]=t[o](n):Array.isArray(t[o])?e[o]=t[o].map((function(e){return e/n})):e[o]=t[o]/n}))}},i.PathItem.prototype.isClockwise=function(){return this.getArea()>=-1e-8},Object.defineProperty(i.PathItem.prototype,"clockwise",{get:function(){return this.isClockwise()}});var Qr={findItemBoundsCollisions:function(e,t,n){function o(e){for(var t=new Array(e.length),n=0;n<e.length;n++){var o=e[n].getBounds();t[n]=[o.left,o.top,o.right,o.bottom]}return t}var r=o(e),i=t&&t!==e?o(t):r;return this.findBoundsCollisions(r,i,n||0)},findCurveBoundsCollisions:function(e,t,n,o){function r(e){for(var t=Math.min,n=Math.max,o=new Array(e.length),r=0;r<e.length;r++){var i=e[r];o[r]=[t(i[0],i[2],i[4],i[6]),t(i[1],i[3],i[5],i[7]),n(i[0],i[2],i[4],i[6]),n(i[1],i[3],i[5],i[7])]}return o}var i=r(e),a=t&&t!==e?r(t):i;if(o){for(var s=this.findBoundsCollisions(i,a,n||0,!1,!0),l=this.findBoundsCollisions(i,a,n||0,!0,!0),c=[],u=0,p=s.length;u<p;u++)c[u]={hor:s[u],ver:l[u]};return c}return this.findBoundsCollisions(i,a,n||0)},findBoundsCollisions:function(e,t,n,o,r){var i=!t||e===t,a=i?e:e.concat(t),s=e.length,l=a.length;function c(e,t,n){for(var o=0,r=e.length;o<r;){var i=r+o>>>1;a[e[i]][t]<n?o=i+1:r=i}return o-1}for(var u=o?1:0,p=u+2,d=o?0:1,f=d+2,h=new Array(l),y=0;y<l;y++)h[y]=y;h.sort((function(e,t){return a[e][u]-a[t][u]}));var v=[],m=new Array(s);for(y=0;y<l;y++){var g=h[y],b=a[g],w=i?g:g-s,A=g<s,C=i||!A,S=A?[]:null;if(v.length){var I=c(v,p,b[u]-n)+1;if(v.splice(0,I),i&&r){S=S.concat(v);for(var k=0;k<v.length;k++)m[P=v[k]].push(w)}else{var O=b[f],E=b[d];for(k=0;k<v.length;k++){var P=v[k],_=a[P],x=P<s,T=i||P>=s;(r||(A&&T||C&&x)&&O>=_[d]-n&&E<=_[f]+n)&&(A&&T&&S.push(i?P:P-s),C&&x&&m[P].push(w))}}}if(A&&(e===t&&S.push(g),m[g]=S),v.length){var j=c(v,p,b[p]);v.splice(j+1,0,g)}else v.push(g)}for(y=0;y<m.length;y++){var B=m[y];B&&B.sort((function(e,t){return e-t}))}return m}},$r=i.PathItem,ei=i.Path,ti=i.CompoundPath,ni=i.Base,oi=i.Item,ri=i.Segment,ii=i.Curve,ai=i.CurveLocation,si=i.Numerical;$r.inject(new function(){var e=Math.min,t=Math.max,n=Math.abs,o={unite:{1:!0,2:!0},intersect:{2:!0},subtract:{1:!0},exclude:{1:!0,"-1":!0}};function r(e){return e._children||[e]}function i(e,t){var n=e.clone(!1).reduce({simplify:!0}).transform(null,!0,!0);if(t){for(var o=r(n),i=0,a=o.length;i<a;i++)(e=o[i])._closed||e.isEmpty()||(e.closePath(si.EPSILON),e.getFirstSegment().setHandleIn(0,0),e.getLastSegment().setHandleOut(0,0));n=n.resolveCrossings().reorient("nonzero"===n.getFillRule(),!0)}return n}function a(e,t,n,o,r){var i=new ti(oi.NO_INSERT);return i.addChildren(e,!0),i=i.reduce({simplify:t}),r&&0==r.insert||i.insertAbove(o&&n.isSibling(o)&&n.getIndex()<o.getIndex()?o:n),i.copyAttributes(n,!0),i}function s(e){return e.hasOverlap()||e.isCrossing()}function l(e,t,n,l){if(l&&(0==l.trace||l.stroke)&&/^(subtract|intersect)$/.test(n))return c(e,t,n);var u=i(e,!0),p=t&&e!==t&&i(t,!0),h=o[n];h[n]=!0,p&&(h.subtract||h.exclude)^p.isClockwise()^u.isClockwise()&&p.reverse();var m,g=f(ai.expand(u.getIntersections(p,s))),b=r(u),w=p&&r(p),A=[],C=[];function S(e){for(var t=0,n=e.length;t<n;t++){var o=e[t];ni.push(A,o._segments),ni.push(C,o.getCurves()),o._overlapsOnly=!0}}function I(e){for(var t=[],n=0,o=e&&e.length;n<o;n++)t.push(C[e[n]]);return t}if(g.length){S(b),w&&S(w);for(var k=g.length-1;k>-1;k--)A[k].curve.length<1e-7&&(A[k].remove(),A.splice(k,1),C.splice(k,1));for(var O=new Array(C.length),E=0,P=C.length;E<P;E++)O[E]=C[E].getValues();var _=Qr.findCurveBoundsCollisions(O,O,0,!0),x={};for(E=0;E<C.length;E++){var T=C[E],j=T._path._id;(x[j]=x[j]||{})[T.getIndex()]={hor:I(_[E].hor),ver:I(_[E].ver)}}for(E=0,P=g.length;E<P;E++)y(g[E]._segment,u,p,x,h);for(E=0,P=A.length;E<P;E++){var B=A[E],L=B._intersection;B._winding||y(B,u,p,x,h),L&&L._overlap||(B._path._overlapsOnly=!1)}m=v(A,h)}else m=d(w?b.concat(w):b.slice(),(function(e){return!!h[e]}));return a(m,!0,e,t,l)}function c(e,t,n){var o=i(e),r=i(t),l=o.getIntersections(r,s),c="subtract"===n,u="divide"===n,p={},d=[];function f(e){if(!p[e._id]&&(u||r.contains(e.getPointAt(e.getLength()/2))^c))return d.unshift(e),p[e._id]=!0}for(var h=l.length-1;h>=0;h--){var y=l[h].split();y&&(f(y)&&y.getFirstSegment().setHandleIn(0,0),o.getLastSegment().setHandleOut(0,0))}return f(o),a(d,!1,e,t)}function u(e,t){for(var n=e;n;){if(n===t)return;n=n._previous}for(;e._next&&e._next!==t;)e=e._next;if(!e._next){for(;t._previous;)t=t._previous;e._next=t,t._previous=e}}function p(e){for(var t=e.length-1;t>=0;t--)e[t].clearHandles()}function d(e,t,o){var r=e&&e.length;if(r){var i=ni.each(e,(function(e,t){this[e._id]={container:null,winding:e.isClockwise()?1:-1,index:t}}),{}),a=e.slice().sort((function(e,t){return n(t.getArea())-n(e.getArea())})),s=a[0],l=Qr.findItemBoundsCollisions(a,null,si.GEOMETRIC_EPSILON);null==o&&(o=s.isClockwise());for(var c=0;c<r;c++){var u=a[c],p=i[u._id],d=0,f=l[c];if(f)for(var h=null,y=f.length-1;y>=0;y--)if(f[y]<c){h=h||u.getInteriorPoint();var v=a[f[y]];if(v.contains(h)){var m=i[v._id];d=m.winding,p.winding+=d,p.container=m.exclude?m.container:v;break}}if(t(p.winding)===t(d))p.exclude=!0,e[p.index]=null;else{var g=p.container;u.setClockwise(g?!g.isClockwise():o)}}}return e}function f(e,t,n){var o,r,i,a=t&&[],s=si.CURVETIME_EPSILON,l=1-s,c=!1,d=n||[],f=n&&{};function h(e){return e._path._id+"."+e._segment1._index}for(var y=(n&&n.length)-1;y>=0;y--)(v=n[y])._path&&(f[h(v)]=!0);for(y=e.length-1;y>=0;y--){var v,m,g=e[y],b=g._time,w=b,A=t&&!t(g);if((v=g._curve)&&(v!==r?(c=!v.hasHandles()||f&&f[h(v)],o=[],i=null,r=v):i>=s&&(b/=i)),A)o&&o.push(g);else{if(t&&a.unshift(g),i=w,b<s)m=v._segment1;else if(b>l)m=v._segment2;else{var C=v.divideAtTime(b,!0);c&&d.push(v,C),m=C._segment1;for(var S=o.length-1;S>=0;S--){var I=o[S];I._time=(I._time-b)/(1-b)}}g._setSegment(m);var k=m._intersection,O=g._intersection;if(k){u(k,O);for(var E=k;E;)u(E._intersection,k),E=E._next}else m._intersection=O}}return n||p(d),a||e}function h(o,r,i,a,s){var l,c,u=Array.isArray(r)?r:r[i?"hor":"ver"],p=i?1:0,d=1^p,f=[o.x,o.y],y=f[p],v=f[d],m=1e-6,g=y-1e-9,b=y+1e-9,w=0,A=0,C=0,S=0,I=!1,k=!1,O=1,E=[];function P(n){var c=n[d+0],u=n[d+6];if(!(v<e(c,u)||v>t(c,u))){var f=n[p+0],w=n[p+2],A=n[p+4],k=n[p+6];if(c!==u){var P=v===c?0:v===u||g>t(f,w,A,k)||b<e(f,w,A,k)?1:ii.solveCubic(n,d,v,E,0,1)>0?E[0]:1,_=0===P?f:1===P?k:ii.getPoint(n,P)[i?"y":"x"],x=c>u?1:-1,T=l[d]>l[d+6]?1:-1,j=l[p+6];return v!==c?(_<g?C+=x:_>b?S+=x:I=!0,_>y-m&&_<y+m&&(O/=2)):(x!==T?f<g?C+=x:f>b&&(S+=x):f!=j&&(j<b&&_>b?(S+=x,I=!0):j>g&&_<g&&(C+=x,I=!0)),O/=4),l=n,!s&&_>g&&_<b&&0===ii.getTangent(n,P)[i?"x":"y"]&&h(o,r,!i,a,!0)}(f<b&&k>g||k<b&&f>g)&&(I=!0)}}function _(n){var o=n[d+0],r=n[d+2],a=n[d+4],s=n[d+6];if(v<=t(o,r,a,s)&&v>=e(o,r,a,s))for(var l,c=n[p+0],u=n[p+2],f=n[p+4],h=n[p+6],y=g>t(c,u,f,h)||b<e(c,u,f,h)?[n]:ii.getMonoCurves(n,i),m=0,w=y.length;m<w;m++)if(l=P(y[m]))return l}for(var x=0,T=u.length;x<T;x++){var j,B=u[x],L=B._path,M=B.getValues();if(!(x&&u[x-1]._path===L||(l=null,L._closed||(c=ii.getValues(L.getLastCurve().getSegment2(),B.getSegment1(),null,!a))[d]!==c[d+6]&&(l=c),l))){l=M;for(var R=L.getLastCurve();R&&R!==B;){var N=R.getValues();if(N[d]!==N[d+6]){l=N;break}R=R.getPrevious()}}if(j=_(M))return j;if(x+1===T||u[x+1]._path!==L){if(c&&(j=_(c)))return j;!I||C||S||(C=S=L.isClockwise(a)^i?1:-1),w+=C,A+=S,C=S=0,I&&(k=!0,I=!1),c=null}}return w=n(w),A=n(A),{winding:t(w,A),windingL:w,windingR:A,quality:O,onPath:k}}function y(e,t,o,r,i){var a=[],s=e,l=0;do{if(g=e.getCurve()){var c=g.getLength();a.push({segment:e,curve:g,length:c}),l+=c}e=e.getNext()}while(e&&!e._intersection&&e!==s);for(var u=[.5,.25,.75],p={winding:0,quality:-1},d=0;d<u.length&&p.quality<.5;d++){c=l*u[d];for(var f=0,y=a.length;f<y;f++){var v=a[f],m=v.length;if(c<=m){var g,b=(g=v.curve)._path,w=b._parent,A=w instanceof ti?w:b,C=si.clamp(g.getTimeAt(c),.001,.999),S=g.getPointAtTime(C),I=n(g.getTangentAtTime(C).y)<Math.SQRT1_2,k=null;if(i.subtract&&o){var O=(A===t?o:t)._getWinding(S,I,!0);if(A===t&&O.winding||A===o&&!O.winding){if(O.quality<1)continue;k={winding:0,quality:1}}}(k=k||h(S,r[b._id][g.getIndex()],I,!0)).quality>p.quality&&(p=k);break}c-=m}}for(f=a.length-1;f>=0;f--)a[f].segment._winding=p}function v(e,t){var n,o=[];function r(e){var n;return!(!e||e._visited||t&&(!t[(n=e._winding||{}).winding]||t.unite&&2===n.winding&&n.windingL&&n.windingR))}function i(e){if(e)for(var t=0,o=n.length;t<o;t++)if(e===n[t])return!0;return!1}function a(e){for(var t=e._segments,n=0,o=t.length;n<o;n++)t[n]._visited=!0}function s(e,t){var o=e._intersection,a=o,s=[];function l(o,a){for(;o&&o!==a;){var l=o._segment,c=l&&l._path;if(c){var u=l.getNext()||c.getFirstSegment(),p=u._intersection;l!==e&&(i(l)||i(u)||u&&r(l)&&(r(u)||p&&r(p._segment)))&&s.push(l),t&&n.push(l)}o=o._next}}if(t&&(n=[e]),o){for(l(o);o&&o._previous;)o=o._previous;l(o,a)}return s}e.sort((function(e,t){var n=e._intersection,o=t._intersection,r=!(!n||!n._overlap),i=!(!o||!o._overlap),a=e._path,s=t._path;return r^i?r?1:-1:!n^!o?n?1:-1:a!==s?a._id-s._id:e._index-t._index}));for(var l=0,c=e.length;l<c;l++){var u,p,d,f=e[l],h=r(f),y=null,v=!1,m=!0,g=[];if(h&&f._path._overlapsOnly){var b=f._path,w=f._intersection._segment._path;b.compare(w)&&(b.getArea()&&o.push(b.clone(!1)),a(b),a(w),h=!1)}for(;h;){var A=!y,C=s(f,A),S=C.shift(),I=!(v=!A&&(i(f)||i(S)))&&S;if(A&&(y=new ei(oi.NO_INSERT),u=null),v){(f.isFirst()||f.isLast())&&(m=f._path._closed),f._visited=!0;break}if(I&&u&&(g.push(u),u=null),u||(I&&C.push(f),u={start:y._segments.length,crossings:C,visited:p=[],handleIn:d}),I&&(f=S),!r(f)){y.removeSegments(u.start);for(var k=0,O=p.length;k<O;k++)p[k]._visited=!1;p.length=0;do{(f=u&&u.crossings.shift())&&f._path||(f=null,(u=g.pop())&&(p=u.visited,d=u.handleIn))}while(u&&!r(f));if(!f)break}var E=f.getNext();y.add(new ri(f._point,d,E&&f._handleOut)),f._visited=!0,p.push(f),f=E||f._path.getFirstSegment(),d=E&&E._handleIn}v&&(m&&(y.getFirstSegment().setHandleIn(d),y.setClosed(m)),0!==y.getArea()&&o.push(y))}return o}return{_getWinding:function(e,t,n){return h(e,this.getCurves(),t,n)},unite:function(e,t){return l(this,e,"unite",t)},intersect:function(e,t){return l(this,e,"intersect",t)},subtract:function(e,t){return l(this,e,"subtract",t)},exclude:function(e,t){return l(this,e,"exclude",t)},divide:function(e,t){return t&&(0==t.trace||t.stroke)?c(this,e,"divide"):a([this.subtract(e,t),this.intersect(e,t)],!0,this,e,t)},resolveCrossings:function(){var e=this._children,t=e||[this];function n(e,t){var n=e&&e._intersection;return n&&n._overlap&&n._path===t}var o=!1,r=!1,i=this.getIntersections(null,(function(e){return e.hasOverlap()&&(o=!0)||e.isCrossing()&&(r=!0)})),a=o&&r&&[];if(i=ai.expand(i),o)for(var s=f(i,(function(e){return e.hasOverlap()}),a),l=s.length-1;l>=0;l--){var c=s[l],u=c._path,d=c._segment,h=d.getPrevious(),y=d.getNext();n(h,u)&&n(y,u)&&(d.remove(),h._handleOut._set(0,0),y._handleIn._set(0,0),h===d||h.getCurve().hasLength()||(y._handleIn.set(h._handleIn),h.remove()))}r&&(f(i,o&&function(e){var t=e.getCurve(),n=e.getSegment(),o=e._intersection,r=o._curve,i=o._segment;if(t&&r&&t._path&&r._path)return!0;n&&(n._intersection=null),i&&(i._intersection=null)},a),a&&p(a),t=v(ni.each(t,(function(e){ni.push(this,e._segments)}),[])));var m,g=t.length;return g>1&&e?(t!==e&&this.setChildren(t),m=this):1!==g||e||(t[0]!==this&&this.setSegments(t[0].removeSegments()),m=this),m||((m=new ti(oi.NO_INSERT)).addChildren(t),(m=m.reduce()).copyAttributes(this),this.replaceWith(m)),m},reorient:function(e,t){var n=this._children;return n&&n.length?this.setChildren(d(this.removeChildren(),(function(t){return!!(e?t:1&t)}),t)):void 0!==t&&this.setClockwise(t),this},getInteriorPoint:function(){var n=this.getBounds().getCenter(!0);if(!this.contains(n)){for(var o=this.getCurves(),r=n.y,i=[],a=[],s=0,l=o.length;s<l;s++){var c=o[s].getValues(),u=c[1],p=c[3],d=c[5],f=c[7];if(r>=e(u,p,d,f)&&r<=t(u,p,d,f))for(var h=ii.getMonoCurves(c),y=0,v=h.length;y<v;y++){var m=h[y],g=m[1],b=m[7];if(g!==b&&(r>=g&&r<=b||r>=b&&r<=g)){var w=r===g?m[0]:r===b?m[6]:1===ii.solveCubic(m,1,r,a,0,1)?ii.getPoint(m,a[0]).x:(m[0]+m[6])/2;i.push(w)}}}i.length>1&&(i.sort((function(e,t){return e-t})),n.x=(i[0]+i[1])/2)}return n}}});for(var li=function(){var e=ui[ci],t=i.PathItem.prototype[e];i.PathItem.prototype[e]=function(){var e=arguments[0],n=this.getBounds(),o=e.getBounds(),r=Math.min(n.x,o.x),a=Math.max(n.x+n.width,o.x+o.width),s=Math.min(n.y,o.y),l=Math.max(n.y+n.height,o.y+o.height);if(r>-1e3&&a<1e3&&s>-1e3&&l<1e3)return t.apply(this,arguments);var c=a-r,u=l-s,p=Math.pow(2,Math.ceil(Math.log2(c/2e3))),d=Math.pow(2,Math.ceil(Math.log2(u/2e3))),f=Math.max(p,d),h=new i.Point((r+a)/2,(s+l)/2),y=new i.Point(-Math.round(h.x),-Math.round(h.y));f>1&&(this.scale(1/f,h),e!==this&&e.scale(1/f,h)),this.translate(y),e!==this&&e.translate(y);var v=t.apply(this,arguments);return this.translate(y.multiply(-1)),v.translate(y.multiply(-1)),e!==this&&e.translate(y.multiply(-1)),f>1&&(this.scale(f,h),v.scale(f,h),e!==this&&e.scale(f,h)),v}},ci=0,ui=["unite","intersect","subtract","exclude","divide"];ci<ui.length;ci++)li();function pi(e,t){return pi=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},pi(e,t)}function di(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(di=function(){return!!e})()}function fi(){return{get:function(){var e=this._paperLayerMap.size;return 1===e?this._paperLayerMap.values().next().value:0===e?null:this._paperLayerMap.get(i)||null}}}function hi(){return{get:function(){return this.__paperLayerMap||(this.__paperLayerMap=new Map),this.__paperLayerMap}}}function yi(e){return t=e.paperScope,n=new i.Layer({applyMatrix:!1}),t.project.addLayer(n),this._paperLayerMap.set(t,n),n;var t,n}function vi(e){this.paperLayer?(this.paperLayer.addChild(e),e.applyRescale()):console.error("No layer has been set up in the active paper scope for this object. Does a scope need to be activated?")}function mi(e){return mi="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},mi(e)}function gi(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,bi(o.key),o)}}function bi(e){var t=function(e){if("object"!=mi(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=mi(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==mi(t)?t:t+""}function wi(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(wi=function(){return!!e})()}function Ai(e){return Ai=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},Ai(e)}function Ci(e,t){return Ci=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},Ci(e,t)}i.Curve.getTimeOf=function(e,t){var n=new i.Point(e[0],e[1]),o=new i.Point(e[6],e[7]),r=1e-7,a=t.isClose(n,r)?0:t.isClose(o,r)?1:null;if(null===a)for(var s=[t.x,t.y],l=[],c=0;c<2;c++)for(var u=i.Curve.solveCubic(e,c,s[c],l,0,1),p=0;p<u;p++){var d=l[p];if(t.isClose(i.Curve.getPoint(e,d),r))return d}return a},Object.defineProperty(r.Viewer.prototype,"paperLayer",fi()),Object.defineProperty(r.TiledImage.prototype,"paperLayer",fi()),Object.defineProperty(r.Viewport.prototype,"paperLayer",fi()),Object.defineProperty(r.TiledImage.prototype,"_paperLayerMap",hi()),Object.defineProperty(r.Viewer.prototype,"_paperLayerMap",hi()),Object.defineProperty(r.Viewport.prototype,"_paperLayerMap",hi()),Object.defineProperty(r.Viewer.prototype,"paperItems",{get:function(){return this.paperLayer.children}}),Object.defineProperty(r.TiledImage.prototype,"paperItems",{get:function(){return this.paperLayer.children}}),Object.defineProperty(r.Viewport.prototype,"paperItems",{get:function(){return this.paperLayer.children}}),r.Viewer.prototype._setupPaper=yi,r.Viewport.prototype._setupPaper=function(e){var t=yi.call(this,e);t.viewport=this,t.matrix.scale(e.scaleFactor),e.addHandler("update-scale",(function(){t.matrix.reset(),t.matrix.scale(e.scaleFactor)}))},r.TiledImage.prototype._setupPaper=function(e){var t=this,n=yi.call(this,e);function o(){var o=t.getRotation(),r=t.getBoundsNoRotate(),a=new i.Matrix;a.rotate(o,(r.x+r.width/2)*e.scaleFactor,(r.y+r.height/2)*e.scaleFactor),a.translate({x:r.x*e.scaleFactor,y:r.y*e.scaleFactor}),a.scale(r.width*e.scaleFactor/t.source.width),n.matrix.set(a)}n.tiledImage=this,this.addHandler("bounds-change",o),e.addHandler("update-scale",o),o()},r.Viewer.prototype.addPaperItem=vi,r.Viewport.prototype.addPaperItem=vi,r.TiledImage.prototype.addPaperItem=vi,r.Viewer.prototype.createPaperOverlay=function(){var e=function(e,t,n){if(di())return Reflect.construct.apply(null,arguments);var o=[null];o.push.apply(o,t);var r=new(e.bind.apply(e,o));return n&&pi(r,n.prototype),r}(Ii,[this].concat(Array.prototype.slice.call(arguments)));return e},function(e){void 0!==e&&void 0!==i?e.Viewer.prototype.PaperOverlays?console.warn("Cannot redefine Viewer.prototype.PaperOverlays"):Object.defineProperty(e.Viewer.prototype,"PaperOverlays",{get:function(){return this._PaperOverlays||(this._PaperOverlays=[])}}):console.error("[paper-overlay.mjs] requires OpenSeadragon and paper.js")}(r);var Si,Ii=function(){function e(t,n){var o;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),o=function(e,t,n){return t=Ai(t),function(e,t){if(t&&("object"==mi(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,wi()?Reflect.construct(t,n||[],Ai(e).constructor):t.apply(e,n))}(this,e),n=r.extend(!0,{overlayType:"image"},n),o.viewer=t,o.overlayType=n.overlayType,t.PaperOverlays.push(o);var a=ki();o._id="paper-overlay-canvas-"+a,o._containerWidth=0,o._containerHeight=0,o._canvasdiv=document.createElement("div"),o._canvasdiv.setAttribute("id","paper-overlay-"+a),o._canvasdiv.classList.add("paper-overlay"),o._canvasdiv.style.position="absolute",o._canvasdiv.style.left="0px",o._canvasdiv.style.top="0px",o._canvasdiv.style.width="100%",o._canvasdiv.style.height="100%",o._canvas=document.createElement("canvas"),o._canvas.setAttribute("id",o._id),o._canvasdiv.appendChild(o._canvas),t.canvas.appendChild(o._canvasdiv),o._viewerButtons=[],o.paperScope=new i.PaperScope,o.paperScope.overlay=o;var s=o.paperScope.setup(o._canvas);if(o.paperScope.project.overlay=o,o.ps=s,o._paperProject=s.project,o._resize(),"image"==o.overlayType){o.viewer.viewport._setupPaper(o);for(var l=0;l<t.world.getItemCount();++l){var c=o.viewer.world.getItemAt(l);o._setupTiledImage(c)}o.onAddItem=function(e){return function(t){var n=t.item;e._setupTiledImage(n)}}(o),o.onRemoveItem=function(e){return function(t){var n=t.item;e._removeTiledImage(n)}}(o),t.world.addHandler("add-item",o.onAddItem),t.world.addHandler("remove-item",o.onRemoveItem),o._updatePaperView()}else"viewer"==o.overlayType?o.viewer._setupPaper(o):console.error("Unrecognized overlay type: "+o.overlayType);return o.onViewerDestroy=function(e){return function(){e.destroy(!0)}}(o),o.onViewportChange=function(e){return function(){e._updatePaperView()}}(o),o.onViewerResetSize=function(e){return function(t){setTimeout((function(){e.destroyed||(e._resize(),e._updatePaperView())}))}}(o),o.onViewerResize=function(e){return function(){e._resize(),e.paperScope.view.emit("resize",{size:new i.Size(e._containerWidth,e._containerHeight)}),e._updatePaperView()}}(o),o.onViewerRotate=function(e){this._pivot=e.pivot||this._getCenter()},o.onViewerFlip=function(e){return function(n){e.paperScope.view.setFlipped(n.flipped,t.viewport.getRotation(!0))}}(o),t.addHandler("resize",o.onViewerResize),t.addHandler("reset-size",o.onViewerResetSize),t.addHandler("viewport-change",o.onViewportChange),t.addHandler("rotate",o.onViewerRotate),t.addHandler("flip",o.onViewerFlip),t.addOnceHandler("destroy",o.onViewerDestroy),o}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Ci(e,t)}(e,r.EventSource),t=e,n=[{key:"scaleFactor",get:function(){return this._currentScaleFactor=this._currentScaleFactor||this.viewer.drawer.canvas.clientWidth,this._currentScaleFactor}},{key:"addViewerButton",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=this.viewer.prefixUrl,n=new r.Button({tooltip:e.tooltip,srcRest:t+"button_rest.png",srcGroup:t+"button_grouphover.png",srcHover:t+"button_hover.png",srcDown:t+"button_pressed.png",onClick:e.onClick});if(e.faIconClass){var o=Q(e.faIconClass);o.style="position:absolute;top:calc(50% - 4px);left:50%;transform:translate(-50%, -50%);color:#01010187;",n.element.appendChild(o)}return this.viewer.buttonGroup.buttons.push(n),this.viewer.buttonGroup.element.appendChild(n.element),this._viewerButtons.push(n),n}},{key:"bringToFront",value:function(){var e=this;this.viewer.PaperOverlays.splice(this.viewer.PaperOverlays.indexOf(this),1),this.viewer.PaperOverlays.push(this),this.viewer.PaperOverlays.forEach((function(t){return e.viewer.canvas.appendChild(t._canvasdiv)})),this.paperScope.activate()}},{key:"sendToBack",value:function(){var e=this;this.viewer.PaperOverlays.splice(this.viewer.PaperOverlays.indexOf(this),1),this.viewer.PaperOverlays.splice(0,0,this),this.viewer.PaperOverlays.forEach((function(t){return e.viewer.canvas.appendChild(t._canvasdiv)})),this.viewer.PaperOverlays[this.viewer.PaperOverlays.length-1].paperScope.activate()}},{key:"destroy",value:function(e){this.destroyed=!0,this._canvasdiv.remove(),this.paperScope.project&&this.paperScope.project.remove(),this.ps&&this.ps.remove(),e||(this.viewer.removeHandler("viewport-change",this.onViewportChange),this.viewer.removeHandler("resize",this.onViewerResize),this.viewer.removeHandler("reset-size",this.onViewerResetSize),this.viewer.removeHandler("rotate",this.onViewerRotate),this.viewer.removeHandler("flip",this.onViewerFlip),this.viewer.world.removeHandler("add-item",this.onAddItem),this.viewer.world.removeHandler("remove-item",this.onRemoveItem),this.setOSDMouseNavEnabled(!0),this._viewerButtons.forEach((function(e){e.element.remove()})),this._viewerButtons=[],this.viewer.PaperOverlays.splice(this.viewer.PaperOverlays.indexOf(this),1),this.viewer.PaperOverlays.length>0&&this.viewer.PaperOverlays[this.viewer.PaperOverlays.length-1].paperScope.activate())}},{key:"clear",value:function(){this.paperScope.project.clear()}},{key:"canvas",value:function(){return this._canvas}},{key:"addClass",value:function(e){var t;return(t=this._canvas.classList).add.apply(t,arguments),this}},{key:"removeClass",value:function(e){var t;return(t=this._canvas.classList).remove.apply(t,arguments),this}},{key:"setAttribute",value:function(e,t){return this._canvas.setAttribute(e,t),this}},{key:"addEventListener",value:function(e,t){return this._canvas.addEventListener(e,t),this}},{key:"removeEventListener",value:function(e,t){return this._canvas.removeEventListener(e,t),this}},{key:"setOSDMouseNavEnabled",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=this.viewer.isMouseNavEnabled();return this.viewer.setMouseNavEnabled(e),e!==t&&this.viewer.raiseEvent("mouse-nav-changed",{enabled:e,overlay:this}),t}},{key:"autoRescaleItems",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=this;function n(){t.rescaleItems()}this.ps.view.off("zoom-changed",n),e&&this.ps.view.on("zoom-changed",n)}},{key:"rescaleItems",value:function(){this._paperProject.getItems({match:function(e){return e.rescale}}).forEach((function(e){e.applyRescale()}))}},{key:"paperToCanvasCoordinates",value:function(e,t){var n=new r.Point(e,t).divide(this.scaleFactor);return this.viewer.viewport.viewportToViewerElementCoordinates(n)}},{key:"getImageData",value:function(e,t,n,o){return e=e||0,t=t||0,n=null==n?this.viewer.drawer.canvas.width:n,o=null==o?this.viewer.drawer.canvas.height:o,this.ps.view.getFlipped()&&(e=this.viewer.drawer.canvas.width-e-n),this.viewer.drawer.canvas.getContext("2d",{willReadFrequently:!0}).getImageData(e,t,n,o)}},{key:"getViewportRaster",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=this.paperScope.view,n=t.viewToProject(new i.Point(t.viewSize.width/2,t.viewSize.height/2)),o=-1*this.viewer.viewport.getRotation(),r={insert:!1};e?r.canvas=this.viewer.drawer.canvas:r.size=new i.Size(this.viewer.drawer.canvas.width,this.viewer.drawer.canvas.height);var a=new i.Raster(r);a.position=n,a.rotate(o);var s=t.viewSize.width/t.getZoom()/this.viewer.drawer.canvas.width;if(a.scale(s),t.getFlipped()){var l=t.getRotation();a.rotate(-l),a.scale(-1,1),a.rotate(l)}return a}},{key:"_setupTiledImage",value:function(e){e._setupPaper(this)}},{key:"_removeTiledImage",value:function(e){var t,n;null===(t=e._paperLayerMap)||void 0===t||null===(t=t.get(this.paperScope))||void 0===t||t.remove(),null===(n=e._paperLayerMap)||void 0===n||n.delete(this.paperScope)}},{key:"_resize",value:function(){var e=!1;if(this._containerWidth!==this.viewer.container.clientWidth&&(this._containerWidth=this.viewer.container.clientWidth,this._canvasdiv.setAttribute("width",this._containerWidth),this._canvas.setAttribute("width",this._containerWidth),e=!0),this._containerHeight!==this.viewer.container.clientHeight&&(this._containerHeight=this.viewer.container.clientHeight,this._canvasdiv.setAttribute("height",this._containerHeight),this._canvas.setAttribute("height",this._containerHeight),e=!0),e){var t=this._currentScaleFactor;this._currentScaleFactor=this.viewer.drawer.canvas.clientWidth,t!==this._currentScaleFactor&&this.raiseEvent("update-scale",{scaleFactor:this._currentScaleFactor}),this.paperScope.view.viewSize=new i.Size(this._containerWidth,this._containerHeight),this.paperScope.view.update()}}},{key:"_updatePaperView",value:function(){if("viewer"!==this.overlayType){var e=this.viewer.viewport.getZoom(!0),t=this.paperScope.view.getZoom();this.paperScope.view.setZoom(this.viewer.viewport._containerInnerSize.x*e/this.scaleFactor);var n=this._getCenter();this.viewer.drawer.canvas.pixelRatio=window.devicePixelRatio,this.paperScope.view.center=new i.Point(n.x,n.y).multiply(this.scaleFactor);var o=this.viewer.viewport.getRotation(!0),r=this._getPivot();this.paperScope.view.setRotation(o,r);var a=this.paperScope.view.getZoom();Math.abs(a-t)>1e-7&&this.paperScope.view.emit("zoom-changed",{zoom:a}),this.paperScope.view.update()}}},{key:"_getPivot",value:function(){if(this._pivot)return this._pivot.multiply(this.scaleFactor)}},{key:"_getCenter",value:function(){return this.viewer.viewport.getCenter(!0)}}],n&&gi(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,n}(),ki=(Si=1,function(){return Si++});function Oi(e){return Oi="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Oi(e)}function Ei(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,Pi(o.key),o)}}function Pi(e){var t=function(e){if("object"!=Oi(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=Oi(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==Oi(t)?t:t+""}function _i(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(_i=function(){return!!e})()}function xi(e){return xi=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},xi(e)}function Ti(e,t){return Ti=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},Ti(e,t)}var ji=function(){function e(t){var n,o;(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,e),(n=function(e,t,n){return t=xi(t),function(e,t){if(t&&("object"==Oi(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,_i()?Reflect.construct(t,n||[],xi(e).constructor):t.apply(e,n))}(this,e,[t]))._supportsGeoJSONObj(t)||error("Bad geoJSON object: geometry type ".concat(null===(o=t.geometry)||void 0===o?void 0:o.type," is not supported by this factory."));var r=("multipolygon"===t.geometry.type.toLowerCase()?t.geometry.coordinates.flat():t.geometry.coordinates).map((function(e){var t=e.map((function(e){return new i.Point(e[0],e[1])}));return new i.Path(t)})),a=new i.CompoundPath({children:r,fillRule:"evenodd",closed:!0});return(a=a.replaceWith(a.unite(a).toCompoundPath())).canBeBoundingElement=!0,n.paperItem=a,n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Ti(e,t)}(e,jt),t=e,o=[{key:"supportsGeoJSONType",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return["polygon","multipolygon"].includes(e.toLowerCase())&&null===t}}],(n=[{key:"getGeoJSONType",value:function(){return{type:this.paperItem.children.filter((function(e){return e.area>0&&e.segments.length>2})).length>1?"MultiPolygon":"Polygon"}}},{key:"getCoordinates",value:function(){var e=this.paperItem.children.filter((function(e){return e.area>0&&e.segments.length>2})),t=this.paperItem.children.filter((function(e){return e.area<=0&&e.segments.length>2})),n=e.map((function(e){return[e.segments.map((function(e){return[e.point.x,e.point.y]}))].concat(t.filter((function(t){return e.contains(t.segments[0].point)})).map((function(e){return e.segments.map((function(e){return[e.point.x,e.point.y]}))})))}));return n.forEach((function(e){e.forEach((function(e){var t=e[0],n=e.slice(-1)[0];t[0]===n[0]&&t[1]===n[1]||e.push([t[0],t[1]])}))})),1===n.length&&(n=n[0]),n}},{key:"getProperties",value:function(){}}])&&Ei(t.prototype,n),o&&Ei(t,o),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,n,o}();function Bi(e){return Bi="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Bi(e)}function Li(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,Mi(o.key),o)}}function Mi(e){var t=function(e){if("object"!=Bi(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=Bi(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==Bi(t)?t:t+""}function Ri(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(Ri=function(){return!!e})()}function Ni(e){return Ni=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},Ni(e)}function Fi(e,t){return Fi=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},Fi(e,t)}var Di=function(){function e(t){var n;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),n=function(e,t,n){return t=Ni(t),function(e,t){if(t&&("object"==Bi(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,Ri()?Reflect.construct(t,n||[],Ni(e).constructor):t.apply(e,n))}(this,e,[t]),"LineString"!==t.geometry.type&&error('Bad geoJSON object: type !=="LineString"');var o=t.geometry.coordinates.map((function(e){return new i.Point(e[0],e[1])})),r=new i.Group({children:[new i.Path(o)]});return r.fillColor=null,n.paperItem=r,n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Fi(e,t)}(e,jt),t=e,o=[{key:"supportsGeoJSONType",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return"linestring"===e.toLowerCase()&&null===t}}],(n=[{key:"getGeoJSONType",value:function(){return{type:"Linestring"}}},{key:"getCoordinates",value:function(){return this.paperItem.children.map((function(e){return e.segments.map((function(e){return[e.point.x,e.point.y]}))}))}},{key:"getProperties",value:function(){return{strokeWidths:this.paperItem.children.map((function(e){return e.strokeWidth}))}}},{key:"setStyle",value:function(e){Object.assign({},e),e.rescale&&delete e.rescale.strokeWidth,this._paperItem.style.set(e)}}])&&Li(t.prototype,n),o&&Li(t,o),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,n,o}();function Gi(e){return Gi="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Gi(e)}function zi(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,Hi(o.key),o)}}function Hi(e){var t=function(e){if("object"!=Gi(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=Gi(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==Gi(t)?t:t+""}function Ui(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(Ui=function(){return!!e})()}function Wi(e){return Wi=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},Wi(e)}function Vi(e,t){return Vi=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},Vi(e,t)}var Yi=function(){function e(t){var n;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),n=function(e,t,n){return t=Wi(t),function(e,t){if(t&&("object"==Gi(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,Ui()?Reflect.construct(t,n||[],Wi(e).constructor):t.apply(e,n))}(this,e,[t]),"MultiLineString"!==t.geometry.type&&error('Bad geoJSON object: type !=="MultiLineString"');var o=t.geometry.coordinates.map((function(e,n){var o=e.map((function(e){return new i.Point(e[0],e[1])}));return new i.Path(o).strokeWidth=t.geometry.properties.strokeWidths[n],new i.Path(o)})),r=new i.Group({children:o});return r.fillColor=null,n.paperItem=r,n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Vi(e,t)}(e,jt),t=e,o=[{key:"supportsGeoJSONType",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return"multilinestring"===e.toLowerCase()&&null===t}}],(n=[{key:"getGeoJSONType",value:function(){return{type:"MultiLineString"}}},{key:"getCoordinates",value:function(){return this.paperItem.children.map((function(e){return e.segments.map((function(e){return[e.point.x,e.point.y]}))}))}},{key:"getProperties",value:function(){var e=this.paperItem;return{strokeColor:e.children.length>0?e.children[0].strokeColor:void 0,strokeWidths:e.children.map((function(e){return e.strokeWidth}))}}},{key:"getStyleProperties",value:function(){return this.paperItem.children[0].style.toJSON()}},{key:"setStyle",value:function(e){Object.assign({},e),e.rescale&&delete e.rescale.strokeWidth,this._paperItem.style.set(e)}}])&&zi(t.prototype,n),o&&zi(t,o),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,n,o}();function qi(e){return qi="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},qi(e)}function Ji(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,Zi(o.key),o)}}function Zi(e){var t=function(e){if("object"!=qi(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=qi(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==qi(t)?t:t+""}function Xi(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(Xi=function(){return!!e})()}function Ki(e){return Ki=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},Ki(e)}function Qi(e,t){return Qi=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},Qi(e,t)}var $i=function(){function e(t){var n;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),n=function(e,t,n){return t=Ki(t),function(e,t){if(t&&("object"==qi(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,Xi()?Reflect.construct(t,n||[],Ki(e).constructor):t.apply(e,n))}(this,e,[t]),"GeometryCollection"===t.geometry.type&&"Raster"===t.geometry.properties.subtype||error('Bad geoJSON object: type !=="GeometryCollection" or subtype !=="Raster"');var o,r=t.geometry.properties.raster,a=t.geometry.geometries;r||error("Bad input: geometry.properties.raster must hold raster data, or a paper.Raster object"),r.data instanceof i.Raster?o=r.data:((o=new i.Raster(r.data)).translate(r.center[0],r.center[1]),o.scale(r.scaling[0],r.scaling[1]),o.rotate(r.rotation)),n._rasterSelectedColor=new i.Color(0,0,0,0),o.selectedColor=n._rasterSelectedColor;var s=new i.Group([o]);if(s.updateFillOpacity=function(){i.Group.prototype.updateFillOpacity.call(this),o.opacity=this.opacity*this._computedFillOpacity,s.clipped&&(s.children[0].fillColor=null)},a.length>0){var l=new i.Group;s.insertChild(0,l),s.clipped=!0,a.forEach((function(e){var t=e instanceof i.Item?i.Item.fromAnnotationItem(e):i.Item.fromGeoJSON(e);delete t.isGeoJSONFeature,t._annotationItem=t.annotationItem,delete t.annotationItem,setTimeout((function(){return t.strokeColor=(e.properties||e).strokeColor})),t.strokeWidth=(e.properties||e).strokeWidth,t.rescale=(e.properties||e).rescale,l.addChild(t)}))}return t.geometry.properties.transform&&(s.matrix=new i.Matrix(t.geometry.properties.transform)),s.on("selected",(function(){s.clipped&&(s.children[0].selected=!1)})),n.paperItem=s,n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Qi(e,t)}(e,jt),t=e,o=[{key:"supportsGeoJSONType",value:function(e,t){return"geometrycollection"===e.toLowerCase()&&"raster"===(null==t?void 0:t.toLowerCase())}}],(n=[{key:"getGeoJSONType",value:function(){return{type:"GeometryCollection",subtype:"Raster"}}},{key:"toGeoJSONGeometry",value:function(){var e=this.paperItem,t=e.children[0],n=e.children[1],o={type:"GeometryCollection",properties:{subtype:"Raster",raster:{data:n.toDataURL(),center:[n.bounds.center.x,n.bounds.center.y],width:n.width,height:n.height,scaling:[n.matrix.scaling.x,n.matrix.scaling.y],rotation:n.matrix.rotation},transform:e.matrix.values},geometries:t.children.map((function(e){var t=e._annotationItem.toGeoJSONFeature(),n=t.geometry;return n.properties||(n.properties={}),n.properties.strokeColor=t.properties.strokeColor,n.properties.strokeWidth=t.properties.strokeWidth,n.properties.rescale=t.properties.rescale,n}))};return o}}])&&Ji(t.prototype,n),o&&Ji(t,o),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,n,o}();function ea(e){return ea="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ea(e)}function ta(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,na(o.key),o)}}function na(e){var t=function(e){if("object"!=ea(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=ea(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==ea(t)?t:t+""}function oa(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(oa=function(){return!!e})()}function ra(e){return ra=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},ra(e)}function ia(e,t){return ia=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},ia(e,t)}var aa=function(){function e(t){var n;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),n=function(e,t,n){return t=ra(t),function(e,t){if(t&&("object"==ea(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,oa()?Reflect.construct(t,n||[],ra(e).constructor):t.apply(e,n))}(this,e,[t]),"Point"===t.geometry.type&&"Rectangle"===t.geometry.properties.subtype||error('Bad geoJSON object: type !=="Point" or subtype !=="Rectangle"');var o=new i.CompoundPath({children:[],fillRule:"evenodd"});if(t.geometry.coordinates.length>1){var r=t.geometry.coordinates.slice(0,2),a=r[0]||0,s=r[1]||0,l=t.geometry.properties,c=l.width||0,u=l.height||0,p=l.angle||0,d=[[a-c/2,s-u/2],[a+c/2,s-u/2],[a+c/2,s+u/2],[a-c/2,s+u/2]].map((function(e){return new i.Point(e[0],e[1])})),f=new i.Path(d);o.addChild(f),o.closed=!0,o.rotate(p)}return o.canBeBoundingElement=!0,n.paperItem=o,n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&ia(e,t)}(e,jt),t=e,o=[{key:"supportsGeoJSONType",value:function(e,t){return"point"===e.toLowerCase()&&"rectangle"===(null==t?void 0:t.toLowerCase())}},{key:"onTransform",value:function(){var e=this;if("scale"===arguments[0]){var t=this.layer.matrix.inverseTransform(arguments[1]),n=arguments[2],o=arguments[3];this.matrix.append(o.inverted());var r=this.children[0].segments;r.map((function(t,n){var o=t.point.transform(e.matrix),i=r[(n+1)%4],a=i.point.transform(e.matrix).subtract(o).divide(2),s=o.add(a);return s.normal=a.rotate(-90).normalize(),s.segments=[t,i],s})).forEach((function(r){var i=r.subtract(t),a=i.rotate(-n).multiply(o.scaling).rotate(n).subtract(i).project(r.normal);r.segments.forEach((function(t){var n=t.point.transform(e.matrix).add(a);t.point=e.matrix.inverseTransform(n)}))}))}}}],(n=[{key:"getGeoJSONType",value:function(){return{type:"Point",subtype:"Rectangle"}}},{key:"getCoordinates",value:function(){var e=this.paperItem;return[e.position.x,e.position.y]}},{key:"getProperties",value:function(){var e=this.paperItem.children[0].segments.map((function(e){return e.point})),t=e[1].subtract(e[0]),n=e[0].subtract(e[3]);return{width:t.length,height:n.length,angle:t.angleInDegrees}}}])&&ta(t.prototype,n),o&&ta(t,o),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,n,o}();function sa(e){return sa="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},sa(e)}function la(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,ca(o.key),o)}}function ca(e){var t=function(e){if("object"!=sa(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=sa(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==sa(t)?t:t+""}function ua(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(ua=function(){return!!e})()}function pa(e){return pa=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},pa(e)}function da(e,t){return da=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},da(e,t)}var fa,ha=function(){function e(t){var n;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),n=function(e,t,n){return t=pa(t),function(e,t){if(t&&("object"==sa(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,ua()?Reflect.construct(t,n||[],pa(e).constructor):t.apply(e,n))}(this,e,[t]),"Point"===t.geometry.type&&"Ellipse"===t.geometry.properties.subtype||error('Bad geoJSON object: type !=="Point" or subtype !=="Rectangle"');var o=new i.CompoundPath({children:[],fillRule:"evenodd"});if(t.geometry.coordinates.length>1){var r=t.geometry.coordinates.slice(0,2),a=r[0]||0,s=r[1]||0,l=t.geometry.properties,c=l.majorRadius||0,u=l.minorRadius||0,p=l.angle||0,d=new i.Path.Ellipse({center:new i.Point(a,s),radius:new i.Size(c,u)});o.addChild(d),o.rotate(p)}return o.canBeBoundingElement=!0,n.paperItem=o,n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&da(e,t)}(e,jt),t=e,o=[{key:"supportsGeoJSONType",value:function(e,t){return"point"===e.toLowerCase()&&"ellipse"===(null==t?void 0:t.toLowerCase())}},{key:"onTransform",value:function(){if("complete"===arguments[0]){var e=this.children[0].curves,t=this.bounds.center,n=e.slice(0,2).map((function(e){return{curve:e,location:e.getNearestLocation(t)}})).sort((function(e,t){return e.location.distance-t.location.distance})),o=n[0].location.point;if(o.equals(n[0].curve.segment1.point)||o.equals(n[0].curve.segment2.point))return;var r=n[0].location.curve==n[0].curve?n[0].location.time:1,a=o.subtract(t),s=n[1].curve.getLocationAtTime(r).point.subtract(t),l=new i.Path.Ellipse({center:t,radius:[s.length,a.length]}).rotate(s.angle);this.children[0].set({segments:l.segments})}}}],(n=[{key:"getGeoJSONType",value:function(){return{type:"Point",subtype:"Ellipse"}}},{key:"getCoordinates",value:function(){var e=this.paperItem;return[e.position.x,e.position.y]}},{key:"getProperties",value:function(){var e,t,n=this.paperItem.children[0].segments.map((function(e){return e.point})),o=n[2].subtract(n[0]),r=n[3].subtract(n[1]);o.length>r.length?(e=o,t=r):(e=r,t=o);var i=e.angle;return{majorRadius:e.length/2,minorRadius:t.length/2,angle:i}}}])&&la(t.prototype,n),o&&la(t,o),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,n,o}(),ya=function(e){for(var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,o=3735928559^n,r=1103547991^n,i=0;i<e.length;i++)t=e.charCodeAt(i),o=Math.imul(o^t,2654435761),r=Math.imul(r^t,1597334677);return o=Math.imul(o^o>>>16,2246822507),o^=Math.imul(r^r>>>13,3266489909),r=Math.imul(r^r>>>16,2246822507),4294967296*(2097151&(r^=Math.imul(o^o>>>13,3266489909)))+(o>>>0)};function va(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,o=Array(t);n<t;n++)o[n]=e[n];return o}function ma(e){return ma="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ma(e)}function ga(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,ba(o.key),o)}}function ba(e){var t=function(e){if("object"!=ma(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=ma(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==ma(t)?t:t+""}function wa(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(wa=function(){return!!e})()}function Aa(e){return Aa=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},Aa(e)}function Ca(e,t){return Ca=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},Ca(e,t)}Object.defineProperty(i.Item.prototype,"displayName",{set:function(e){Array.isArray(e)?(this._displayName=new String(e[0]),this._displayName.source=e[1]):this._displayName=e,this.name=this._displayName,this.emit("display-name-changed",{displayName:this._displayName})},get:function(){return this._displayName}}),Object.defineProperty(i.Item.prototype,"featureCollection",{get:function(){return this.hierarchy.filter((function(e){return e.isGeoJSONFeatureCollection}))[0]}}),Object.defineProperty(i.TextItem.prototype,"content",(fa=i.TextItem.prototype._setContent||Object.getOwnPropertyDescriptor(i.TextItem.prototype,"content").set,i.TextItem.prototype._setContent=fa,{get:function(){return this._content},set:function(e){fa.call(this,e),this.emit("content-changed")}})),Object.defineProperty(i.Project.prototype,"descendants",{get:function(){return this.layers?this.getItems({match:function(e){return e.isGeoJSONFeatureCollection}}).map((function(e){return e.descendants})).flat():[this]}});var Sa=i.Item.prototype.remove;i.Item.prototype.remove=function(){var e=this,t=this.getItems({match:function(e){return e.isGeoJSONFeatureCollection}});(this.isGeoJSONFeature||this.isGeoJSONFeatureCollection)&&this.project.emit("item-removed",{item:this}),t.forEach((function(t){return e.project.emit("item-removed",{item:t})})),Sa.call(this),(this.isGeoJSONFeature||this.isGeoJSONFeatureCollection)&&this.emit("removed",{item:this}),t.forEach((function(e){return e.emit("removed",{item:e})}))},i.Group.prototype.insertChildren=function(){var e=i.Group.prototype.insertChildren.original||i.Group.prototype.insertChildren;function t(){var t=this,n=e.apply(this,arguments),o=arguments[0],r=Array.from(arguments[1]);return r&&r.forEach((function(e,n){if(e.isGeoJSONFeature){var r=void 0!==o?o+1:-1;t.emit("child-added",{item:e,index:r})}})),n}return t.original=e,t}(),i.Color.prototype.toJSON=i.Color.prototype.toCSS,i.Style.prototype.toJSON=function(){var e=this,t={};return Object.keys(this._values).forEach((function(n){t[n]=e[n]})),t},i.View.prototype.getImageData=function(){return this.element.getContext("2d").getImageData(0,0,this.element.width,this.element.height)},i.PathItem.prototype.toCompoundPath=function(){if(this.constructor!==i.CompoundPath){var e=new i.CompoundPath({children:[this],fillRule:"evenodd"});return e.selected=this.selected,this.selected=!1,e}return this},i.PathItem.prototype.applyBounds=function(e){if(0!=e.length){var t;if(1==e.length)t=e[0].intersect(this,{insert:!1});else if(e.length>1){var n=new i.CompoundPath(e.map((function(e){return e.clone().children})).flat());t=n.intersect(this,{insert:!1}),n.remove()}this.children?(this.removeChildren(),this.addChildren(t.children?t.children:[t])):this.segments=t.segments?t.segments:t.firstChild.segments}},i.Item.prototype.select=function(e){e||this.project._scope.findSelectedItems().forEach((function(e){return e.deselect()})),this.selected=!0,this.emit("selected"),this.project.emit("item-selected",{item:this})},i.Item.prototype.deselect=function(e){e?(this.selected=!1,this.emit("deselected"),this.project.emit("item-deselected",{item:this})):this.project._scope.findSelectedItems().forEach((function(e){return e.deselect(!0)}))},i.Item.prototype.toggle=function(e){this.selected?this.deselect(e):this.select(e)},i.PaperScope.prototype.findSelectedNewItem=function(){return this.project.getItems({selected:!0,match:function(e){return e.isGeoJSONFeature&&e.initializeGeoJSONFeature}})[0]},i.PaperScope.prototype.findSelectedItems=function(){return this.project.getItems({selected:!0,match:function(e){return e.isGeoJSONFeature}})},i.PaperScope.prototype.findSelectedItem=function(){return this.findSelectedItems()[0]},i.PaperScope.prototype.scaleByCurrentZoom=function(e){return e/this.view.getZoom()},i.PaperScope.prototype.getActiveTool=function(){return this.tool?this.tool._toolObject:null};var Ia=function(){function e(t){var n,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),o||(o={}),(n=function(e,t,n){return t=Aa(t),function(e,t){if(t&&("object"==ma(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,wa()?Reflect.construct(t,n||[],Aa(e).constructor):t.apply(e,n))}(this,e))._defaultOptions={addUI:!1,overlay:null,destroyOnViewerClose:!1,cacheAnnotations:!1},n.options=Object.assign({},n._defaultOptions,o),n._defaultStyle={fillColor:new i.Color("white"),strokeColor:new i.Color("black"),fillOpacity:1,strokeOpacity:1,strokeWidth:1,rescale:{strokeWidth:1}},n.viewer=t,n.options.overlay?n.options.overlay instanceof Ii&&(n.overlay=n.options.overlay):n.overlay=new Ii(n.viewer,{type:"image"}),n.paperScope.project.defaultStyle=new i.Style,n.paperScope.project.defaultStyle.set(n.defaultStyle),n.overlay.autoRescaleItems(!0),n.options.destroyOnViewerClose&&n.viewer.addOnceHandler("close",(function(){return n.destroy()})),n.viewer.annotationToolkit=n,n.paperScope.annotationToolkit=n,n.viewer.world.addHandler("add-item",(function(e){n.options.cacheAnnotations&&n._loadCachedAnnotations(e.item)})),n.viewer.world.addHandler("remove-item",(function(e){n.options.cacheAnnotations&&n._cacheAnnotations(e.item)}),!1,1),Mt.register(ji),Mt.register(kr),Mt.register(Di),Mt.register(Yi),Mt.register($i),Mt.register(Wt),Mt.register(pn),Mt.register(aa),Mt.register(ha),i.Item.fromGeoJSON=Mt.itemFromGeoJSON,i.Item.fromAnnotationItem=Mt.itemFromAnnotationItem,n._cached={},n.options.addUI){var r={};"object"===ma(o.addUI)&&(r=n.options.addUI),n.addAnnotationUI(r)}return n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Ca(e,t)}(e,r.EventSource),t=e,n=[{key:"defaultStyle",get:function(){return this._defaultStyle}},{key:"annotationUI",get:function(){return this._annotationUI}},{key:"paperScope",get:function(){return this.overlay.paperScope}},{key:"clearCache",value:function(){this._cached={}}},{key:"_cacheAnnotations",value:function(e){try{var t=ya(JSON.stringify(e.source)),n=e.paperLayer.getItems({match:function(e){return e.isGeoJSONFeatureCollection}});this._cached[t]=n}catch(e){console.error("Error with caching",e)}}},{key:"_loadCachedAnnotations",value:function(e){try{var t,n=ya(JSON.stringify(e.source)),o=function(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return va(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?va(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var o=0,r=function(){};return{s:r,n:function(){return o>=e.length?{done:!0}:{done:!1,value:e[o++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){s=!0,i=e},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw i}}}}(this._cached[n]||[]);try{for(o.s();!(t=o.n()).done;){var r=t.value;this._addFeatureCollectionGroupToLayer(r,e.paperLayer)}}catch(e){o.e(e)}finally{o.f()}}catch(e){console.error("Error with fetching from cache",e)}}},{key:"addAnnotationUI",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this._annotationUI||(this._annotationUI=new Xr(this,e)),this._annotationUI}},{key:"destroy",value:function(){this.raiseEvent("before-destroy");var e=this.paperScope&&this.paperScope.getActiveTool();e&&e.deactivate(!0),this.viewer.annotationToolkit=null,this._annotationUI&&this._annotationUI.destroy(),this.overlay.destroy(),this.raiseEvent("destroy")}},{key:"close",value:function(){this.raiseEvent("before-close");var e=this.paperScope&&this.paperScope.getActiveTool();e&&e.deactivate(!0),this.addFeatureCollections([],!0)}},{key:"setGlobalVisibility",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.paperScope.view._element.setAttribute("style","visibility:"+(e?"visible;":"hidden;"))}},{key:"addFeatureCollections",value:function(e,t,n){this.loadGeoJSON(e,t,n),this.overlay.rescaleItems(),this.paperScope.project.emit("items-changed")}},{key:"getFeatureCollectionGroups",value:function(e){return this.paperScope.project.getItems({match:function(t){return t.isGeoJSONFeatureCollection&&(!e||t.layer===e)}})}},{key:"getFeatures",value:function(){return this.paperScope.project.getItems({match:function(e){return e.isGeoJSONFeature}})}},{key:"toGeoJSON",value:function(e){return((e=Object.assign({layer:null},e)).layer||this.paperScope.project).getItems({match:function(e){return e.isGeoJSONFeatureCollection}}).map((function(e){return{type:"FeatureCollection",features:e.descendants.filter((function(e){return e.annotationItem})).map((function(e){return e.annotationItem.toGeoJSONFeature()})),properties:{defaultStyle:e.defaultStyle.toJSON(),userdata:e.data.userdata},label:e.displayName}}))}},{key:"toGeoJSONString",value:function(e,t){return JSON.stringify(this.toGeoJSON(),e,t)}},{key:"loadGeoJSON",value:function(e,t,n){var o=this,r=!!n&&n.paperLayer;t&&this.getFeatureCollectionGroups(n).forEach((function(e){return e.remove()})),Array.isArray(e)||(e=[e]),e.forEach((function(e){if("FeatureCollection"==e.type){var t=o._createFeatureCollectionGroup({label:e.label,parent:r}),n=e.properties||{};t.data.userdata=Object.assign({},n.userdata),t.defaultStyle.set(n.defaultStyle),e.features.forEach((function(e){var n=i.Item.fromGeoJSON(e);t.addChild(n)}))}else console.warn("GeoJSON object not loaded: wrong type. Only FeatureCollection objects are currently supported")}))}},{key:"addEmptyFeatureCollectionGroup",value:function(){return this._createFeatureCollectionGroup()}},{key:"_createFeatureCollectionGroup",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=(e=Object.assign({},{label:null,parent:null},e)).label,n=e.parent;if(!n){var o=this.viewer.world.getItemCount();1==o?n=this.viewer.world.getItemAt(0).paperLayer:0==o?n=this.viewer.viewport.paperLayer:(console.warn("Use of AnnotationToolkit with multi-image is not yet fully supported. All annotations will be added to the top-level tiled image."),n=this.viewer.world.getItemAt(o-1).paperLayer)}if(n){var r=new i.Group;this._addFeatureCollectionGroupToLayer(r,n);var a=this.getFeatureCollectionGroups().length;return r.name=r.displayName=null!==t?t:"Annotation Group ".concat(a),r.defaultStyle=new i.Style(this.paperScope.project.defaultStyle),r}console.error("Failed to create feature collection group: no parent could be found")}},{key:"_addFeatureCollectionGroupToLayer",value:function(t,n){n.addChild(t),e.registerFeatureCollection(t),this.paperScope.project.emit("feature-collection-added",{group:t}),t.children&&t.insertChildren(0,t.children)}},{key:"makePlaceholderItem",value:function(e){return new kr(e)}}],o=[{key:"registerFeature",value:function(e){e.isGeoJSONFeature=!0}},{key:"registerFeatureCollection",value:function(e){e.isGeoJSONFeatureCollection=!0}}],n&&ga(t.prototype,n),o&&ga(t,o),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,n,o}();function ka(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(ka=function(){return!!e})()}function Oa(e){return Oa=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},Oa(e)}function Ea(e,t){return Ea=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},Ea(e,t)}function Pa(e){return Pa="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Pa(e)}function _a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function xa(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,ja(o.key),o)}}function Ta(e,t,n){return t&&xa(e.prototype,t),n&&xa(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function ja(e){var t=function(e){if("object"!=Pa(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=Pa(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==Pa(t)?t:t+""}var Ba,La=function(){return Ta((function e(t){var n,o=this;_a(this,e);var r=this.overlay=new Ii(t,{overlayType:"viewer"}),i=this.tool=new Ma(this.overlay.paperScope,this);this.dummyTool=new this.overlay.paperScope.Tool,this.dummyTool.activate(),this._mouseNavEnabledAtActivation=!0,null===(n=r.addViewerButton({faIconClass:"fa-rotate",tooltip:"Rotate viewer",onClick:function(){i.active?o.deactivate():o.activate()}}).element.querySelector("svg.icon"))||void 0===n||n.style.setProperty("width","1em")}),[{key:"activate",value:function(){this._mouseNavEnabledAtActivation=this.overlay.viewer.isMouseNavEnabled(),this.tool.activate(),this.tool.active=!0,this.overlay.bringToFront()}},{key:"deactivate",value:function(){this.tool.deactivate(!0),this.dummyTool.activate(),this.overlay.viewer.setMouseNavEnabled(this._mouseNavEnabledAtActivation),this.tool.active=!1,this.overlay.sendToBack()}}])}(),Ma=function(){function e(t,n){var o;_a(this,e);var a,s,l,c=(a=this,l=[t],s=Oa(s=e),o=function(e,t){if(t&&("object"==Pa(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(a,ka()?Reflect.construct(s,l||[],Oa(a).constructor):s.apply(a,l))),u=t.view.bounds,p=new Ra(t.view.bounds.center,(function(e,t){if(!t){var n=new r.Point(p.item.position.x,p.item.position.y);t=d.viewport.pointFromPixel(n)}d.viewport.rotateTo(e,t,!0)}),(function(){n.deactivate()}));t.view.on("flip",(function(){p.closeButton.scale(-1,1,p.item.bounds.center)}));var d=t.overlay.viewer;return d.addHandler("rotate",(function(e){return p.setCurrentRotation(e.degrees)})),t.view.on("resize",(function(e){var n=p.item.position,o=n.x/u.width,r=n.y/u.height;u=t.view.bounds,p.item.position=new i.Point(o*u.width,r*u.height)})),p.item.visible=!1,c.project.toolLayer.addChild(p.item),o.tool.onMouseDown=function(e){},o.tool.onMouseDrag=function(e){},o.tool.onMouseMove=function(e){p.setLineOrientation(e.point)},o.tool.onMouseUp=function(){},o.tool.extensions.onKeyDown=function(e){"escape"==e.key&&n.deactivate()},o.extensions.onActivate=function(){0==p.item.visible&&(p.item.position=t.view.bounds.center),p.item.visible=!0,p.item.opacity=1},o.extensions.onDeactivate=function(e){e&&(p.item.visible=!1),p.item.opacity=.3},o}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Ea(e,t)}(e,k),Ta(e)}();function Ra(e,t,n){var o=2*e.x,r=2*e.y,a=Math.min(o/5,r/5,30),s=.3*a,l=new i.Point(0,-1).angle,c=new i.Group({insert:!1}),u=new i.Path.Circle({center:new i.Point(0,0),radius:a});u.fillColor=new i.Color(0,0,0,.01),u.strokeColor="black",u.strokeWidth=2,[0,90,180,270].map((function(e){var t=new i.Path.Line(new i.Point(0,s),new i.Point(0,a));t.rotate(e,new i.Point(0,0)),t.fillColor=null,t.strokeColor="black",t.strokeWidth=2,c.addChild(t)}));var p=[0,90,180,270].map((function(e){var t=new i.Path.Rectangle(new i.Point(-s,0),new i.Size(2*s,-1*(a+1.5*s))),n=t.subtract(u,{insert:!1});return t.remove(),n.rotate(e,new i.Point(0,0)),n.fillColor=new i.Color(100,100,100,.5),n.strokeColor="black",n._angle=e,c.addChild(n),n}));c.addChild(u);var d=new i.Path.Circle({center:new i.Point(0,-a),radius:s/1.5});d.set({fillColor:"yellow",strokeColor:"black",applyMatrix:!1}),c.addChild(d);var f=new i.Group({applyMatrix:!1}),h=new i.Group({applyMatrix:!1}),y=new i.Color(.3,.3,.3,.8),v=new i.Path.Line(new i.Point(0,-s),new i.Point(0,-Math.max(o,r)));v.strokeColor=y,v.strokeWidth=1,v.applyMatrix=!1,f.addChild(v),f.addChild(h);var m=new i.Path.RegularPolygon(new i.Point(1.2*-s,0),3,.8*s);m.rotate(-94);var g=new i.Path.RegularPolygon(new i.Point(1.2*s,0),3,.8*s);g.rotate(94);var b=new i.Path.Arc(new i.Point(1.2*-s,0),new i.Point(0,-s/4),new i.Point(1.2*s,0)),w=b.clone();h.addChildren([w,b,m,g]),h.fillColor="yellow",b.strokeWidth=s/2,w.strokeWidth=b.strokeWidth+2,w.strokeColor=y,m.strokeColor=y,g.strokeColor=y,b.strokeColor="yellow",b.fillColor=null,c.addChild(f);var A=new i.Group({insert:!1});A.addChild(new i.Path.Circle({radius:s})),A.addChild(new i.Path.Line(new i.Point(-s/2,-s/2),new i.Point(s/2,s/2))),A.addChild(new i.Path.Line(new i.Point(s/2,-s/2),new i.Point(-s/2,s/2))),A.set({fillColor:"red",strokeColor:"black",opacity:.7}),A.position=new i.Point(1.5*a,1.5*-a),c.addChild(A),c.pivot=u.bounds.center,c.position=e;var C={};return C.item=c,C.circle=u,C.cardinalControls=p,C.rotationLineControl=f,C.closeButton=A,C.setCurrentRotation=function(e){d.rotate(e-d.rotation,u.bounds.center)},C.setLineOrientation=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=e.subtract(u.bounds.center),o=n.angle-l,r=n.length;f.rotate(o-f.rotation,u.bounds.center),f.visible=t||r>a+1.5*s,h.position=new i.Point(0,-r),v.segments[1].point=new i.Point(0,-r)},p.forEach((function(e){e.onClick=function(){t(e._angle)}})),d.onMouseDrag=function(e){var n=e.point.subtract(u.bounds.center).angle;t(n-l)},h.onMouseDown=function(e){h._angleOffset=d.rotation-e.point.subtract(u.bounds.center).angle},h.onMouseDrag=function(e){var n,o=this.project.hitTestAll(e.point).filter((function(e){return p.includes(e.item)}));o.length>0&&(e.point=o[0].item.bounds.center),n=e.point.subtract(u.bounds.center).angle+h._angleOffset,t(n),C.setLineOrientation(e.point,!0)},u.onMouseDrag=function(e){C.item.position=C.item.position.add(e.delta)},A.onClick=function(){n()},C}var Na="image/png",Fa="image/jpeg",Da="p".charCodeAt(0),Ga="H".charCodeAt(0),za="Y".charCodeAt(0),Ha="s".charCodeAt(0);function Ua(e,t){var n=e.slice(0,33);return new Promise((function(o,r){var i=new FileReader;i.onload=function(){var n=new Uint8Array(i.result),r=e.slice(33),a=function(e,t,n,o){if(n===Fa)return e[13]=1,e[14]=t>>8,e[15]=255&t,e[16]=t>>8,e[17]=255&t,e;if(n===Na){var r=new Uint8Array(13);t*=39.3701,r[0]=Da,r[1]=Ga,r[2]=za,r[3]=Ha,r[4]=t>>>24,r[5]=t>>>16,r[6]=t>>>8,r[7]=255&t,r[8]=r[4],r[9]=r[5],r[10]=r[6],r[11]=r[7],r[12]=1;var i=function(e){var t=-1;Ba||(Ba=function(){for(var e=new Int32Array(256),t=0;t<256;t++){for(var n=t,o=0;o<8;o++)n=1&n?3988292384^n>>>1:n>>>1;e[t]=n}return e}());for(var n=0;n<e.length;n++)t=Ba[255&(t^e[n])]^t>>>8;return~t}(r),a=new Uint8Array(4);if(a[0]=i>>>24,a[1]=i>>>16,a[2]=i>>>8,a[3]=255&i,o){var s=function(e){for(var t=e.length-1;t>=4;t--)if(9===e[t-4]&&e[t-3]===Da&&e[t-2]===Ga&&e[t-1]===za&&e[t]===Ha)return t-3}(e);return e.set(r,s),e.set(a,s+13),e}var l=new Uint8Array(4);l[0]=0,l[1]=0,l[2]=0,l[3]=9;var c=new Uint8Array(54);return c.set(e,0),c.set(l,33),c.set(r,37),c.set(a,50),c}}(n,t,e.type);o(new Blob([a,r],{type:e.type}))},i.readAsArrayBuffer(n)}))}function Wa(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(Wa=function(){return!!e})()}function Va(e){return Va=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},Va(e)}function Ya(e,t){return Ya=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},Ya(e,t)}function qa(e){return qa="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},qa(e)}function Ja(){Ja=function(){return t};var e,t={},n=Object.prototype,o=n.hasOwnProperty,r=Object.defineProperty||function(e,t,n){e[t]=n.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",s=i.asyncIterator||"@@asyncIterator",l=i.toStringTag||"@@toStringTag";function c(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{c({},"")}catch(e){c=function(e,t,n){return e[t]=n}}function u(e,t,n,o){var i=t&&t.prototype instanceof m?t:m,a=Object.create(i.prototype),s=new x(o||[]);return r(a,"_invoke",{value:O(e,n,s)}),a}function p(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}t.wrap=u;var d="suspendedStart",f="suspendedYield",h="executing",y="completed",v={};function m(){}function g(){}function b(){}var w={};c(w,a,(function(){return this}));var A=Object.getPrototypeOf,C=A&&A(A(T([])));C&&C!==n&&o.call(C,a)&&(w=C);var S=b.prototype=m.prototype=Object.create(w);function I(e){["next","throw","return"].forEach((function(t){c(e,t,(function(e){return this._invoke(t,e)}))}))}function k(e,t){function n(r,i,a,s){var l=p(e[r],e,i);if("throw"!==l.type){var c=l.arg,u=c.value;return u&&"object"==qa(u)&&o.call(u,"__await")?t.resolve(u.__await).then((function(e){n("next",e,a,s)}),(function(e){n("throw",e,a,s)})):t.resolve(u).then((function(e){c.value=e,a(c)}),(function(e){return n("throw",e,a,s)}))}s(l.arg)}var i;r(this,"_invoke",{value:function(e,o){function r(){return new t((function(t,r){n(e,o,t,r)}))}return i=i?i.then(r,r):r()}})}function O(t,n,o){var r=d;return function(i,a){if(r===h)throw Error("Generator is already running");if(r===y){if("throw"===i)throw a;return{value:e,done:!0}}for(o.method=i,o.arg=a;;){var s=o.delegate;if(s){var l=E(s,o);if(l){if(l===v)continue;return l}}if("next"===o.method)o.sent=o._sent=o.arg;else if("throw"===o.method){if(r===d)throw r=y,o.arg;o.dispatchException(o.arg)}else"return"===o.method&&o.abrupt("return",o.arg);r=h;var c=p(t,n,o);if("normal"===c.type){if(r=o.done?y:f,c.arg===v)continue;return{value:c.arg,done:o.done}}"throw"===c.type&&(r=y,o.method="throw",o.arg=c.arg)}}}function E(t,n){var o=n.method,r=t.iterator[o];if(r===e)return n.delegate=null,"throw"===o&&t.iterator.return&&(n.method="return",n.arg=e,E(t,n),"throw"===n.method)||"return"!==o&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+o+"' method")),v;var i=p(r,t.iterator,n.arg);if("throw"===i.type)return n.method="throw",n.arg=i.arg,n.delegate=null,v;var a=i.arg;return a?a.done?(n[t.resultName]=a.value,n.next=t.nextLoc,"return"!==n.method&&(n.method="next",n.arg=e),n.delegate=null,v):a:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,v)}function P(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function _(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function x(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(P,this),this.reset(!0)}function T(t){if(t||""===t){var n=t[a];if(n)return n.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var r=-1,i=function n(){for(;++r<t.length;)if(o.call(t,r))return n.value=t[r],n.done=!1,n;return n.value=e,n.done=!0,n};return i.next=i}}throw new TypeError(qa(t)+" is not iterable")}return g.prototype=b,r(S,"constructor",{value:b,configurable:!0}),r(b,"constructor",{value:g,configurable:!0}),g.displayName=c(b,l,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===g||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,b):(e.__proto__=b,c(e,l,"GeneratorFunction")),e.prototype=Object.create(S),e},t.awrap=function(e){return{__await:e}},I(k.prototype),c(k.prototype,s,(function(){return this})),t.AsyncIterator=k,t.async=function(e,n,o,r,i){void 0===i&&(i=Promise);var a=new k(u(e,n,o,r),i);return t.isGeneratorFunction(n)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},I(S),c(S,l,"Generator"),c(S,a,(function(){return this})),c(S,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),n=[];for(var o in t)n.push(o);return n.reverse(),function e(){for(;n.length;){var o=n.pop();if(o in t)return e.value=o,e.done=!1,e}return e.done=!0,e}},t.values=T,x.prototype={constructor:x,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(_),!t)for(var n in this)"t"===n.charAt(0)&&o.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var n=this;function r(o,r){return s.type="throw",s.arg=t,n.next=o,r&&(n.method="next",n.arg=e),!!r}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],s=a.completion;if("root"===a.tryLoc)return r("end");if(a.tryLoc<=this.prev){var l=o.call(a,"catchLoc"),c=o.call(a,"finallyLoc");if(l&&c){if(this.prev<a.catchLoc)return r(a.catchLoc,!0);if(this.prev<a.finallyLoc)return r(a.finallyLoc)}else if(l){if(this.prev<a.catchLoc)return r(a.catchLoc,!0)}else{if(!c)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return r(a.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var r=this.tryEntries[n];if(r.tryLoc<=this.prev&&o.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var i=r;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=e,a.arg=t,i?(this.method="next",this.next=i.finallyLoc,v):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),v},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),_(n),v}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var o=n.completion;if("throw"===o.type){var r=o.arg;_(n)}return r}}throw Error("illegal catch attempt")},delegateYield:function(t,n,o){return this.delegate={iterator:T(t),resultName:n,nextLoc:o},"next"===this.method&&(this.arg=e),v}},t}function Za(e,t,n,o,r,i,a){try{var s=e[i](a),l=s.value}catch(e){return void n(e)}s.done?t(l):Promise.resolve(l).then(o,r)}function Xa(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Ka(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,$a(o.key),o)}}function Qa(e,t,n){return t&&Ka(e.prototype,t),n&&Ka(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function $a(e){var t=function(e){if("object"!=qa(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=qa(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==qa(t)?t:t+""}var es=function(){return Qa((function e(t,n){var o,r=this;Xa(this,e),this.viewer=t;var i=this.overlay=new Ii(t,{overlayType:"viewer"}),a=this.tool=new ts(this.overlay.paperScope,this);this.dummyTool=new this.overlay.paperScope.Tool,this.dummyTool.activate(),this._mouseNavEnabledAtActivation=!0,null===(o=i.addViewerButton({faIconClass:"fa-camera",tooltip:"Take Screenshot",onClick:function(){a.active?r.deactivate():r.activate()}}).element.querySelector("svg.icon"))||void 0===o||o.style.setProperty("width","1em"),this._makeDialog(n),this.tool.addEventListener("region-selected",(function(e){return r._setupScreenshotDialog(e)}))}),[{key:"activate",value:function(){var e=this.overlay.setOSDMouseNavEnabled(!1);this._mouseNavEnabledAtActivation=this._mouseNavEnabledAtActivation||e,this.overlay.bringToFront(),this.tool.activate()}},{key:"deactivate",value:function(){this.dialog.classList.add("hidden"),this.tool.deactivate(!0),this.dummyTool.activate(),this.overlay.setOSDMouseNavEnabled(this._mouseNavEnabledAtActivation),this._mouseNavEnabledAtActivation=!1,this.overlay.sendToBack()}},{key:"_startRegion",value:function(){this.dialog.classList.add("hidden"),this.tool.activate()}},{key:"_makeDialog",value:function(e){var t=this,n='<div class="screenshot-dialog hidden">\n            <div class="size">\n                <h3>Aspect Ratio</h3>\n                <label>Lock</label><input class="lock-aspect-ratio" type="checkbox"/>\n                <input type="number" min="0" value="1" class="aspect-width"/> x <input type="number" min="0" value="1" class="aspect-height"/>\n                <button class="apply-aspect-ratio">Apply</button>\n            </div>\n            <hr>\n            <div>\n                <h3>Selected Region</h3>\n                <div class="size">\n                    <div><input class="region-width region-dim" type="number" min="0"/> x <input class="region-height region-dim" type="number" min="0"/> px \n                    (<span class="region-width-mm"></span> x <span class="region-height-mm"></span> mm)</div>\n                </div>\n                <div class="scalebar">\n                    <label>Include scale bar:</label> <input class="include-scalebar"type="checkbox">\n                    <div class="scalebar-opts">\n                    <p>Enter desired scale bar width in millimeters and height in pixels.<br>Width will be rounded to the nearest pixel.</p>\n                    <label>Width (mm):</label><input class="scalebar-width" type="number" min="0.001" step="0.01">\n                    <label>Height (px):</label><input class="scalebar-height" type="number" min="1" step="1">\n                    </div>\n                </div> \n            <div>\n            <hr>\n            <div class="screenshot-results">\n                <div class="instructions">\n                    <h3>Create your screenshot</h3>\n                    <div>\n                        <label>Select size:</label>\n                        <select class="select-size"></select>\n                        <button class="create-screenshot">Create</button>\n                    </div>\n                    \n                </div>\n                <div class="download">\n                    <h3>View/Download</h3>\n                    <div class="download-message">'.concat((null==e?void 0:e.downloadMessage)||"",'</div>\n                    <div><a class="open-screenshot screenshot-link" target="_blank"><button>Open in new tab</button></a> | \n                    <a class="download-screenshot screenshot-link" download="screenshot.png"><button>Download</button></a></div>\n                    <div><button class="cancel-screenshot">Change size</button></div>\n                </div>\n                <div class="pending-message"><h3>View/Download</h3>\n                Creating your screenshot...\n                <div class="screenshot-progress">\n                    <progress></progress>\n                    <div>Loaded <span class="loaded"></span> of <span class="total"><span> tiles</div>\n                </div>\n                <div><button class="cancel-screenshot">Change size</button></div>\n                </div>\n            </div>\n            <hr>\n            <button class=\'rect\'>Select a new area</button> | <button class=\'close\'>Close</button>\n        </div>');document.querySelector('style[data-type="screenshot-tool"]')||document.querySelector("head").appendChild(ur('<style data-type="screenshot-tool">\n            .screenshot-dialog{\n                position: absolute;\n                top: 50%;\n                left: 50%;\n                transform: translate(-50%, -50%);\n                padding: 1em;\n                border: thin black solid;\n                background-color: white;\n                color: black;\n            }\n            .screenshot-dialog.hidden{\n                display:none;\n            }\n            .screenshot-dialog h3{\n                margin: 0.1em 0;\n            }\n            .screenshot-dialog input[type=number]{\n                width: 5em;\n            }\n            .screenshot-results>*{\n                display:none;\n                min-height:6em;\n            }\n            .screenshot-results.created .download{\n                display:block;\n            }\n            .screenshot-results.pending .pending-message{\n                display:block;\n            }\n            .screenshot-results:not(.created):not(.pending) .instructions{\n                display:block;\n            }\n            .screenshot-link{\n                display:inline-block;\n                margin-bottom: 0.5em;\n            }\n            .screenshot-dialog .download-message:not(:empty){\n                margin-bottom:1em;\n            }\n            .scalebar-opts.hidden{\n                visibility:hidden;\n            }\n        </style>'));var o=ur(n);this.viewer.container.appendChild(o),o.addEventListener("mousemove",(function(e){return e.stopPropagation()})),o.querySelectorAll(".close").forEach((function(e){return e.addEventListener("click",(function(){return t.deactivate()}))})),o.querySelectorAll(".rect").forEach((function(e){return e.addEventListener("click",(function(){return t._startRegion()}))})),o.querySelectorAll(".cancel-screenshot").forEach((function(e){return e.addEventListener("click",(function(){return o.querySelector(".screenshot-results").classList.remove("pending","created")}))})),o.querySelectorAll(".create-screenshot").forEach((function(e){return e.addEventListener("click",(function(){var e=o.querySelector(".select-size"),n=e.options[e.selectedIndex],r=JSON.parse(n.getAttribute("data-dims"));t.dialog.querySelector(".screenshot-results").classList.add("pending"),t._createScreenshot(r).then((function(e){var n=t.dialog.querySelector(".screenshot-results");n.classList.remove("pending"),n.classList.add("created"),t.dialog.querySelector(".screenshot-link").href=t.blobURL})).catch((function(e){alert("There was a problem creating the screenshot. "+e)}))}))})),o.querySelectorAll("button.download-screenshot").forEach((function(e){return e.addEventListener("click",(function(){o.querySelectorAll("a.download-screenshot").dispatchEvent(new Event("change"))}))})),o.querySelectorAll(".aspect-width").forEach((function(e){e.addEventListener("change",(function(e){return t.tool.setAspectWidth(Number(e.target.value))})),e.dispatchEvent(new Event("change"))})),o.querySelectorAll(".aspect-height").forEach((function(e){e.addEventListener("change",(function(e){return t.tool.setAspectHeight(Number(e.target.value))})),e.dispatchEvent(new Event("change"))})),o.querySelectorAll(".lock-aspect-ratio").forEach((function(e){e.addEventListener("change",(function(e){return t.tool.setAspectLocked(e.target.checked)})),e.dispatchEvent(new Event("change"))})),o.querySelectorAll(".apply-aspect-ratio").forEach((function(e){return e.addEventListener("click",(function(e){return t._applyAspectRatio()}))})),o.querySelectorAll(".region-dim").forEach((function(e){return e.addEventListener("change",(function(){return t._updateROI()}))})),o.querySelectorAll(".scalebar-width").forEach((function(e){e.addEventListener("change",(function(e){return t._scalebarWidth=Number(e.target.value)}),t._resetScreenshotResults()),e.dispatchEvent(new Event("change"))})),o.querySelectorAll(".scalebar-height").forEach((function(e){e.addEventListener("change",(function(e){return t._scalebarHeight=Number(e.target.value)}),t._resetScreenshotResults()),e.dispatchEvent(new Event("change"))})),o.querySelectorAll(".include-scalebar").forEach((function(e){e.addEventListener("change",(function(e){t._includeScalebar=e.target.checked;var n=o.querySelector(".scalebar-opts");t._includeScalebar?n.classList.remove("hidden"):n.classList.add("hidden"),t._resetScreenshotResults()})),e.dispatchEvent(new Event("change"))})),this.dialog=o}},{key:"_updateROI",value:function(){var e=this.dialog.querySelector(".region-width").value,t=this.dialog.querySelector(".region-height").value;this._currentBounds.width=Number(e),this._currentBounds.height=Number(t),this._setupScreenshotDialog(this._currentBounds),this.dialog.querySelector(".lock-aspect-ratio").checked&&this._applyAspectRatio()}},{key:"_applyAspectRatio",value:function(){var e=this._currentBounds.width/this._currentBounds.height,t=this.tool._aspectWidth/this.tool._aspectHeight;e/t>1?(this._currentBounds.width=Math.round(this._currentBounds.height*t),this._setupScreenshotDialog(this._currentBounds)):e/t<1&&(this._currentBounds.height=Math.round(this._currentBounds.width/t),this._setupScreenshotDialog(this._currentBounds))}},{key:"_setupScreenshotDialog",value:function(e){this._resetScreenshotResults(),this._currentBounds=e,this.dialog.querySelector(".region-width").value=e.width,this.dialog.querySelector(".region-height").value=e.height;var t=this.viewer.viewport,n=(this.viewer.world.getItemAt(this.viewer.currentPage()),new r.Rect(e.x,e.y,e.width,e.height)),o=t.viewerElementToViewportRectangle(n),i=t.viewportToImageRectangle(o),a=Math.max(i.width,i.height)/Math.max(n.width,n.height),s={width:n.width*a,height:n.height*a},l=!1;if(this._mpp=null,this.dialog.querySelector(".include-scalebar").disabled=!0,1===this.viewer.world.getItemCount()){var c=this.viewer.world.getItemAt(0).source.mpp;c&&(this.dialog.querySelector(".region-width-mm").textContent=""+(c.x/1e3*s.width).toFixed(3),this.dialog.querySelector(".region-height-mm").textContent=""+(c.y/1e3*s.height).toFixed(3),l=!0,this.dialog.querySelector(".include-scalebar").disabled=!1,this._mpp=c)}l||this.dialog.querySelectorAll(".region-width-mm, .region-height-mm").forEach((function(e){return e.textContent="??"}));var u=this.dialog.querySelector(".select-size");u.textContent="";for(var p=s.width,d=s.height;p>e.width&&d>e.height;){var f={w:Math.round(p),h:Math.round(d),imageBounds:i,scaleFactor:p/s.width},h=document.createElement("option");u.appendChild(h),h.textContent="".concat(Math.round(p)," x ").concat(Math.round(d)),h.setAttribute("data-dims",JSON.stringify(f)),(p>23767||d>23767||p*d>268435456)&&h.setAttribute("disabled",!0),p/=2,d/=2}var y={w:e.width,h:e.height,imageBounds:i,scaleFactor:e.width/s.width},v=document.createElement("option");u.appendChild(v),v.textContent="".concat(Math.round(p)," x ").concat(Math.round(d)),v.setAttribute("data-dims",JSON.stringify(y)),this.dialog.classList.remove("hidden")}},{key:"_resetScreenshotResults",value:function(){var e;null===(e=this.dialog)||void 0===e||e.querySelector(".screenshot-results").classList.remove("created","pending")}},{key:"_setProgress",value:function(e,t){if(this.dialog){var n=this.dialog.querySelector("progress");n.value=e,n.max=t,this.dialog.querySelector(".loaded").textContent=e,this.dialog.querySelector(".total").textContent=t}}},{key:"_createScreenshot",value:function(e){var t=this,n=e.w,o=e.h,i=e.imageBounds,a=new r.Rect(i.x,i.y,i.width,i.height,i.degrees),s=e.scaleFactor;return new Promise((function(e,i){try{var l=r.pixelDensityRatio;n/=l,o/=l;var c=document.createElement("div");document.body.appendChild(c),c.style.cssText="width:".concat(n,"px;height:").concat(o,"px;position:fixed;left:-").concat(2*n,"px;");var u=t.viewer.tileSources[t.viewer.currentPage()],p=t.viewer.world.getItemAt(t.viewer.currentPage()),d=r({element:c,tileSources:[u],crossOriginPolicy:t.viewer.crossOriginPolicy,prefixUrl:t.viewer.prefixUrl,immediateRender:!0});d.viewport.setRotation(t.viewer.viewport.getRotation(!0),!0),d.addHandler("tile-drawn",(function(e){var n=e.tiledImage.coverage,o=Object.keys(n),r=o[o.length-1];if(e.tile.level==r){var i=n[r],a=Object.values(i).map((function(e){return Object.values(e)})).flat();t._setProgress(a.filter((function(e){return e})).length,a.length)}})),d.addHandler("open",(function(){d.world.getItemAt(0).setRotation(p.getRotation(!0),!0),d.world.getItemAt(0).addOnceHandler("fully-loaded-change",(function(n){if(t._includeScalebar&&t._mpp){var o=Math.round(1e3*t._scalebarWidth/t._mpp.x*s),r=Math.round(t._scalebarHeight),i=d.drawer.canvas,a=i.getContext("2d"),c=i.width,u=i.height;a.fillRect(c-r,u-r,-o,-r)}d.drawer.canvas.toBlob(function(){var n,o=(n=Ja().mark((function n(o){var r;return Ja().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(1==l){n.next=4;break}return n.next=3,Ua(o,96*l);case 3:o=n.sent;case 4:t.blobURL&&URL.revokeObjectURL(t.blobURL),t.blobURL=URL.createObjectURL(o),e(t.blobURL),r=d.element,d.destroy(),r.remove();case 10:case"end":return n.stop()}}),n)})),function(){var e=this,t=arguments;return new Promise((function(o,r){var i=n.apply(e,t);function a(e){Za(i,o,r,a,s,"next",e)}function s(e){Za(i,o,r,a,s,"throw",e)}a(void 0)}))});return function(e){return o.apply(this,arguments)}}())}));var n=d.viewport.imageToViewportRectangle(a);d.viewport.fitBounds(n)}))}catch(e){i(e)}}))}}])}(),ts=function(){function e(t,n){var o;Xa(this,e);var r,a,s,l=(r=this,s=[t],a=Va(a=e),o=function(e,t){if(t&&("object"==qa(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(r,Wa()?Reflect.construct(a,s||[],Va(r).constructor):a.apply(r,s)));o._ps=t,o.compoundPath=new i.CompoundPath({children:[],fillRule:"evenodd"}),o.compoundPath.visible=!1,o.compoundPath.fillColor="black",o.compoundPath.opacity=.3,o.project.toolLayer.addChild(o.compoundPath),o.crosshairTool=new i.Group;var c=new i.Path({segments:[new i.Point(0,0),new i.Point(0,0)],strokeScaling:!1,strokeWidth:1,strokeColor:"black"}),u=new i.Path({segments:[new i.Point(0,0),new i.Point(0,0)],strokeScaling:!1,strokeWidth:1,strokeColor:"white",dashArray:[6,6]}),p=new i.Path({segments:[new i.Point(0,0),new i.Point(0,0)],strokeScaling:!1,strokeWidth:1,strokeColor:"black"}),d=new i.Path({segments:[new i.Point(0,0),new i.Point(0,0)],strokeScaling:!1,strokeWidth:1,strokeColor:"white",dashArray:[6,6]});return o.crosshairTool.addChildren([c,u,p,d]),o.project.toolLayer.addChild(o.crosshairTool),o.crosshairTool.visible=!1,o._aspectHeight=1,o._aspectWidth=1,o._aspectLocked=!1,o.tool.onMouseDown=function(e){o.crosshairTool.visible=!1,o.compoundPath.visible=!0,o.compoundPath.removeChildren(),o.compoundPath.addChild(new i.Path.Rectangle(o._ps.view.bounds)),window.cp=o.compoundPath},o.tool.onMouseDrag=function(e){o.compoundPath.removeChildren(1);var t=o.getPoint(e);o.compoundPath.addChild(new i.Path.Rectangle(e.downPoint,t))},o.tool.onMouseMove=function(e){var t,n,r,a,s,f,h;o.crosshairTool.visible=!0,t=l.tool,n=e.point,r=t.view.projectToView(n),a=t.view.viewToProject(new i.Point(0,r.y)),s=t.view.viewToProject(new i.Point(t.view.viewSize.width,r.y)),f=t.view.viewToProject(new i.Point(r.x,0)),h=t.view.viewToProject(new i.Point(r.x,t.view.viewSize.height)),c.segments[0].point=a,u.segments[0].point=a,c.segments[1].point=s,u.segments[1].point=s,p.segments[0].point=f,d.segments[0].point=f,p.segments[1].point=h,d.segments[1].point=h},o.tool.onMouseUp=function(e){var t=o.getPoint(e);o.broadcast("region-selected",new i.Rectangle(e.downPoint,t))},o.tool.extensions.onKeyDown=function(e){"escape"==e.key&&n.deactivate()},o.extensions.onActivate=function(){o.crosshairTool.visible=!0,o.compoundPath.visible=!1},o.extensions.onDeactivate=function(e){o.crosshairTool.visible=!1,o.compoundPath.visible=!1},o}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Ya(e,t)}(e,k),Qa(e,[{key:"activate",value:function(){this.tool.activate(),this.crosshairTool.visible=!0,this.compoundPath.visible=!1}},{key:"deactivate",value:function(){this.crosshairTool.visible=!1,this.compoundPath.visible=!1}},{key:"setAspectHeight",value:function(e){this._aspectHeight=e}},{key:"setAspectWidth",value:function(e){this._aspectWidth=e}},{key:"setAspectLocked",value:function(e){this._aspectLocked=e}},{key:"getPoint",value:function(e){var t=e.point;if(this._aspectLocked){var n=e.point.subtract(e.downPoint);Math.abs(n.x)>Math.abs(n.y)?t.y=e.downPoint.y+(n.y<0?-1:1)*Math.abs(n.x)*this._aspectHeight/this._aspectWidth:t.x=e.downPoint.x+(n.x<0?-1:1)*Math.abs(n.y)*this._aspectWidth/this._aspectHeight}return t}}])}(),ns=o.jG,os=o.yV,rs=o.YV,is=o.ls,as=o.Ge,ss=o.dH,ls=o.fy,cs=o.$_,us=o.fm,ps=o.Wi,ds=o.KW,fs=o.Cz,hs=o.Fv,ys=o.Mf,vs=o.L_,ms=o.tD,gs=o.Ue,bs=o.Sk,ws=o.M$,As=o.RV,Cs=o.HA,Ss=o.wN,Is=o.YQ,ks=o.Bg,Os=o.FY;export{ns as AnnotationToolbar,os as AnnotationToolkit,rs as AnnotationUITool,is as BrushTool,as as DefaultTool,ss as EllipseTool,ls as FeatureCollectionUI,cs as FeatureUI,us as FileDialog,ps as LayerUI,ds as LinestringTool,fs as PaperOffset,hs as PaperOverlay,ys as PointTextTool,vs as PointTool,ms as PolygonTool,gs as RasterTool,bs as RectangleTool,ws as RotationControlOverlay,As as ScreenshotOverlay,Cs as SelectTool,Ss as StyleTool,Is as ToolBase,ks as TransformTool,Os as WandTool};
//# sourceMappingURL=main.mjs.map